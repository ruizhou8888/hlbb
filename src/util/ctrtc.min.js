(function(m){var k={};(function(b){var g,d=b.name+" | EVENT EMITTER | ";g=function(){};g.prototype={initEvents:function(b){var e=b.length;this.events={};this.onceNotFired=[];this.maxListeners=10;for(this.events.newListener=function(b){console.log(d+"new listener added to event "+b)};e--;)console.log(d+"adding event "+b[e]),this.events[b[e]]=[]},checkEvent:function(b){if(this.events[b])return!0;console.error(d+"no event named "+b);return!1},addListener:function(b,e){this.checkEvent(b)&&(this.events[b].length>=
this.maxListeners&&console.warn(d+"max listeners exceeded for event "+b),this.events[b].push(e),this.events.newListener.call(null,b))},on:function(b,d){this.addListener(b,d)},once:function(b,d){this.events[b].unshift(d);this.onceNotFired.push(b)},removeListener:function(b,d){if(this.checkEvent(b))for(var i=this.events[b],o=0,z=i.length;o<z;)i[o]&&i[o].toString()===d.toString()?i.splice(o,1):o++},removeAllListener:function(b){this.checkEvent(b)&&(this.events[b]=[])},setMaxListeners:function(b){Number(b)&&
(this.maxListeners=b)},listeners:function(b){return this.events[b]},emit:function(f,e,i){var o,z,l=0;if(this.checkEvent(f)){console.log(d+"emitting event "+f);o=this.events[f];z=o.length;if(e=new b.Event(f,e,i))for(l;l<z;l++)o[l].apply(null,[e]);else for(l;l<z;l++)o[l].call();l=this.onceNotFired.indexOf(f);-1!==l&&(this.onceNotFired.splice(l,1),this.events[f].shift())}},newListener:function(b){this.events.newListener=b}};b.EventEmitter=g;b.Event=function(b,d,i){this.type=b;this.sender=d;this.data=
i}})(k);k.C={USER_AGENT:k.name+" "+k.version,SIP:"sip",INVALID_TARGET_URI:"sip:invalid@invalid",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INVALID_TARGET:"Invalid Target",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",
WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",
BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",
403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",
433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",
493:"Undecipherable",494:"Security Agreement Required",500:"Server Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}};(function(b){var g;g={ConfigurationError:function(){var b=function(b,d){this.code=1;this.name="CONFIGURATION_ERROR";this.parameter=b;this.value=d;this.message=!this.value?
"Missing parameter: "+this.parameter:"Invalid value "+m.JSON.stringify(this.value)+' for parameter "'+this.parameter+'"'};b.prototype=Error();return b}(),InvalidTargetError:function(){var b=function(b){this.code=2;this.name="INVALID_TARGET_ERROR";this.target=b;this.message="Invalid target: "+this.target};b.prototype=Error();return b}(),InvalidStateError:function(){var b=function(b){this.code=3;this.name="INVALID_STATE_ERROR";this.status=b};b.prototype=Error();return b}()};b.Exceptions=g})(k);k.Timers=
{T1:500,T2:4E3,T4:5E3,TIMER_B:32E3,TIMER_D:0,TIMER_F:32E3,TIMER_H:32E3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32E3,TIMER_M:32E3,TIMER_N:90};(function(b){var g,d=b.name+" | TRANSPORT | ";g=function(b,d){this.ua=b;this.ws=null;this.server=d;this.reconnection_attempts=0;this.connected=this.closed=!1;this.reconnectTimer=null;this.lastTransportError={};this.ua.transport=this;this.connect()};g.prototype={send:function(b){b=b.toString();if(this.ws&&this.ws.readyState===WebSocket.OPEN)return!0===this.ua.configuration.trace_sip&&
console.log(d+"sending WebSocket message:\n\n"+b+"\n"),this.ws.send(b),!0;console.warn(d+"unable to send message, WebSocket is not open");return!1},disconnect:function(){this.ws&&(this.closed=!0,console.log(d+"closing WebSocket "+this.server.ws_uri),this.ws.close())},connect:function(){var b=this;if(this.ws&&(this.ws.readyState===WebSocket.OPEN||this.ws.readyState===WebSocket.CONNECTING))return console.log(d+"WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close();console.log(d+
"connecting to WebSocket "+this.server.ws_uri);try{this.ws=new WebSocket(this.server.ws_uri,"sip")}catch(e){console.warn(d+"error connecting to WebSocket "+this.server.ws_uri+": "+e)}this.ws.binaryType="arraybuffer";this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(d){b.onClose(d)};this.ws.onmessage=function(d){b.onMessage(d)};this.ws.onerror=function(d){b.onError(d)}},onOpen:function(){this.connected=!0;console.log(d+"WebSocket "+this.server.ws_uri+" connected");m.clearTimeout(this.reconnectTimer);
this.closed=!1;this.ua.onTransportConnected(this)},onClose:function(b){var e=this.connected;this.connected=!1;this.lastTransportError.code=b.code;this.lastTransportError.reason=b.reason;console.warn(d+"WebSocket disconnected (code: "+b.code+(b.reason?"| reason: "+b.reason:"")+")");!1===b.wasClean&&console.warn(d+"WebSocket abrupt disconnection");if(!0===e)this.ua.onTransportClosed(this),this.closed||(this.reconnection_attempts=0,this.reConnect()),this.ua.emit("disconnected",this.ua,{transport:this,
code:this.lastTransportError.code,reason:this.lastTransportError.reason});else this.ua.onTransportError(this)},onMessage:function(f){var e,f=f.data;if("\r\n"===f)!0===this.ua.configuration.trace_sip&&console.log(d+"received WebSocket message with CRLF Keep Alive response");else{if("string"!==typeof f){try{f=String.fromCharCode.apply(null,new Uint8Array(f))}catch(i){console.warn(d+"received WebSocket binary message failed to be converted into string, message discarded");return}!0===this.ua.configuration.trace_sip&&
console.log(d+"received WebSocket binary message:\n\n"+f+"\n")}else!0===this.ua.configuration.trace_sip&&console.log(d+"received WebSocket text message:\n\n"+f+"\n");f=b.Parser.parseMessage(f);if(!(this.ua.status===b.UA.C.STATUS_USER_CLOSED&&f instanceof b.IncomingRequest)&&f&&b.sanityCheck(f,this.ua,this))if(f instanceof b.IncomingRequest)f.transport=this,this.ua.receiveRequest(f);else if(f instanceof b.IncomingResponse)switch(f.method){case b.C.INVITE:(e=this.ua.transactions.ict[f.via_branch])&&
e.receiveResponse(f);break;case b.C.ACK:break;default:(e=this.ua.transactions.nict[f.via_branch])&&e.receiveResponse(f)}}},onError:function(b){console.warn(d+"WebSocket connection error: "+b)},reConnect:function(){var b=this;this.reconnection_attempts+=1;this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(console.warn(d+"maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(console.log(d+"trying to reconnect to WebSocket "+this.server.ws_uri+
" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=m.setTimeout(function(){b.connect()},1E3*this.ua.configuration.ws_server_reconnection_timeout))}};g.C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};b.Transport=g})(k);(function(b){var g=b.name+" | PARSER | ";b.Parser={parseMessage:function(d){var f,e,i,o,z=0;e=d.indexOf("\r\n");if(-1===e)console.warn(g+"no CRLF found, not a SIP message, discarded");else if(f=d.substring(0,e),o=b.Grammar.parse(f,"Request_Response"),
-1===o)console.warn(g+'error parsing first line of SIP message: "'+f+'"');else{o.status_code?(f=new b.IncomingResponse,f.status_code=o.status_code,f.reason_phrase=o.reason_phrase):(f=new b.IncomingRequest,f.method=o.method,f.ruri=o.uri);f.data=d;for(z=e+2;;){a:{e=d;o=z;var l=0,C=0;if(e.substring(o,o+2).match(/(^\r\n)/))e=-2;else{for(;0===l;){C=e.indexOf("\r\n",o);if(-1===C){e=C;break a}!e.substring(C+2,C+4).match(/(^\r\n)/)&&e.charAt(C+2).match(/(^\s+)/)?o=C+2:l=C}e=l}}if(-2===e){i=z+2;break}else if(-1===
e)return;o=f;var l=d,B=z,C=e,v=void 0,n=z=void 0,v=l.indexOf(":",B),B=l.substring(B,v).trim(),l=l.substring(v+1,C).trim();switch(B.toLowerCase()){case "via":case "v":o.addHeader("via",l);if(1===o.countHeader("via")){if(n=o.parseHeader("Via"))o.via=n,o.via_branch=n.branch}else n=0;break;case "from":case "f":o.setHeader("from",l);if(n=o.parseHeader("from"))o.from=n,o.from_tag=n.getParam("tag");break;case "to":case "t":o.setHeader("to",l);if(n=o.parseHeader("to"))o.to=n,o.to_tag=n.getParam("tag");break;
case "record-route":n=b.Grammar.parse(l,"Record_Route");-1===n&&(n=void 0);for(z in n)v=n[z],o.addHeader("record-route",l.substring(v.possition,v.offset)),o.headers["Record-Route"][o.countHeader("record-route")-1].parsed=v.parsed;break;case "call-id":case "i":o.setHeader("call-id",l);if(n=o.parseHeader("call-id"))o.call_id=l;break;case "contact":case "m":n=b.Grammar.parse(l,"Contact");-1===n&&(n=void 0);for(z in n)v=n[z],o.addHeader("contact",l.substring(v.possition,v.offset)),o.headers.Contact[o.countHeader("contact")-
1].parsed=v.parsed;break;case "content-length":case "l":o.setHeader("content-length",l);n=o.parseHeader("content-length");break;case "content-type":case "c":o.setHeader("content-type",l);n=o.parseHeader("content-type");break;case "cseq":o.setHeader("cseq",l);if(n=o.parseHeader("cseq"))o.cseq=n.value;o instanceof b.IncomingResponse&&(o.method=n.method);break;case "max-forwards":o.setHeader("max-forwards",l);n=o.parseHeader("max-forwards");break;case "www-authenticate":o.setHeader("www-authenticate",
l);n=o.parseHeader("www-authenticate");break;case "proxy-authenticate":o.setHeader("proxy-authenticate",l);n=o.parseHeader("proxy-authenticate");break;default:o.setHeader(B,l),n=0}o=void 0===n?!1:!0;if(!o)return;z=e+2}f.hasHeader("content-length")?(e=f.getHeader("content-length"),f.body=d.substr(i,e)):f.body=d.substring(i);return f}}}})(k);(function(b){var g,d,f,e,i=b.name+" | SIP MESSAGE | ";g=function(d,e,f,i,g,v){i=i||{};if(!d||!e||!f)return null;this.headers={};this.method=d;this.ruri=e;this.body=
v;this.extraHeaders=g||[];i.route_set?this.setHeader("route",i.route_set):f.configuration.use_preloaded_route&&this.setHeader("route",f.transport.server.sip_uri);this.setHeader("via","");this.setHeader("max-forwards",b.UA.C.MAX_FORWARDS);g=i.to_display_name||0===i.to_display_name?'"'+i.to_display_name+'" ':"";g+="<"+(i.to_uri||e)+">";g+=i.to_tag?";tag="+i.to_tag:"";this.to=new b.NameAddrHeader.parse(g);this.setHeader("to",g);e=i.from_display_name||0===i.from_display_name?'"'+i.from_display_name+'" ':
f.configuration.display_name?'"'+f.configuration.display_name+'" ':"";e+="<"+(i.from_uri||f.configuration.uri)+">;tag=";e+=i.from_tag||b.Utils.newTag();this.from=new b.NameAddrHeader.parse(e);this.setHeader("from",e);this.call_id=f=i.call_id||f.configuration.jssip_id+b.Utils.createRandomToken(15);this.setHeader("call-id",f);this.cseq=i=i.cseq||Math.floor(1E4*Math.random());this.setHeader("cseq",i+" "+d)};g.prototype={setHeader:function(d,e){this.headers[b.Utils.headerize(d)]=e instanceof Array?e:
[e]},toString:function(){var d,e,f;d=""+(this.method+" "+this.ruri+" SIP/2.0\r\n");for(e in this.headers)for(f in this.headers[e])d+=e+": "+this.headers[e][f]+"\r\n";e=this.extraHeaders.length;for(f=0;f<e;f++)d+=this.extraHeaders[f]+"\r\n";d+="Supported: "+b.UA.C.SUPPORTED+"\r\n";d+="User-Agent: "+b.C.USER_AGENT+"\r\n";this.body?(e=b.Utils.str_utf8_length(this.body),d=d+("Content-Length: "+e+"\r\n\r\n")+this.body):d+="Content-Length: 0\r\n\r\n";return d}};d=function(){this.body=this.to_tag=this.to=
this.from_tag=this.from=this.cseq=this.call_id=this.via_branch=this.via=this.method=this.headers=this.data=null};d.prototype={addHeader:function(d,e){var f={raw:e},d=b.Utils.headerize(d);this.headers[d]?this.headers[d].push(f):this.headers[d]=[f]},countHeader:function(d){return(d=this.headers[b.Utils.headerize(d)])?d.length:0},getHeader:function(d,e){var f=this.headers[b.Utils.headerize(d)],e=e||0;if(f&&f[e])return f[e].raw},getHeaderAll:function(d){var e,d=this.headers[b.Utils.headerize(d)],f=[];
if(!d)return[];for(e in d)f.push(d[e].raw);return f},hasHeader:function(d){return this.headers[b.Utils.headerize(d)]?!0:!1},parseHeader:function(d,e){var f,g,B,d=b.Utils.headerize(d),e=e||0;if(this.headers[d])if(e>=this.headers[d].length)console.log(i+'not so many "'+d+'" headers present');else{f=this.headers[d][e];g=f.raw;if(f.parsed)return f.parsed;B=b.Grammar.parse(g,d.replace(/-/g,"_"));if(-1===B)this.headers[d].splice(e,1),console.warn(i+'error parsing "'+d+'" header field with value "'+g+'"');
else return f.parsed=B}else console.log(i+'header "'+d+'" not present')},s:function(b,d){return this.parseHeader(b,d)},setHeader:function(d,e){var f={raw:e};this.headers[b.Utils.headerize(d)]=[f]},toString:function(){return this.data}};f=function(){this.headers={};this.server_transaction=this.transport=this.ruri=null};f.prototype=new d;f.prototype.reply=function(d,e,f,i,g,v){var n,u,r,k;r=this.getHeader("To");k=u=0;d=d||null;e=e||null;if(!d||100>d||699<d)throw new TypeError("Invalid status_code: "+
d);if(e&&"string"!==typeof e&&!(e instanceof String))throw new TypeError("Invalid reason_phrase: "+e);e=e||b.C.REASON_PHRASE[d]||"";f=f||[];e="SIP/2.0 "+d+" "+e+"\r\n";if(this.method===b.C.INVITE&&100<d&&200>=d){n=this.countHeader("record-route");for(u;u<n;u++)e+="Record-Route: "+this.getHeader("record-route",u)+"\r\n"}u=this.countHeader("via");for(k;k<u;k++)e+="Via: "+this.getHeader("via",k)+"\r\n";this.to_tag?this.to_tag&&!this.s("to").hasParam("tag")&&(r+=";tag="+this.to_tag):r+=";tag="+b.Utils.newTag();
e=e+("To: "+r+"\r\n")+("From: "+this.getHeader("From")+"\r\n");e+="Call-ID: "+this.call_id+"\r\n";e+="CSeq: "+this.cseq+" "+this.method+"\r\n";r=f.length;for(k=0;k<r;k++)e+=f[k]+"\r\n";e+="Supported: "+b.UA.C.SUPPORTED+"\r\n";i?(r=b.Utils.str_utf8_length(i),e=e+"Content-Type: application/sdp\r\n"+("Content-Length: "+r+"\r\n\r\n")+i):e+="Content-Length: 0\r\n\r\n";this.server_transaction.receiveResponse(d,e,g,v)};f.prototype.reply_sl=function(d,e){var f,i;f=this.countHeader("via");d=d||null;e=e||null;
if(!d||100>d||699<d)throw new TypeError("Invalid status_code: "+d);if(e&&"string"!==typeof e&&!(e instanceof String))throw new TypeError("Invalid reason_phrase: "+e);e=e||b.C.REASON_PHRASE[d]||"";i="SIP/2.0 "+d+" "+e+"\r\n";for(var g=0;g<f;g++)i+="Via: "+this.getHeader("via",g)+"\r\n";f=this.getHeader("To");this.to_tag?this.to_tag&&!this.s("to").hasParam("tag")&&(f+=";tag="+this.to_tag):f+=";tag="+b.Utils.newTag();i=i+("To: "+f+"\r\n")+("From: "+this.getHeader("From")+"\r\n");i+="Call-ID: "+this.call_id+
"\r\n";i+="CSeq: "+this.cseq+" "+this.method+"\r\n";this.transport.send(i+"Content-Length: 0\r\n\r\n")};e=function(){this.headers={};this.reason_phrase=this.status_code=null};e.prototype=new d;b.OutgoingRequest=g;b.IncomingRequest=f;b.IncomingResponse=e})(k);(function(b){var g;g=function(d,f,e,i,g,z){var l,C;if(!e)throw new TypeError('missing or invalid "host" parameter');d=d||b.C.SIP;this.parameters={};this.headers={};for(l in g)this.setParam(l,g[l]);for(C in z)this.setHeader(C,z[C]);Object.defineProperties(this,
{scheme:{get:function(){return d},set:function(b){d=b.toLowerCase()}},user:{get:function(){return f},set:function(b){f=b}},host:{get:function(){return e},set:function(b){e=b.toLowerCase()}},port:{get:function(){return i},set:function(b){i=0===b?b:parseInt(b,10)||null}}})};g.prototype={setParam:function(b,f){b&&(this.parameters[b.toLowerCase()]="undefined"===typeof f||null===f?null:f.toString().toLowerCase())},getParam:function(b){if(b)return this.parameters[b.toLowerCase()]},hasParam:function(b){if(b)return this.parameters.hasOwnProperty(b.toLowerCase())&&
!0||!1},deleteParam:function(b){var f,b=b.toLowerCase();if(this.parameters.hasOwnProperty(b))return f=this.parameters[b],delete this.parameters[b],f},clearParams:function(){this.parameters={}},setHeader:function(d,f){this.headers[b.Utils.headerize(d)]=f instanceof Array?f:[f]},getHeader:function(d){if(d)return this.headers[b.Utils.headerize(d)]},hasHeader:function(d){if(d)return this.headers.hasOwnProperty(b.Utils.headerize(d))&&!0||!1},deleteHeader:function(d){var f,d=b.Utils.headerize(d);if(this.headers.hasOwnProperty(d))return f=
this.headers[d],delete this.headers[d],f},clearHeaders:function(){this.headers={}},clone:function(){return new g(this.scheme,this.user,this.host,this.port,m.JSON.parse(m.JSON.stringify(this.parameters)),m.JSON.parse(m.JSON.stringify(this.headers)))},toString:function(){var d,f,e,i,g=[];i=this.scheme+":";this.user&&(i+=b.Utils.escapeUser(this.user)+"@");i+=this.host;if(this.port||0===this.port)i+=":"+this.port;for(f in this.parameters)i+=";"+f,null!==this.parameters[f]&&(i+="="+this.parameters[f]);
for(d in this.headers)for(e in this.headers[d])g.push(d+"="+this.headers[d][e]);0<g.length&&(i+="?"+g.join("&"));return i},toAor:function(d){var f;f=this.scheme+":";this.user&&(f+=b.Utils.escapeUser(this.user)+"@");f+=this.host;if(d&&(this.port||0===this.port))f+=":"+this.port;return f}};g.parse=function(d){d=b.Grammar.parse(d,"SIP_URI");if(-1!==d)return d};b.URI=g})(k);(function(b){var g;g=function(d,f,e){var i;if(!d||!(d instanceof b.URI))throw new TypeError('missing or invalid "uri" parameter');
this.uri=d;this.parameters={};for(i in e)this.setParam(i,e[i]);Object.defineProperties(this,{display_name:{get:function(){return f},set:function(b){f=0===b?"0":b}}})};g.prototype={setParam:function(b,f){b&&(this.parameters[b.toLowerCase()]="undefined"===typeof f||null===f?null:f.toString())},getParam:function(b){if(b)return this.parameters[b.toLowerCase()]},hasParam:function(b){if(b)return this.parameters.hasOwnProperty(b.toLowerCase())&&!0||!1},deleteParam:function(b){var f,b=b.toLowerCase();if(this.parameters.hasOwnProperty(b))return f=
this.parameters[b],delete this.parameters[b],f},clearParams:function(){this.parameters={}},clone:function(){return new g(this.uri.clone(),this.display_name,m.JSON.parse(m.JSON.stringify(this.parameters)))},toString:function(){var b,f;b=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"";b+="<"+this.uri.toString()+">";for(f in this.parameters)b+=";"+f,null!==this.parameters[f]&&(b+="="+this.parameters[f]);return b}};g.parse=function(d){d=b.Grammar.parse(d,"Name_Addr_Header");if(-1!==
d)return d};b.NameAddrHeader=g})(k);(function(b){var g,d=b.name+" | TRANSACTION | ",f={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7};g={};var e=function(){this.init=function(b,d,e){this.transport=e;this.id="z9hG4bK"+Math.floor(1E7*Math.random());this.request_sender=b;this.request=d;d="SIP/2.0/"+(b.ua.configuration.hack_via_tcp?"TCP":e.server.scheme);d+=" "+b.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",
d)}},i=function(){this.send=function(){var d=this;this.state=f.STATUS_TRYING;this.F=m.setTimeout(function(){d.timer_F()},b.Timers.TIMER_F);if(!this.transport.send(this.request))this.onTransportError()};this.onTransportError=function(){console.log(d+"transport error occurred, deleting non-INVITE client transaction "+this.id);m.clearTimeout(this.F);m.clearTimeout(this.K);delete this.request_sender.ua.transactions.nict[this.id];this.request_sender.onTransportError()};this.timer_F=function(){console.log(d+
"Timer F expired for non-INVITE client transaction "+this.id);this.state=f.STATUS_TERMINATED;this.request_sender.onRequestTimeout();delete this.request_sender.ua.transactions.nict[this.id]};this.timer_K=function(){this.state=f.STATUS_TERMINATED;delete this.request_sender.ua.transactions.nict[this.id]};this.receiveResponse=function(d){var e=this,i=d.status_code;if(200>i)switch(this.state){case f.STATUS_TRYING:case f.STATUS_PROCEEDING:this.state=f.STATUS_PROCEEDING,this.request_sender.receiveResponse(d)}else switch(this.state){case f.STATUS_TRYING:case f.STATUS_PROCEEDING:this.state=
f.STATUS_COMPLETED;m.clearTimeout(this.F);if(408===i)this.request_sender.onRequestTimeout();else this.request_sender.receiveResponse(d);this.K=m.setTimeout(function(){e.timer_K()},b.Timers.TIMER_K)}}};i.prototype=new e;var o=function(){this.send=function(){var d=this;this.state=f.STATUS_CALLING;this.B=m.setTimeout(function(){d.timer_B()},b.Timers.TIMER_B);if(!this.transport.send(this.request))this.onTransportError()};this.onTransportError=function(){console.log(d+"transport error occurred, deleting INVITE client transaction "+
this.id);m.clearTimeout(this.B);m.clearTimeout(this.D);m.clearTimeout(this.M);delete this.request_sender.ua.transactions.ict[this.id];this.request_sender.onTransportError()};this.timer_M=function(){console.log(d+"Timer M expired for INVITE client transaction "+this.id);this.state===f.STATUS_ACCEPTED&&(this.state=f.STATUS_TERMINATED,m.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id])};this.timer_B=function(){console.log(d+"Timer B expired for INVITE client transaction "+
this.id);this.state===f.STATUS_CALLING&&(this.state=f.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.ict[this.id])};this.timer_D=function(){console.log(d+"Timer D expired for INVITE client transaction "+this.id);this.state=f.STATUS_TERMINATED;m.clearTimeout(this.B);delete this.request_sender.ua.transactions.ict[this.id]};this.sendACK=function(d){var e=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n";this.ack+="Via: "+this.request.headers.Via.toString()+
"\r\n";this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n");this.ack+="To: "+d.getHeader("to")+"\r\n";this.ack+="From: "+this.request.headers.From.toString()+"\r\n";this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n";this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0];this.ack+=" ACK\r\n\r\n";this.D=m.setTimeout(function(){e.timer_D()},b.Timers.TIMER_D);this.transport.send(this.ack)};this.cancel_request=function(d,e){var i=
d.request;this.cancel=b.C.CANCEL+" "+i.ruri+" SIP/2.0\r\n";this.cancel+="Via: "+i.headers.Via.toString()+"\r\n";this.request.headers.Route&&(this.cancel+="Route: "+i.headers.Route.toString()+"\r\n");this.cancel+="To: "+i.headers.To.toString()+"\r\n";this.cancel+="From: "+i.headers.From.toString()+"\r\n";this.cancel+="Call-ID: "+i.headers["Call-ID"].toString()+"\r\n";this.cancel+="CSeq: "+i.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n";e&&(this.cancel+="Reason: "+e+"\r\n");this.cancel+="Content-Length: 0\r\n\r\n";
this.state===f.STATUS_PROCEEDING&&this.transport.send(this.cancel)};this.receiveResponse=function(d){var e=this,i=d.status_code;if(100<=i&&199>=i)switch(this.state){case f.STATUS_CALLING:this.state=f.STATUS_PROCEEDING;this.request_sender.receiveResponse(d);this.cancel&&this.transport.send(this.cancel);break;case f.STATUS_PROCEEDING:this.request_sender.receiveResponse(d)}else if(200<=i&&299>=i)switch(this.state){case f.STATUS_CALLING:case f.STATUS_PROCEEDING:this.state=f.STATUS_ACCEPTED;this.M=m.setTimeout(function(){e.timer_M()},
b.Timers.TIMER_M);this.request_sender.receiveResponse(d);break;case f.STATUS_ACCEPTED:this.request_sender.receiveResponse(d)}else if(300<=i&&699>=i)switch(this.state){case f.STATUS_CALLING:case f.STATUS_PROCEEDING:this.state=f.STATUS_COMPLETED;this.sendACK(d);this.request_sender.receiveResponse(d);break;case f.STATUS_COMPLETED:this.sendACK(d)}}};o.prototype=new e;var e=function(){this.init=function(b,d){this.id=b.via_branch;this.request=b;this.transport=b.transport;this.ua=d;this.last_response="";
b.server_transaction=this}},z=function(){this.timer_J=function(){console.log(d+"Timer J expired for non-INVITE server transaction "+this.id);this.state=f.STATUS_TERMINATED;delete this.ua.transactions.nist[this.id]};this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(d+"transport error occurred, deleting non-INVITE server transaction "+this.id),m.clearTimeout(this.J),delete this.ua.transactions.nist[this.id])};this.receiveResponse=function(d,e,i,g){var l=this;
if(100===d)switch(this.state){case f.STATUS_TRYING:this.state=f.STATUS_PROCEEDING;if(!this.transport.send(e))this.onTransportError();break;case f.STATUS_PROCEEDING:this.last_response=e,this.transport.send(e)?i&&i():(this.onTransportError(),g&&g())}else if(200<=d&&699>=d)switch(this.state){case f.STATUS_TRYING:case f.STATUS_PROCEEDING:this.state=f.STATUS_COMPLETED,this.last_response=e,this.J=m.setTimeout(function(){l.timer_J()},b.Timers.TIMER_J),this.transport.send(e)?i&&i():(this.onTransportError(),
g&&g())}}};z.prototype=new e;var l=function(){this.timer_H=function(){console.log(d+"Timer H expired for INVITE server transaction "+this.id);this.state===f.STATUS_COMPLETED&&(console.warn(d+"transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.state=f.STATUS_TERMINATED);delete this.ua.transactions.ist[this.id]};this.timer_I=function(){this.state=f.STATUS_TERMINATED;delete this.ua.transactions.ist[this.id]};this.timer_L=function(){console.log(d+"Timer L expired for INVITE server transaction "+
this.id);this.state===f.STATUS_ACCEPTED&&(this.state=f.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id])};this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(d+"transport error occurred, deleting INVITE server transaction "+this.id),m.clearTimeout(this.reliableProvisionalTimer),m.clearTimeout(this.L),m.clearTimeout(this.H),m.clearTimeout(this.I),delete this.ua.transactions.ist[this.id])};this.timer_reliableProvisional=function(d){var e=this,f=this.last_response,
i=b.Timers.T1*Math.pow(2,d+1);if(8<d)m.clearTimeout(this.reliableProvisionalTimer);else{d+=1;if(!this.transport.send(f))this.onTransportError();this.reliableProvisionalTimer=m.setTimeout(function(){e.timer_reliableProvisional(d)},i)}};this.receiveResponse=function(d,e,i,g){var l=this;if(100<=d&&199>=d)switch(this.state){case f.STATUS_PROCEEDING:if(!this.transport.send(e))this.onTransportError();this.last_response=e}if(!(100<d&&199>=d))if(200<=d&&299>=d)switch(this.state){case f.STATUS_PROCEEDING:this.state=
f.STATUS_ACCEPTED,this.last_response=e,this.L=m.setTimeout(function(){l.timer_L()},b.Timers.TIMER_L),m.clearTimeout(this.reliableProvisionalTimer);case f.STATUS_ACCEPTED:this.transport.send(e)?i&&i():(this.onTransportError(),g&&g())}else if(300<=d&&699>=d)switch(this.state){case f.STATUS_PROCEEDING:m.clearTimeout(this.reliableProvisionalTimer),this.transport.send(e)?(this.state=f.STATUS_COMPLETED,this.H=m.setTimeout(function(){l.timer_H()},b.Timers.TIMER_H),i&&i()):(this.onTransportError(),g&&g())}}};
l.prototype=new e;g.NonInviteClientTransaction=function(b,d,e){this.init(b,d,e);this.request_sender.ua.transactions.nict[this.id]=this};g.NonInviteClientTransaction.prototype=new i;g.InviteClientTransaction=function(b,d,e){var f=this;this.init(b,d,e);this.request_sender.ua.transactions.ict[this.id]=this;this.request.cancel=function(b){f.cancel_request(f,b)}};g.InviteClientTransaction.prototype=new o;g.AckClientTransaction=function(b,d,e){this.init(b,d,e);this.send=function(){this.transport.send(d)}};
g.AckClientTransaction.prototype=new i;g.NonInviteServerTransaction=function(b,d){this.init(b,d);this.state=f.STATUS_TRYING;d.transactions.nist[this.id]=this};g.NonInviteServerTransaction.prototype=new z;g.InviteServerTransaction=function(b,d){this.init(b,d);this.state=f.STATUS_PROCEEDING;d.transactions.ist[this.id]=this;this.reliableProvisionalTimer=null;b.reply(100)};g.InviteServerTransaction.prototype=new l;g.checkTransaction=function(d,e){var i;switch(e.method){case b.C.INVITE:if(i=d.transactions.ist[e.via_branch]){switch(i.state){case f.STATUS_PROCEEDING:i.transport.send(i.last_response)}return!0}break;
case b.C.ACK:if(i=d.transactions.ist[e.via_branch]){if(i.state===f.STATUS_ACCEPTED)return!1;if(i.state===f.STATUS_COMPLETED)return i.state=f.STATUS_CONFIRMED,i.I=m.setTimeout(function(){i.timer_I()},b.Timers.TIMER_I),!0}else return!1;break;case b.C.CANCEL:if(i=d.transactions.ist[e.via_branch])return i.state===f.STATUS_PROCEEDING?!1:!0;e.reply_sl(481);return!0;default:if(i=d.transactions.nist[e.via_branch]){switch(i.state){case f.STATUS_PROCEEDING:case f.STATUS_COMPLETED:i.transport.send(i.last_response)}return!0}}};
g.C=f;b.Transactions=g})(k);(function(b){var g,d=b.name+" | DIALOG | ",f={STATUS_EARLY:1,STATUS_CONFIRMED:2};g=function(e,i,g,z){var l;if(!i.hasHeader("contact"))return console.error(d+"unable to create a Dialog without Contact header field"),!1;z=i instanceof b.IncomingResponse?200>i.status_code?f.STATUS_EARLY:f.STATUS_CONFIRMED:z||f.STATUS_CONFIRMED;l=i.parseHeader("contact");"UAS"===g?(this.id={call_id:i.call_id,local_tag:i.to_tag,remote_tag:i.from_tag,toString:function(){return this.call_id+this.local_tag+
this.remote_tag}},this.state=z,this.remote_seqnum=i.cseq,this.local_uri=i.parseHeader("to").uri,this.remote_uri=i.parseHeader("from").uri,this.remote_target=l.uri,this.route_set=i.getHeaderAll("record-route")):"UAC"===g&&(this.id={call_id:i.call_id,local_tag:i.from_tag,remote_tag:i.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=z,this.local_seqnum=i.cseq,this.local_uri=i.parseHeader("from").uri,this.remote_uri=i.parseHeader("to").uri,this.remote_target=
l.uri,this.route_set=i.getHeaderAll("record-route").reverse());this.session=e;e.ua.dialogs[this.id.toString()]=this;console.log(d+"new "+g+" dialog created with status "+(this.state===f.STATUS_EARLY?"EARLY":"CONFIRMED"))};g.prototype={update:function(b,i){this.state=f.STATUS_CONFIRMED;console.log(d+"dialog "+this.id.toString()+"  changed to CONFIRMED state");"UAC"===i&&(this.route_set=b.getHeaderAll("record-route").reverse())},terminate:function(){console.log(d+"dialog "+this.id.toString()+" deleted");
delete this.session.ua.dialogs[this.id.toString()]},createRequest:function(d,f){var g,f=f||[];this.local_seqnum||(this.local_seqnum=Math.floor(1E4*Math.random()));g=d===b.C.CANCEL||d===b.C.ACK?this.local_seqnum:this.local_seqnum+=1;g=new b.OutgoingRequest(d,this.remote_target,this.session.ua,{cseq:g,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},f);g.dialog=this;return g},checkInDialogRequest:function(d){this.remote_seqnum?
d.cseq>this.remote_seqnum&&(this.remote_seqnum=d.cseq):this.remote_seqnum=d.cseq;switch(d.method){case b.C.INVITE:if(d.cseq<this.remote_seqnum){if(this.state===f.STATUS_EARLY){var i=(10*Math.random()|0)+1;d.reply(500,null,["Retry-After:"+i])}else d.reply(500);return!1}if(this.session&&this.session.isMcu)break;if(this.state===f.STATUS_EARLY)return d.reply(491),!1;d.hasHeader("contact")&&(this.remote_target=d.parseHeader("contact").uri);break;case b.C.NOTIFY:d.hasHeader("contact")&&(this.remote_target=
d.parseHeader("contact").uri)}return!0},receiveRequest:function(b){this.checkInDialogRequest(b)&&this.session.receiveRequest(b)}};g.C=f;b.Dialog=g})(k);(function(b){var g,d=b.name+" | REQUEST SENDER | ";g=function(d,e){this.ua=e;this.applicant=d;this.method=d.request.method;this.request=d.request;this.credentials=null;this.staled=this.challenged=!1;if(e.status===b.UA.C.STATUS_USER_CLOSED&&(this.method!==b.C.BYE||this.method!==b.C.ACK))this.onTransportError()};g.prototype={send:function(){switch(this.method){case "INVITE":this.clientTransaction=
new b.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case "ACK":this.clientTransaction=new b.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new b.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(f){var e,
i;i=f.status_code;(401===i||407===i)&&null!==this.ua.configuration.password?(401===f.status_code?(e=f.parseHeader("www-authenticate"),i="authorization"):(e=f.parseHeader("proxy-authenticate"),i="proxy-authorization"),e)?!this.challenged||!this.staled&&!0===e.stale?(this.credentials||(this.credentials=new b.DigestAuthentication(this.ua)),this.credentials.authenticate(this.request,e))?(this.challenged=!0,e.stale&&(this.staled=!0),f.method===b.C.REGISTER?f=this.applicant.cseq+=1:this.request.dialog?
f=this.request.dialog.local_seqnum+=1:(f=this.request.cseq+1,this.request.cseq=f),this.request.setHeader("cseq",f+" "+this.method),this.request.setHeader(i,this.credentials.toString()),this.send()):this.applicant.receiveResponse(f):this.applicant.receiveResponse(f):(console.warn(d+f.status_code+" with wrong or missing challenge, cannot authenticate"),this.applicant.receiveResponse(f)):this.applicant.receiveResponse(f)}};b.RequestSender=g})(k);(function(b){var g;g=function(b){this.applicant=b;this.request=
b.request};g.prototype={send:function(){(new b.RequestSender(this,this.applicant.session.ua)).send()},onRequestTimeout:function(){this.applicant.session.onRequestTimeout();this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.session.onTransportError();this.applicant.onTransportError()},receiveResponse:function(d){(408===d.status_code||481===d.status_code)&&this.applicant.session.ended("remote",d,b.C.causes.DIALOG_ERROR);this.applicant.receiveResponse(d)}};b.InDialogRequestSender=
g})(k);(function(b){var g,d=b.name+" | REGISTRATOR | ";g=function(d,e){this.ua=d;this.transport=e;this.registrar=d.configuration.registrar_server;this.expires=d.configuration.register_expires;this.min_expires=d.configuration.register_min_expires;this.call_id=b.Utils.createRandomToken(22);this.cseq=80;this.to_uri=d.configuration.uri;this.registrationTimer=null;this.registered=this.registered_before=!1;this.ua.registrator=this;this.contact=this.ua.contact.toString();this.contact+=";reg-id=1";this.contact+=
';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"'};g.prototype={register:function(f){var e,i=this,f=f||{},f=f.extraHeaders||[];f.push("Contact: "+this.contact+";expires="+this.expires);f.push("Allow: "+b.Utils.getAllowedMethods(this.ua));this.request=new b.OutgoingRequest(b.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},f);f=new b.RequestSender(this,this.ua);this.receiveResponse=function(f){var g,l,C=f.countHeader("contact");if(f.cseq===
this.cseq)switch(!0){case /^1[0-9]{2}$/.test(f.status_code):break;case /^2[0-9]{2}$/.test(f.status_code):f.hasHeader("expires")&&(l=f.getHeader("expires"));if(!C){console.warn(d+"no Contact header in response to REGISTER, response ignored");break}for(;C--;)if(g=f.parseHeader("contact",C),g.uri.user===this.ua.contact.uri.user){l=g.getParam("expires");break}else g=null;if(!g){console.warn(d+"no Contact header pointing to us, response ignored");break}l||(l=this.expires);this.registrationTimer=m.setTimeout(function(){i.register()},
1E3*l-3E3);g.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=g.getParam("temp-gruu").replace(/"/g,""));g.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=g.getParam("pub-gruu").replace(/"/g,""));this.registered=!0;this.ua.emit("registered",this.ua,{response:f});break;case /^423$/.test(f.status_code):f.hasHeader("min-expires")?(f=f.getHeader("min-expires"),l=f-this.expires,this.registrationTimer=m.setTimeout(function(){i.register()},1E3*this.expires)):(console.warn(d+"423 response received for REGISTER without Min-Expires"),
this.registrationFailure(f,b.C.causes.SIP_FAILURE_CODE));break;default:e=b.Utils.sipErrorCause(f.status_code),this.registrationFailure(f,e)}};this.onRequestTimeout=function(){this.registrationFailure(null,b.C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){this.registrationFailure(null,b.C.causes.CONNECTION_ERROR)};f.send()},unregister:function(f){var e;this.registered?(f=f||{},e=f.extraHeaders||[],this.registered=!1,m.clearTimeout(this.registrationTimer),f.all?(e.push("Contact: *"),e.push("Expires: 0")):
e.push("Contact: "+this.contact+";expires=0"),this.request=new b.OutgoingRequest(b.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},e),f=new b.RequestSender(this,this.ua),this.receiveResponse=function(d){var e;switch(true){case /^1[0-9]{2}$/.test(d.status_code):break;case /^2[0-9]{2}$/.test(d.status_code):this.unregistered(d);break;default:e=b.Utils.sipErrorCause(d.status_code);this.unregistered(d,e)}},this.onRequestTimeout=function(){this.unregistered(null,
b.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,b.C.causes.CONNECTION_ERROR)},f.send()):console.warn(d+"already unregistered")},registrationFailure:function(b,d){this.ua.emit("registrationFailed",this.ua,{response:b||null,cause:d});this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua,{response:b||null,cause:d}))},unregistered:function(b,d){this.registered=!1;this.ua.emit("unregistered",this.ua,{response:b||null,cause:d||null})},onTransportClosed:function(){this.registered_before=
this.registered;m.clearTimeout(this.registrationTimer);this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua))},onTransportConnected:function(){this.register()},close:function(){this.registered_before=this.registered;this.unregister()}};b.Registrator=g})(k);(function(b){var g=function(b){var d=function(d,e){this.applicant=d;this.request=e||d.request;this.session=d instanceof b.RTCSession?d:d.session;this.reattempt=!1;this.reatemptTimer=null;this.request_sender=new b.InDialogRequestSender(this)};
d.prototype={receiveResponse:function(d){var e=this,f=d.status_code;d.method===b.C.INVITE&&491===f?this.reattempt?this.applicant.receiveResponse(d):(this.request.cseq.value=this.request.dialog.local_seqnum+=1,this.reatemptTimer=m.setTimeout(function(){e.session.status!==b.RTCSession.C.STATUS_TERMINATED&&(e.reattempt=!0,e.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(d)},send:function(){this.request_sender.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},
onTransportError:function(){this.applicant.onTransportError()},getReattemptTimeout:function(){return"outgoing"===this.session.direction?(1.9*Math.random()+2.1).toFixed(2):(2*Math.random()).toFixed(2)}};return d}(b),d=function(b){var d=function(b,d){d=d||{};this.session=b;this.peerConnection=this.localMedia=null;this.init(d)};d.prototype={createOffer:function(b,d,e){var f=this,g=!1;f.offerMediaOptions=e;this.onIceCompleted=function(){g||(g=!0,f.offerMediaOptions?b(f.mSdp):b(f.peerConnection.localDescription.sdp),
console.log("peerConnetcion.localDescription"))};this.peerConnection.createOffer(function(b){f.setLocalDescription(b,d)},function(b){console.error(i+"unable to create offer");console.error(b);d()})},createAnswer:function(b,d){var e=this,f=!1;this.onIceCompleted=function(){f||(f=!0,b(e.peerConnection.localDescription.sdp))};this.peerConnection.createAnswer(function(b){e.setRemoteDescription(b,d)},function(b){console.error(i+"unable to create answer");console.error(b);d()})},setLocalDescription:function(b,
d){if(this.offerMediaOptions&&this.offerMediaOptions.video.width&&this.offerMediaOptions.video.height&&-1!=b.sdp.search("VP[89]")){var e=b.sdp.replace(/(a=rtpmap:(\d*) VP[89]\/90000\r\n)/,"$1a=fmtp:$2 max-fr="+this.offerMediaOptions.video.framerate+"; max-fs="+this.offerMediaOptions.video.width*this.offerMediaOptions.video.height/256+"\r\n");this.mSdp=b.sdp=e}this.peerConnection.setLocalDescription(b,function(){console.log("Set localDscription success")},function(b){console.error(i+"unable to set local description");
console.error(b);d()})},setRemoteDescription:function(b,d){this.peerConnection.setLocalDescription(b,function(){console.log("Create Answer")},function(b){console.error(i+"unable to set remote description");console.error(b);d()})},addStream:function(b,d,e){try{this.peerConnection.addStream(b)}catch(f){console.error(i+"error adding stream");console.error(f);e();return}d()},init:function(d){function e(b){for(var d in b)b.hasOwnProperty(d)&&("object"==typeof b[d]?(console.log("gll 20140725"+d+":(value is the object below)\n"),
e(b[d])):console.log("gll 20140725:"+d+":"+b[d]))}function f(b){for(var d in b)"array"==typeof b[d]||"object"==typeof b[d]?f(b[d]):console.log(d+"="+b[d]+"\n")}var g,l,o,k,m=this,x=[];for(g in this.session.ua.configuration.stun_servers)l=this.session.ua.configuration.stun_servers[g],k=l.server,o=k.substr(0,k.indexOf(":")),x.push({url:o+":"+l.username+"@"+k.substr(o.length+1),credential:l.password});for(g in this.session.ua.configuration.turn_servers)l=this.session.ua.configuration.turn_servers[g],
k=l.server,o=k.substr(0,k.indexOf(":")),x.push({url:o+":"+l.username+"@"+k.substr(o.length+1),credential:l.password});e(d);f(x);this.peerConnection="undefined"!==typeof mozRTCPeerConnection?new b.WebRTC.RTCPeerConnection(x,d):new b.WebRTC.RTCPeerConnection({iceServers:x},d);this.peerConnection.onaddstream=function(b){console.log(i+"stream added: "+b.stream.id)};this.peerConnection.onremovestream=function(b){console.log(i+"stream removed: "+b.stream.id)};this.peerConnection.onicecandidate=function(b){console.log("e.candidate:"+
b.candidate);if(b.candidate)console.log(i+"ICE candidate received: "+b.candidate.candidate);else m.onIceCompleted()};this.peerConnection.ongatheringchange=function(b){if("complete"===b.currentTarget.iceGatheringState&&"closed"!==this.iceConnectionState)m.onIceCompleted()};this.peerConnection.onicechange=function(){console.log(i+'ICE connection state changed to "'+this.iceConnectionState+'"')};this.peerConnection.onstatechange=function(){console.log(i+'PeerConnection state changed to "'+this.readyState+
'"')}},close:function(){console.log(i+"closing PeerConnection");this.peerConnection&&(this.peerConnection.close(),this.localMedia&&this.localMedia.stop())},getUserMedia:function(d,e,f){var g=this;console.log(i+"requesting access to local media");b.WebRTC.getUserMedia(f,function(b){console.log(i+"got local media stream");g.localMedia=b;d(b)},function(b){console.error(i+"unable to get user media");console.error(b);e()})},onMessage:function(d,e,f,i){this.peerConnection.setRemoteDescription(new b.WebRTC.RTCSessionDescription({type:d,
sdp:e}),f,i)}};return d}(b),f=function(b){var d,e={MIN_DURATION:70,MAX_DURATION:6E3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};d=function(b){this.session=b;this.duration=this.tone=this.direction=null;this.initEvents(["succeeded","failed"])};d.prototype=new b.EventEmitter;d.prototype.send=function(d,f){var l,o,k;if(void 0===d)throw new TypeError("Not enough arguments");this.direction="outgoing";if(this.session.status!==b.RTCSession.C.STATUS_CONFIRMED&&this.session.status!==
b.RTCSession.C.STATUS_WAITING_FOR_ACK)throw new b.Exceptions.InvalidStateError(this.session.status);f=f||{};k=f.extraHeaders?f.extraHeaders.slice():[];o=f.eventHandlers||{};if("string"===typeof d)d=d.toUpperCase();else if("number"===typeof d)d=d.toString();else throw new TypeError("Invalid tone: "+d);if(d.match(/^[0-9A-D#*]$/))this.tone=d;else throw new TypeError("Invalid tone: "+d);if(f.duration&&!b.Utils.isDecimal(f.duration))throw new TypeError("Invalid tone duration: "+f.duration);f.duration?
f.duration<e.MIN_DURATION?(console.warn(i+'"duration" value is lower than the minimum allowed, setting it to '+e.MIN_DURATION+" milliseconds"),f.duration=e.MIN_DURATION):f.duration>e.MAX_DURATION?(console.warn(i+'"duration" value is greater than the maximum allowed, setting it to '+e.MAX_DURATION+" milliseconds"),f.duration=e.MAX_DURATION):f.duration=Math.abs(f.duration):f.duration=e.DEFAULT_DURATION;this.duration=f.duration;for(l in o)this.on(l,o[l]);k.push("Content-Type: application/dtmf-relay");
this.request=this.session.dialog.createRequest(b.C.INFO,k);this.request.body="Signal= "+this.tone+"\r\n";this.request.body+="Duration= "+this.duration;l=new g(this);this.session.emit("newDTMF",this.session,{originator:"local",dtmf:this,request:this.request});l.send()};d.prototype.receiveResponse=function(d){var e;switch(!0){case /^1[0-9]{2}$/.test(d.status_code):break;case /^2[0-9]{2}$/.test(d.status_code):this.emit("succeeded",this,{originator:"remote",response:d});break;default:e=b.Utils.sipErrorCause(d.status_code),
this.emit("failed",this,{originator:"remote",response:d,cause:e})}};d.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:b.C.causes.REQUEST_TIMEOUT})};d.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:b.C.causes.CONNECTION_ERROR})};d.prototype.init_incoming=function(b){var d,e=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,f=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming";this.request=b;b.reply(200);if(b.body&&
(d=b.body.split("\r\n"),2===d.length&&(e.test(d[0])&&(this.tone=d[0].replace(e,"$2")),f.test(d[1]))))this.duration=parseInt(d[1].replace(f,"$2"),10);!this.tone||!this.duration?console.warn(i+"invalid INFO DTMF received, discarded"):this.session.emit("newDTMF",this.session,{originator:"remote",dtmf:this,request:b})};d.C=e;return d}(b),e,i=b.name+" | RTC SESSION | ",o={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_WAITING_FOR_ACK:5,
STATUS_CANCELED:6,STATUS_TERMINATED:7,STATUS_CONFIRMED:8};e=function(b){this.ua=b;this.status=o.STATUS_NULL;this.dialog=null;this.earlyDialogs=[];this.rtcMediaHandler=null;this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,updateTimer:null};this.end_time=this.start_time=this.remote_identity=this.local_identity=this.direction=null;this.data={};this.initEvents("progress,failed,started,ended,newDTMF,startRecord,endRecord".split(","))};e.prototype=new b.EventEmitter;
e.prototype.terminate=function(d){var d=d||{},e,f=d.status_code,g=d.reason_phrase,k=d.extraHeaders||[],m=d.body;if(this.status===o.STATUS_TERMINATED)throw new b.Exceptions.InvalidStateError(this.status);switch(this.status){case o.STATUS_NULL:case o.STATUS_INVITE_SENT:case o.STATUS_1XX_RECEIVED:console.log(i+"canceling RTCSession");if(f&&(200>f||700<=f))throw new TypeError("Invalid status_code: "+f);f&&(g=g||b.C.REASON_PHRASE[f]||"",e="SIP ;cause="+f+' ;text="'+g+'"');this.status===o.STATUS_NULL?(this.isCanceled=
!0,this.cancelReason=e):this.status===o.STATUS_INVITE_SENT?this.received_100?this.request.cancel(e):(this.isCanceled=!0,this.cancelReason=e):this.status===o.STATUS_1XX_RECEIVED&&this.request.cancel(e);this.failed("local",null,b.C.causes.CANCELED);break;case o.STATUS_WAITING_FOR_ANSWER:console.log(i+"rejecting RTCSession");f=f||603;if(300>f||700<=f)throw new TypeError("Invalid status_code: "+f);this.request.reply(f,g,k,m);this.failed("local",null,b.C.causes.REJECTED);break;case o.STATUS_WAITING_FOR_ACK:case o.STATUS_CONFIRMED:console.log(i+
"terminating RTCSession"),this.sendBye(d),this.ended("local",null,b.C.causes.BYE)}d.unNormal&&!0==d.unNormal&&this.ua.unregister();this.close()};e.prototype.answer=function(d){var d=d||{},e=this,f=this.request,g=d.extraHeaders||[],k=d.mediaConstraints||{audio:!0,video:!0},n=function(){e.isMcu?"video"==e.roomInfo.remoteMedia&&k.video?e.rtcMediaHandler.createOffer(r,w,{audio:{},video:{width:640,height:480,framerate:30}}):e.rtcMediaHandler.createOffer(r,w):e.rtcMediaHandler.createAnswer(r,w,k)},u=function(){e.status!==
o.STATUS_TERMINATED&&e.failed("local",null,b.C.causes.WEBRTC_ERROR)},r=function(d){g.push("Contact: "+e.contact);g.push("Session-Expires:"+b.Timers.TIMER_N+";refresher=uac");g.push("Allow: "+b.Utils.getAllowedMethods(e.ua));f.reply(200,null,g,d,function(){e.status=o.STATUS_WAITING_FOR_ACK;e.timers.invite2xxTimer=m.setTimeout(function t(i){var i=i||1,g=b.Timers.T1*Math.pow(2,i);i*b.Timers.T1<=b.Timers.T2?(i+=1,f.reply(200,null,["Contact: "+e.contact],d),e.timers.invite2xxTimer=m.setTimeout(t(i),g)):
m.clearTimeout(e.timers.invite2xxTimer)},b.Timers.T1);e.timers.ackTimer=m.setTimeout(function(){e.status===o.STATUS_WAITING_FOR_ACK&&(console.log(i+"no ACK received, terminating the call"),m.clearTimeout(e.timers.invite2xxTimer),e.sendBye(),e.ended("remote",null,b.C.causes.NO_ACK))},b.Timers.TIMER_H);e.started("local")},function(){e.failed("system",null,b.C.causes.CONNECTION_ERROR)})},w=function(){e.status!==o.STATUS_TERMINATED&&e.failed("local",null,b.C.causes.WEBRTC_ERROR)};if("incoming"!==this.direction)throw new TypeError('Invalid method "answer" for an outgoing call');
if(this.status!==o.STATUS_WAITING_FOR_ANSWER)throw new b.Exceptions.InvalidStateError(this.status);this.createDialog(f,"UAS")?(m.clearTimeout(this.timers.userNoAnswerTimer),this.rtcMediaHandler.getUserMedia(function(b){e.rtcMediaHandler.addStream(b,n,u)},function(){f.reply(480);e.failed("local",null,b.C.causes.USER_DENIED_MEDIA_ACCESS)},k)):f.reply(500,"Missing Contact header field")};e.prototype.sendDTMF=function(d,e){function g(){var b,i=new f(u);i.on("failed",function(){r=!1});b=d[n];n+=1;i.send(b,
e)}var k,v,n=0,u=this,r=!0,e=e||{};v=e.interToneGap||null;if(void 0===d)throw new TypeError("Not enough arguments");if(this.status!==o.STATUS_CONFIRMED&&this.status!==o.STATUS_WAITING_FOR_ACK)throw new b.Exceptions.InvalidStateError(this.status);if(!d||"string"!==typeof d&&"number"!==typeof d||!d.toString().match(/^[0-9A-D#*]+$/i))throw new TypeError("Invalid tones: "+d);d=d.toString();if(v&&!b.Utils.isDecimal(v))throw new TypeError("Invalid interToneGap: "+v);v?v<f.C.MIN_INTER_TONE_GAP?(console.warn(i+
'"interToneGap" value is lower than the minimum allowed, setting it to '+f.C.MIN_INTER_TONE_GAP+" milliseconds"),v=f.C.MIN_INTER_TONE_GAP):v=Math.abs(v):v=f.C.DEFAULT_INTER_TONE_GAP;g();k=m.setInterval(function(){u.status!==o.STATUS_TERMINATED&&r&&d.length>n?g():m.clearInterval(k)},v)};e.prototype.getLocalStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]};e.prototype.getRemoteStreams=function(){return this.rtcMediaHandler&&
this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]};e.prototype.init_incoming=function(e,f){var g,k=this,v=e.getHeader("Content-Type");if(e.headers["Alert-Info"]&&-1!=e.headers["Alert-Info"][0].raw.indexOf("gvcname")){this.isMcu=!0;this.roomInfo={};var n=/^.*gvctype=(.*);gvcid=(.*);gvcname=(.*)$/.exec(e.headers["Alert-Info"][0].raw);this.roomInfo.gvctype=n[1];this.roomInfo.gvcid=n[2];this.roomInfo.gvcname=n[3];switch(this.roomInfo.gvctype){case "0":this.roomInfo.gvctype_cn=
"\u8bed\u97f3\u7fa4\u804a";break;case "1":this.roomInfo.gvctype_cn="\u8bed\u97f3\u5bf9\u8bb2";break;case "2":this.roomInfo.gvctype_cn="\u4e24\u65b9\u8bed\u97f3";break;case "9":this.roomInfo.gvctype_cn="\u8bed\u97f3\u76f4\u64ad";break;case "20":this.roomInfo.gvctype_cn="\u89c6\u9891\u7fa4\u804a";break;case "21":this.roomInfo.gvctype_cn="\u89c6\u9891\u5bf9\u8bb2";break;case "22":this.roomInfo.gvctype_cn="\u4e24\u65b9\u89c6\u9891";break;case "29":this.roomInfo.gvctype_cn="\u89c6\u9891\u76f4\u64ad"}this.roomInfo.remoteMedia=
2==this.roomInfo.gvctype.length?"video":"audio"}!this.isMcu&&(!e.body||"application/sdp"!==v)?e.reply(415):(this.status=o.STATUS_INVITE_RECEIVED,this.from_tag=e.from_tag,this.id=e.call_id+this.from_tag,this.request=e,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,e.hasHeader("expires")&&(g=1E3*e.getHeader("expires")),e.to_tag=b.Utils.newTag(),this.createDialog(e,"UAS",!0)?this.isMcu?(e.reply(180,null,["Contact: "+k.contact]),k.status=o.STATUS_WAITING_FOR_ANSWER,k.timers.userNoAnswerTimer=
m.setTimeout(function(){e.reply(408);k.failed("local",null,b.C.causes.NO_ANSWER)},k.ua.configuration.no_answer_timeout),g&&(k.timers.expiresTimer=m.setTimeout(function(){k.status===o.STATUS_WAITING_FOR_ANSWER&&(e.reply(487),k.failed("system",null,b.C.causes.EXPIRES))},g)),this.rtcMediaHandler=new d(this),k.newRTCSession("remote",e)):(this.rtcMediaHandler=new d(this,f),this.rtcMediaHandler.onMessage("offer",e.body,function(){e.reply(180,null,["Contact: "+k.contact]);k.status=o.STATUS_WAITING_FOR_ANSWER;
k.timers.userNoAnswerTimer=m.setTimeout(function(){e.reply(408);k.failed("local",null,b.C.causes.NO_ANSWER)},k.ua.configuration.no_answer_timeout);g&&(k.timers.expiresTimer=m.setTimeout(function(){k.status===o.STATUS_WAITING_FOR_ANSWER&&(e.reply(487),k.failed("system",null,b.C.causes.EXPIRES))},g));k.newRTCSession("remote",e)},function(b){console.warn(i+"invalid SDP");console.warn(b);e.reply(488)})):e.reply(500,"Missing Contact header field"))};e.prototype.connect=function(e,f){var f=f||{},i,g=!1,
k=f.eventHandlers||{},m=f.extraHeaders||[],u=f.mediaConstraints||{audio:!0,video:!0},r=f.RTCConstraints||{};console.log("RTCConstraints:"+r);if(void 0===e)throw new TypeError("Not enough arguments");if(this.status!==o.STATUS_NULL)throw new b.Exceptions.InvalidStateError(this.status);for(i in k)this.on(i,k[i]);try{e=b.Utils.normalizeURI(e,this.ua.configuration.hostport_params)}catch(w){e=b.URI.parse(b.C.INVALID_TARGET_URI),g=!0}this.from_tag=b.Utils.newTag();this.rtcMediaHandler=new d(this,r);this.anonymous=
f.anonymous;this.received_100=this.isCanceled=!1;i={from_tag:this.from_tag};this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0});this.anonymous&&(i.from_display_name="Anonymous",i.from_uri="sip:anonymous@anonymous.invalid",m.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),m.push("Privacy: id"));m.push("Contact: "+this.contact);m.push("Allow: "+b.Utils.getAllowedMethods(this.ua));m.push("Call-Info: "+f.extraParas);m.push("Content-Type: application/sdp");
m.push("Session-Expires: "+b.Timers.TIMER_N);this.request=new b.OutgoingRequest(b.C.INVITE,e,this.ua,i,m);this.id=this.request.call_id+this.from_tag;this.ua.sessions[this.id]=this;this.newRTCSession("local",this.request);g?this.failed("local",null,b.C.causes.INVALID_TARGET):b.WebRTC.isSupported?this.sendInitialRequest(u):this.failed("local",null,b.C.causes.WEBRTC_NOT_SUPPORTED)};e.prototype.close=function(){var b;if(this.status!==o.STATUS_TERMINATED){console.log(i+"closing INVITE session "+this.id);
this.rtcMediaHandler&&this.rtcMediaHandler.close();for(b in this.timers)m.clearTimeout(this.timers[b]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(b in this.earlyDialogs)this.earlyDialogs[b].terminate(),delete this.earlyDialogs[b];this.status=o.STATUS_TERMINATED;this.ua.curSession=null;delete this.ua.sessions[this.id]}};e.prototype.createDialog=function(d,e,f){var i,g=d.call_id+("UAS"===e?d.to_tag:d.from_tag)+("UAS"===e?d.from_tag:d.to_tag);i=this.earlyDialogs[g];if(f){if(i)return!0;
i=new b.Dialog(this,d,e,b.Dialog.C.STATUS_EARLY);if(i.id)return this.earlyDialogs[g]=i,!0;this.failed("remote",d,b.C.causes.INTERNAL_ERROR);return!1}if(i)return i.update(d,e),this.dialog=i,delete this.earlyDialogs[g],!0;e=new b.Dialog(this,d,e);if(e.id)return this.to_tag=d.to_tag,this.dialog=e,!0;this.failed("remote",d,b.C.causes.INTERNAL_ERROR);return!1};e.prototype.receiveRequest=function(d){var e,g=this;if(d.method===b.C.CANCEL)this.request.reply(487),this.status===o.STATUS_WAITING_FOR_ANSWER&&
(this.status=o.STATUS_CANCELED,this.failed("remote",d,b.C.causes.CANCELED));else switch(d.method){case b.C.ACK:if(this.status===o.STATUS_WAITING_FOR_ACK&&(m.clearTimeout(this.timers.ackTimer),m.clearTimeout(this.timers.invite2xxTimer),this.status=o.STATUS_CONFIRMED,g.isMcu))this.rtcMediaHandler.onMessage("answer",d.body,function(){g.status=o.STATUS_CONFIRMED;g.started("remote")},function(d){console.warn(d);session.acceptAndTerminate(response,488,"Not Acceptable Here");session.failed("remote",response,
b.C.causes.BAD_MEDIA_DESCRIPTION)});break;case b.C.BYE:this.status===o.STATUS_CONFIRMED&&(d.reply(200),this.ended("remote",d,b.C.causes.BYE));break;case b.C.INVITE:this.status===o.STATUS_WAITING_FOR_ACK&&d.reply(491);if(this.status===o.STATUS_CONFIRMED||this.isMcu)e=[],e.push("Session-Expires:"+b.Timers.TIMER_N+";refresher=uac"),e.push("Allow: ACK,CANCEL,BYE,OPTIONS,UPDATE,INVITE"),d.reply(200,null,e,this.rtcMediaHandler.peerConnection.localDescription.sdp),console.log(i+"re-INVITE received");break;
case b.C.INFO:if(this.status===o.STATUS_CONFIRMED||this.status===o.STATUS_WAITING_FOR_ACK)(e=d.getHeader("content-type"))&&e.match(/^application\/dtmf-relay/i)&&(new f(this)).init_incoming(d);break;case b.C.UPDATE:e=[];e.push("Session-Expires:"+b.Timers.TIMER_N+";refresher=uac");d.reply(200,null,e);m.clearTimeout(this.timers.updateTimer);this.timers.updateTimer=m.setTimeout(function(d){cause=b.C.causes.UNAVAILABLE;d.failed("remote",null,cause)},2E3*b.Timers.TIMER_N,this);break;case b.C.NOTIFY:-1!=
d.body.indexOf("kickedBy")?(this.ua.unregister(),this.ua.emit("notifyKickby",this,{body:d.body})):-1!=d.body.indexOf("multiLogin")&&this.ua.emit("notifyMultiLogin",this,{body:d.body})}};e.prototype.sendInitialRequest=function(d){var e=this,f=new b.RequestSender(e,this.ua),i=function(){e.rtcMediaHandler.createOffer(k,m)},g=function(){e.status!==o.STATUS_TERMINATED&&e.failed("local",null,b.C.causes.WEBRTC_ERROR)},k=function(b){e.isCanceled||e.status===o.STATUS_TERMINATED||(e.request.body=b,e.status=
o.STATUS_INVITE_SENT,f.send())},m=function(){e.status!==o.STATUS_TERMINATED&&e.failed("local",null,b.C.causes.WEBRTC_ERROR)};this.rtcMediaHandler.getUserMedia(function(b){e.rtcMediaHandler.addStream(b,i,g)},function(){e.status!==o.STATUS_TERMINATED&&e.failed("local",null,b.C.causes.USER_DENIED_MEDIA_ACCESS)},d)};e.prototype.receiveResponse=function(d){var e,f=this;500==d.status_code&&(e=b.C.causes.UNAVAILABLE,this.failed("remote",null,e));403==d.status_code&&this.failed("remote",null,"Forbidden");
if(!(this.status!==o.STATUS_INVITE_SENT&&this.status!==o.STATUS_1XX_RECEIVED))if(this.isCanceled)100<=d.status_code&&200>d.status_code?this.request.cancel(this.cancelReason):200<=d.status_code&&299>d.status_code&&this.acceptAndTerminate(d);else switch(!0){case /^100$/.test(d.status_code):this.received_100=!0;break;case /^1[0-9]{2}$/.test(d.status_code):if(!d.to_tag){console.warn(i+"1xx response received without to tag");break}d.hasHeader("contact")&&this.createDialog(d,"UAC",!0);this.status=o.STATUS_1XX_RECEIVED;
this.progress("remote",d);break;case /^2[0-9]{2}$/.test(d.status_code):if(this.dialog||f.status==o.STATUS_CONFIRMED)break;f.status=o.STATUS_CONFIRMED;if(!d.body){this.acceptAndTerminate(d,400,"Missing session description");this.failed("remote",d,b.C.causes.BAD_MEDIA_DESCRIPTION);break}this.rtcMediaHandler.onMessage("answer",d.body,function(){if(f.createDialog(d,"UAC")){f.sendACK();f.sendUPDATE();f.status=o.STATUS_CONFIRMED;f.started("remote",d)}},function(e){console.warn(e);f.acceptAndTerminate(d,
488,"Not Acceptable Here");f.failed("remote",d,b.C.causes.BAD_MEDIA_DESCRIPTION)});break;default:e=b.Utils.sipErrorCause(d.status_code),this.failed("remote",d,e)}};e.prototype.acceptAndTerminate=function(b,d,e){if(this.dialog||this.createDialog(b,"UAC"))this.sendACK(),this.sendBye({status_code:d,reason_phrase:e})};e.prototype.sendACK=function(){this.sendRequest(this.dialog.createRequest(b.C.ACK))};e.prototype.sendUPDATE=function(){var d=[];d.push("Session-Expires:"+b.Timers.TIMER_N+";refresher=uas");
this.sendRequest(this.dialog.createRequest(b.C.UPDATE,d));this.timers.updateTimer=m.setTimeout(function(b){b.sendUPDATE()},1E3*b.Timers.TIMER_N,this)};e.prototype.sendBye=function(d){var d=d||{},e;e=d.status_code;var f=d.reason_phrase||b.C.REASON_PHRASE[e]||"",i=d.extraHeaders||[],d=d.body;if(e&&(200>e||700<=e))throw new TypeError("Invalid status_code: "+e);e&&i.push("Reason: "+("SIP ;cause="+e+'; text="'+f+'"'));e=this.dialog.createRequest(b.C.BYE,i);e.body=d;this.sendRequest(e)};e.prototype.sendRequest=
function(b){(new g(this,b)).send()};e.prototype.onTransportError=function(){this.status!==o.STATUS_TERMINATED&&(this.status===o.STATUS_CONFIRMED?this.ended("system",null,b.C.causes.CONNECTION_ERROR):this.failed("system",null,b.C.causes.CONNECTION_ERROR))};e.prototype.onRequestTimeout=function(){this.status!==o.STATUS_TERMINATED&&(this.status===o.STATUS_CONFIRMED?this.ended("system",null,b.C.causes.REQUEST_TIMEOUT):this.failed("system",null,b.C.causes.CONNECTION_ERROR))};e.prototype.newRTCSession=
function(b,d){"remote"===b?(this.direction="incoming",this.local_identity=d.to,this.remote_identity=d.from):"local"===b&&(this.direction="outgoing",this.local_identity=d.from,this.remote_identity=d.to);this.ua.emit("newRTCSession",this.ua,{originator:b,session:this,request:d})};e.prototype.connecting=function(b,d){this.emit("connecting",this,{originator:"local",request:d})};e.prototype.progress=function(b,d){this.emit("progress",this,{originator:b,response:d||null})};e.prototype.started=function(b,
d){this.start_time=new Date;this.emit("started",this,{response:d||null})};e.prototype.ended=function(b,d,e){this.end_time=new Date;this.close();this.emit("ended",this,{originator:b,message:d||null,cause:e})};e.prototype.failed=function(b,d,e){this.close();this.emit("failed",this,{originator:b,message:d||null,cause:e})};e.C=o;b.RTCSession=e})(k);(function(b){var g;g=function(b){this.ua=b;this.remote_identity=this.local_identity=this.direction=null;this.data={}};g.prototype=new b.EventEmitter;g.prototype.send=
function(d,f,e){var i,g,k,l=!1;if(void 0===d||void 0===f)throw new TypeError("Not enough arguments");this.initEvents(["succeeded","failed"]);e=e||{};k=e.extraHeaders||[];g=e.eventHandlers||{};e=e.contentType||"text/plain";for(i in g)this.on(i,g[i]);try{d=b.Utils.normalizeURI(d,this.ua.configuration.hostport_params)}catch(m){d=b.URI.parse(b.C.INVALID_TARGET_URI),l=!0}this.direction="outgoing";this.local_identity=this.ua.configuration.uri;this.remote_identity=d;this.closed=!1;this.ua.applicants[this]=
this;k.push("Content-Type: "+e);this.request=new b.OutgoingRequest(b.C.MESSAGE,d,this.ua,null,k);f&&(this.request.body=f);d=new b.RequestSender(this,this.ua);this.ua.emit("newMessage",this.ua,{originator:"local",message:this,request:this.request});l?this.emit("failed",this,{originator:"local",cause:b.C.causes.INVALID_TARGET}):d.send()};g.prototype.receiveResponse=function(d){var f;if(!this.closed)switch(!0){case /^1[0-9]{2}$/.test(d.status_code):break;case /^2[0-9]{2}$/.test(d.status_code):delete this.ua.applicants[this];
this.emit("succeeded",this,{originator:"remote",response:d});break;default:delete this.ua.applicants[this],f=b.Utils.sipErrorCause(d.status_code),this.emit("failed",this,{originator:"remote",response:d,cause:f})}};g.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",this,{originator:"system",cause:b.C.causes.REQUEST_TIMEOUT})};g.prototype.onTransportError=function(){this.closed||this.emit("failed",this,{originator:"system",cause:b.C.causes.CONNECTION_ERROR})};g.prototype.close=
function(){this.closed=!0;delete this.ua.applicants[this]};g.prototype.init_incoming=function(d){var f;f=d.getHeader("content-type");this.direction="incoming";this.request=d;this.local_identity=d.to.uri;this.remote_identity=d.from.uri;f&&(f.match(/^text\/plain(\s*;\s*.+)*$/i)||f.match(/^text\/html(\s*;\s*.+)*$/i))?(this.ua.emit("newMessage",this.ua,{originator:"remote",message:this,request:d}),(f=this.ua.transactions.nist[d.via_branch])&&(f.state===b.Transactions.C.STATUS_TRYING||f.state===b.Transactions.C.STATUS_PROCEEDING)&&
d.reply(200)):d.reply(415,null,["Accept: text/plain, text/html"])};g.prototype.accept=function(b){var b=b||{},f=b.extraHeaders||[],b=b.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing message');this.request.reply(200,null,f,b)};g.prototype.reject=function(b){var b=b||{},f=b.status_code||480,e=b.reason_phrase,i=b.extraHeaders||[],b=b.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing message');if(300>f||700<=
f)throw new TypeError("Invalid status_code: "+f);this.request.reply(f,e,i,b)};b.Message=g})(k);(function(b){var g,d=b.name+" | UA | ",f={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,EVENT_METHODS:{newRTCSession:"INVITE",newMessage:"MESSAGE"},ALLOWED_METHODS:["ACK","CANCEL","BYE","OPTIONS","UPDATE"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],SUPPORTED:"path, outbound, gruu, timer",MAX_FORWARDS:69,TAG_LENGTH:10};g=function(b){var d=
"connected,disconnected,registered,unregistered,registrationFailed,newRTCSession,newMessage,notifyKickby,notifyMultiLogin,notifyRoom".split(",");f.ACCEPTED_BODY_TYPES=f.ACCEPTED_BODY_TYPES.toString();this.cache={credentials:{}};this.configuration={};this.dialogs={};this.curSession=this.registrator=null;this.applicants={};this.sessions={};this.contact=this.transport=null;this.status=f.STATUS_INIT;this.error=null;this.transactions={nist:{},nict:{},ist:{},ict:{}};this.transportRecoverAttempts=0;if(void 0===
b)throw new TypeError("Not enough arguments");try{this.loadConfig(b),this.initEvents(d)}catch(g){throw this.status=f.STATUS_NOT_READY,this.error=f.CONFIGURATION_ERROR,g;}};g.prototype=new b.EventEmitter;g.prototype.register=function(b){this.configuration.register=!0;this.registrator.register(b)};g.prototype.unregister=function(b){this.configuration.register=!1;this.registrator.unregister(b)};g.prototype.isRegistered=function(){return this.registrator&&this.registrator.registered?!0:!1};g.prototype.isConnected=
function(){return this.transport?this.transport.connected:!1};g.prototype.call=function(d,f){var g;g=new b.RTCSession(this);g.connect(d,f);this.curSession=g};g.prototype.sendMessage=function(d,f,g){(new b.Message(this)).send(d,f,g)};g.prototype.startRecord=function(){var b=this.curSession;b.emit("startRecord",b,{response:null})};g.prototype.stopRecord=function(){var b=this.curSession;b.emit("endRecord",b,{response:null})};g.prototype.stop=function(){var b,g,o=this;console.log(d+"user requested closure...");
if(this.status===f.STATUS_USER_CLOSED)console.warn("UA already closed");else{this.registrator&&(console.log(d+"closing registrator"),this.registrator.close());for(b in this.sessions)console.log(d+"closing session "+b),this.sessions[b].terminate();for(g in this.applicants)this.applicants[g].close();this.status=f.STATUS_USER_CLOSED;this.shutdownGraceTimer=m.setTimeout(function(){o.transport.disconnect()},"5000")}};g.prototype.start=function(){var e;console.log(d+"user requested startup...");this.status===
f.STATUS_INIT?(e=this.getNextWsServer(),new b.Transport(this,e)):this.status===f.STATUS_USER_CLOSED?(console.log(d+"resuming"),this.status=f.STATUS_READY,this.transport.connect()):this.status===f.STATUS_READY?console.log(d+"UA is in READY status, not resuming"):console.error("Connection is down. Auto-Recovery system is trying to connect")};g.prototype.saveCredentials=function(b){this.cache.credentials[b.realm]=this.cache.credentials[b.realm]||{};this.cache.credentials[b.realm][b.uri]=b};g.prototype.getCredentials=
function(b){var d,f;d=b.ruri.host;this.cache.credentials[d]&&this.cache.credentials[d][b.ruri]&&(f=this.cache.credentials[d][b.ruri],f.method=b.method);return f};g.prototype.onTransportClosed=function(e){var f,g,k=["nict","ict","nist","ist"];e.server.status=b.Transport.C.STATUS_DISCONNECTED;console.log(d+"connection state set to "+b.Transport.C.STATUS_DISCONNECTED);for(f in k)for(g in this.transactions[k[f]])this.transactions[k[f]][g].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()};
g.prototype.onTransportError=function(e){console.log(d+"transport "+e.server.ws_uri+" failed | connection state set to "+b.Transport.C.STATUS_ERROR);e.server.status=b.Transport.C.STATUS_ERROR;this.emit("disconnected",this,{transport:e,code:e.lastTransportError.code,reason:e.lastTransportError.reason});if(e=this.getNextWsServer())new b.Transport(this,e);else{this.closeSessionsOnTransportError();if(!this.error||this.error!==f.NETWORK_ERROR)this.status=f.STATUS_NOT_READY,this.error=f.NETWORK_ERROR;this.recoverTransport()}};
g.prototype.onTransportConnected=function(e){this.transport=e;this.transportRecoverAttempts=0;e.server.status=b.Transport.C.STATUS_READY;console.log(d+"connection state set to "+b.Transport.C.STATUS_READY);if(this.status!==f.STATUS_USER_CLOSED)if(this.status=f.STATUS_READY,this.error=null,this.emit("connected",this,{transport:e}),this.configuration.register)if(this.registrator)this.registrator.onTransportConnected();else this.registrator=new b.Registrator(this,e),this.register();else this.registrator=
new b.Registrator(this,e)};g.prototype.setSE=function(d){b.Timers.TIMER_N=d};g.prototype.receiveRequest=function(e){var g,o=e.method;if(e.ruri.user!==this.configuration.uri.user&&e.ruri.user!==this.contact.uri.user)console.warn(d+"Request-URI does not point to us"),e.method!==b.C.ACK&&e.reply_sl(404);else if(!b.Transactions.checkTransaction(this,e)){o===b.C.INVITE?new b.Transactions.InviteServerTransaction(e,this):o!==b.C.ACK&&new b.Transactions.NonInviteServerTransaction(e,this);if(o===b.C.OPTIONS)e.reply(200,
null,["Allow: "+b.Utils.getAllowedMethods(this),"Accept: "+f.ACCEPTED_BODY_TYPES]);else if(o===b.C.MESSAGE){if(!this.checkEvent("newMessage")||0===this.listeners("newMessage").length){e.reply(405,null,["Allow: "+b.Utils.getAllowedMethods(this)]);return}g=new b.Message(this);g.init_incoming(e);return}if(e.to_tag)(g=this.findDialog(e))?g.receiveRequest(e):o===b.C.NOTIFY?(g=this.findSession(e))?g.receiveRequest(e):(console.warn(d+"received NOTIFY request for a non existent session"),e.reply(481,"Subscription does not exist")):
o!==b.C.ACK&&e.reply(481);else if(this.isRegistered())switch(o){case b.C.INVITE:if(b.WebRTC.isSupported){if(this.curSession){e.reply(486);break}this.curSession=g=new b.RTCSession(this);g.init_incoming(e,{optional:[{DtlsSrtpKeyAgreement:"false"}]});g=e.headers["Session-Expires"];e=e.getHeader("Min-SE");g=parseInt(g[0].raw);b.Timers.TIMER_N>g?b.Timers.TIMER_N=g:b.Timers.TIMER_N<parseInt(e)&&(b.Timers.TIMER_N=parseInt(e))}else console.warn(d+"INVITE received but WebRTC is not supported"),e.reply(488);
break;case b.C.BYE:e.reply(481);break;case b.C.CANCEL:e.reply(200);(g=this.findSession(e))?g.receiveRequest(e):console.warn(d+"received CANCEL request for a non existent session");break;case b.C.ACK:break;case b.C.NOTIFY:e.reply(200);-1!=e.body.indexOf("kickedBy")?(this.stop(),this.emit("notifyKickby",this,{body:e.body})):-1!=e.body.indexOf("multiLogin")&&this.emit("notifyMultiLogin",this,{body:e.body});-1!=e.body.indexOf("ChangedInfo")&&this.emit("notifyRoom",this,{body:e.body});break;default:e.reply(405)}else e.reply(410)}};
g.prototype.findSession=function(b){var d=this.sessions[b.call_id+b.from_tag],b=this.sessions[b.call_id+b.to_tag];return d?d:b?b:null};g.prototype.findDialog=function(b){var d=b.call_id+b.from_tag+b.to_tag;if(d=this.dialogs[d])return d;d=b.call_id+b.to_tag+b.from_tag;return(d=this.dialogs[d])?d:null};g.prototype.getNextWsServer=function(){var d,f,g=[];for(d in this.configuration.ws_servers)f=this.configuration.ws_servers[d],f.status!==b.Transport.C.STATUS_ERROR&&(0===g.length?g.push(f):f.weight>g[0].weight?
g=[f]:f.weight===g[0].weight&&g.push(f));d=Math.floor(Math.random()*g.length);return g[d]};g.prototype.closeSessionsOnTransportError=function(){for(var b in this.sessions)this.sessions[b].onTransportError();if(this.registrator)this.registrator.onTransportClosed()};g.prototype.recoverTransport=function(e){var f,g,k,e=e||this;g=e.transportRecoverAttempts;for(f in e.configuration.ws_servers)e.configuration.ws_servers[f].status=0;k=e.getNextWsServer();f=Math.floor(Math.random()*Math.pow(2,g)+1)*e.configuration.connection_recovery_min_interval;
f>e.configuration.connection_recovery_max_interval&&(console.log(d+"time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),f=e.configuration.connection_recovery_min_interval,g=0);console.log(d+"next connection attempt in "+f+" seconds");m.setTimeout(function(){e.transportRecoverAttempts=g+1;new b.Transport(e,k)},1E3*f)};g.prototype.loadConfig=function(e){var f,o,k,l={via_host:b.Utils.createRandomToken(12)+".invalid",password:null,register_expires:600,register_min_expires:120,
register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,stun_servers:"",turn_servers:"",trace_sip:!1,hack_via_tcp:!1,hack_ip_in_contact:!1};for(f in g.configuration_check.mandatory)if(e.hasOwnProperty(f))if(o=e[f],k=g.configuration_check.mandatory[f](o),void 0!==k)l[f]=k;else throw new b.Exceptions.ConfigurationError(f,o);else throw new b.Exceptions.ConfigurationError(f);
for(f in g.configuration_check.optional)if(e.hasOwnProperty(f)&&(o=e[f],!(null===o||""===o||void 0===o)&&!("number"===typeof o&&m.isNaN(o))))if(k=g.configuration_check.optional[f](o),void 0!==k)l[f]=k;else throw new b.Exceptions.ConfigurationError(f,o);if(l.connection_recovery_max_interval<l.connection_recovery_min_interval)throw new b.Exceptions.ConfigurationError("connection_recovery_max_interval",l.connection_recovery_max_interval);0===l.display_name&&(l.display_name="0");l.instance_id=b.Utils.newUUID();
l.jssip_id=b.Utils.createRandomToken(5);e=l.uri.clone();e.user=null;l.hostport_params=e.toString().replace(/^sip:/i,"");l.authorization_user||(l.authorization_user=l.uri.user);l.registrar_server||(e=l.uri.clone(),e.user=null,l.registrar_server=e);l.no_answer_timeout*=1E3;l.hack_ip_in_contact&&(l.via_host=b.Utils.getRandomTestNetIP());this.contact={pub_gruu:null,temp_gruu:null,uri:new b.URI("sip",b.Utils.createRandomToken(8),l.via_host,null,{transport:"ws"}),toString:function(b){var b=b||{},d=b.outbound||
null,e="<",e=b.anonymous?e+(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws"):e+(this.pub_gruu||this.uri.toString());d&&(e=e+";ob");return e+">"}};console.log(d+"configuration parameters after validation:");for(f in l){switch(f){case "uri":case "registrar_server":!0===l.trace_sip&&console.log("\u00b7 "+f+": "+l[f]);break;default:!0===l.trace_sip&&console.log("\u00b7 "+f+": "+m.JSON.stringify(l[f]))}g.configuration_skeleton[f].value=l[f]}Object.defineProperties(this.configuration,g.configuration_skeleton);
for(f in l)g.configuration_skeleton[f].value=""};g.configuration_skeleton=function(){var b,d,f={},g="instance_id,jssip_id,register_min_expires,ws_server_max_reconnection,ws_server_reconnection_timeout,hostport_params,uri,ws_servers,authorization_user,connection_recovery_max_interval,connection_recovery_min_interval,display_name,hack_via_tcp,hack_ip_in_contact,no_answer_timeout,password,register_expires,registrar_server,stun_servers,trace_sip,turn_servers,use_preloaded_route,via_core_value,via_host".split(",");
for(b in g)d=g[b],f[d]={value:"",writable:!1,configurable:!1};f.register={value:"",writable:!0,configurable:!1};return f}();g.configuration_check={mandatory:{uri:function(d){/^sip:/i.test(d)||(d=b.C.SIP+":"+d);if((d=b.URI.parse(d))&&d.user)return d},ws_servers:function(e){var f,g;if("string"===typeof e)e=[{ws_uri:e}];else if(e instanceof Array)for(f in e)"string"===typeof e[f]&&(e[f]={ws_uri:e[f]});else return;if(0===e.length)return!1;for(f in e){if(!e[f].ws_uri){console.error(d+'missing "ws_uri" attribute in ws_servers parameter');
return}if(e[f].weight&&!Number(e[f].weight)){console.error(d+'"weight" attribute in ws_servers parameter must be a Number');return}g=b.Grammar.parse(e[f].ws_uri,"absoluteURI");if(-1===g){console.error(d+'invalid "ws_uri" attribute in ws_servers parameter: '+e[f].ws_uri);return}if("wss"!==g.scheme&&"ws"!==g.scheme){console.error(d+"invalid URI scheme in ws_servers parameter: "+g.scheme);return}e[f].sip_uri="<sip:"+g.host+(g.port?":"+g.port:"")+";transport=ws;lr>";e[f].weight||(e[f].weight=0);e[f].status=
0;e[f].scheme=g.scheme.toUpperCase()}return e}},optional:{authorization_user:function(d){if(-1!==b.Grammar.parse('"'+d+'"',"quoted_string"))return d},connection_recovery_max_interval:function(d){if(b.Utils.isDecimal(d)&&(d=m.Number(d),0<d))return d},connection_recovery_min_interval:function(d){if(b.Utils.isDecimal(d)&&(d=m.Number(d),0<d))return d},display_name:function(d){if(-1!==b.Grammar.parse('"'+d+'"',"display_name"))return d},hack_via_tcp:function(b){if("boolean"===typeof b)return b},hack_ip_in_contact:function(b){if("boolean"===
typeof b)return b},no_answer_timeout:function(d){if(b.Utils.isDecimal(d)&&(d=m.Number(d),0<d))return d},password:function(b){return""+b},register:function(b){if("boolean"===typeof b)return b},register_expires:function(d){if(b.Utils.isDecimal(d)&&(d=m.Number(d),0<d))return d},registrar_server:function(d){/^sip:/i.test(d)||(d=b.C.SIP+":"+d);if((d=b.URI.parse(d))&&!d.user)return d},stun_servers:function(d){var f,g;d instanceof Array||(d=[d]);for(f in d){g=d[f];if(!g.server||!g.username||!g.password)return;
/^stuns?:/.test(g.server)||(g.server="stun:"+g.server);if(-1===b.Grammar.parse(g.server,"stun_URI"))break;else if(-1===b.Grammar.parse(g.username,"user"))break;else if(-1===b.Grammar.parse(g.password,"password"))break}return d},trace_sip:function(b){if("boolean"===typeof b)return b},turn_servers:function(d){var f,g;d instanceof Array||(d=[d]);for(f in d){g=d[f];if(!g.server||!g.username||!g.password)return;/^turns?:/.test(g.server)||(g.server="turn:"+g.server);if(-1===b.Grammar.parse(g.server,"turn_URI"))break;
else if(-1===b.Grammar.parse(g.username,"user"))break;else if(-1===b.Grammar.parse(g.password,"password"))break}return d},use_preloaded_route:function(b){if("boolean"===typeof b)return b}}};g.C=f;b.UA=g})(k);(function(b){b.Utils={str_utf8_length:function(b){return m.unescape(encodeURIComponent(b)).length},isFunction:function(b){return void 0!==b?"[object Function]"===Object.prototype.toString.call(b)?!0:!1:!1},isDecimal:function(b){return!isNaN(b)&&parseFloat(b)===parseInt(b,10)},createRandomToken:function(b,
d){var f,e,i="",d=d||32;for(f=0;f<b;f++)e=Math.random()*d|0,i+=e.toString(d);return i},newTag:function(){return b.Utils.createRandomToken(b.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var d=16*Math.random()|0;return("x"===b?d:d&3|8).toString(16)})},hostType:function(g){if(g&&(g=b.Grammar.parse(g,"host"),-1!==g))return g.host_type},normalizeURI:function(g,d){var f,e,i=g;if(g){if(g instanceof b.URI)return g;if("string"===typeof g){e=
g.split("@");switch(e.length){case 1:if(!d)throw new b.Exceptions.InvalidTargetError(i);f=g;e=d;break;case 2:f=e[0];e=e[1];break;default:f=e.slice(0,e.length-1).join("@"),e=e[e.length-1]}f=f.replace(/^(sips?|tel):/i,"");/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(f)&&(f=f.replace(/[\-\.\(\)]/g,""));g=b.C.SIP+":"+b.Utils.escapeUser(f)+"@"+e;if(f=b.URI.parse(g))return f}}throw new b.Exceptions.InvalidTargetError(i);},escapeUser:function(b){return m.encodeURIComponent(m.decodeURIComponent(b)).replace(/%3A/ig,
":").replace(/%2B/ig,"+").replace(/%3F/ig,"?").replace(/%2F/ig,"/")},headerize:function(b){var d={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},b=b.toLowerCase().replace(/_/g,"-").split("-"),f="",e;for(e in b)"0"!==e&&(f+="-"),f+=b[e].charAt(0).toUpperCase()+b[e].substring(1);d[f]&&(f=d[f]);return f},sipErrorCause:function(g){for(var d in b.C.SIP_ERROR_CAUSES)if(-1!==b.C.SIP_ERROR_CAUSES[d].indexOf(g))return b.C.causes[d];return b.C.causes.SIP_FAILURE_CODE},getRandomTestNetIP:function(){return"192.0.2."+
m.Math.floor(254*m.Math.random()+1)},getAllowedMethods:function(g){var d,f=b.UA.C.ALLOWED_METHODS.toString();for(d in b.UA.C.EVENT_METHODS)g.checkEvent(d)&&0<g.listeners(d).length&&(f+=","+b.UA.C.EVENT_METHODS[d]);return f},calculateMD5:function(b){function d(b,d){var e,f,g,i,k;g=b&2147483648;i=d&2147483648;e=b&1073741824;f=d&1073741824;k=(b&1073741823)+(d&1073741823);return e&f?k^2147483648^g^i:e|f?k&1073741824?k^3221225472^g^i:k^1073741824^g^i:k^g^i}function f(b,e,f,g,i,k,l){b=d(b,d(d(e&f|~e&g,
i),l));return d(b<<k|b>>>32-k,e)}function e(b,e,f,g,i,k,l){b=d(b,d(d(e&g|f&~g,i),l));return d(b<<k|b>>>32-k,e)}function i(b,e,f,g,i,k,l){b=d(b,d(d(e^f^g,i),l));return d(b<<k|b>>>32-k,e)}function k(b,e,f,g,i,l,o){b=d(b,d(d(f^(e|~g),i),o));return d(b<<l|b>>>32-l,e)}function m(b){var d="",e="",f;for(f=0;3>=f;f++)e=b>>>8*f&255,e="0"+e.toString(16),d+=e.substr(e.length-2,2);return d}var l=[],C,B,v,n,u,r,w,s,b=function(b){for(var b=b.replace(/\r\n/g,"\n"),d="",e=0;e<b.length;e++){var f=b.charCodeAt(e);
128>f?d+=String.fromCharCode(f):(127<f&&2048>f?d+=String.fromCharCode(f>>6|192):(d+=String.fromCharCode(f>>12|224),d+=String.fromCharCode(f>>6&63|128)),d+=String.fromCharCode(f&63|128))}return d}(b),l=function(b){var d,e=b.length;d=e+8;for(var f=16*((d-d%64)/64+1),g=Array(f-1),i=0,k=0;k<e;)d=(k-k%4)/4,i=8*(k%4),g[d]|=b.charCodeAt(k)<<i,k++;d=(k-k%4)/4;g[d]|=128<<8*(k%4);g[f-2]=e<<3;g[f-1]=e>>>29;return g}(b);u=1732584193;r=4023233417;w=2562383102;s=271733878;for(b=0;b<l.length;b+=16)C=u,B=r,v=w,n=
s,u=f(u,r,w,s,l[b+0],7,3614090360),s=f(s,u,r,w,l[b+1],12,3905402710),w=f(w,s,u,r,l[b+2],17,606105819),r=f(r,w,s,u,l[b+3],22,3250441966),u=f(u,r,w,s,l[b+4],7,4118548399),s=f(s,u,r,w,l[b+5],12,1200080426),w=f(w,s,u,r,l[b+6],17,2821735955),r=f(r,w,s,u,l[b+7],22,4249261313),u=f(u,r,w,s,l[b+8],7,1770035416),s=f(s,u,r,w,l[b+9],12,2336552879),w=f(w,s,u,r,l[b+10],17,4294925233),r=f(r,w,s,u,l[b+11],22,2304563134),u=f(u,r,w,s,l[b+12],7,1804603682),s=f(s,u,r,w,l[b+13],12,4254626195),w=f(w,s,u,r,l[b+14],17,2792965006),
r=f(r,w,s,u,l[b+15],22,1236535329),u=e(u,r,w,s,l[b+1],5,4129170786),s=e(s,u,r,w,l[b+6],9,3225465664),w=e(w,s,u,r,l[b+11],14,643717713),r=e(r,w,s,u,l[b+0],20,3921069994),u=e(u,r,w,s,l[b+5],5,3593408605),s=e(s,u,r,w,l[b+10],9,38016083),w=e(w,s,u,r,l[b+15],14,3634488961),r=e(r,w,s,u,l[b+4],20,3889429448),u=e(u,r,w,s,l[b+9],5,568446438),s=e(s,u,r,w,l[b+14],9,3275163606),w=e(w,s,u,r,l[b+3],14,4107603335),r=e(r,w,s,u,l[b+8],20,1163531501),u=e(u,r,w,s,l[b+13],5,2850285829),s=e(s,u,r,w,l[b+2],9,4243563512),
w=e(w,s,u,r,l[b+7],14,1735328473),r=e(r,w,s,u,l[b+12],20,2368359562),u=i(u,r,w,s,l[b+5],4,4294588738),s=i(s,u,r,w,l[b+8],11,2272392833),w=i(w,s,u,r,l[b+11],16,1839030562),r=i(r,w,s,u,l[b+14],23,4259657740),u=i(u,r,w,s,l[b+1],4,2763975236),s=i(s,u,r,w,l[b+4],11,1272893353),w=i(w,s,u,r,l[b+7],16,4139469664),r=i(r,w,s,u,l[b+10],23,3200236656),u=i(u,r,w,s,l[b+13],4,681279174),s=i(s,u,r,w,l[b+0],11,3936430074),w=i(w,s,u,r,l[b+3],16,3572445317),r=i(r,w,s,u,l[b+6],23,76029189),u=i(u,r,w,s,l[b+9],4,3654602809),
s=i(s,u,r,w,l[b+12],11,3873151461),w=i(w,s,u,r,l[b+15],16,530742520),r=i(r,w,s,u,l[b+2],23,3299628645),u=k(u,r,w,s,l[b+0],6,4096336452),s=k(s,u,r,w,l[b+7],10,1126891415),w=k(w,s,u,r,l[b+14],15,2878612391),r=k(r,w,s,u,l[b+5],21,4237533241),u=k(u,r,w,s,l[b+12],6,1700485571),s=k(s,u,r,w,l[b+3],10,2399980690),w=k(w,s,u,r,l[b+10],15,4293915773),r=k(r,w,s,u,l[b+1],21,2240044497),u=k(u,r,w,s,l[b+8],6,1873313359),s=k(s,u,r,w,l[b+15],10,4264355552),w=k(w,s,u,r,l[b+6],15,2734768916),r=k(r,w,s,u,l[b+13],21,
1309151649),u=k(u,r,w,s,l[b+4],6,4149444226),s=k(s,u,r,w,l[b+11],10,3174756917),w=k(w,s,u,r,l[b+2],15,718787259),r=k(r,w,s,u,l[b+9],21,3951481745),u=d(u,C),r=d(r,B),w=d(w,v),s=d(s,n);return(m(u)+m(r)+m(w)+m(s)).toLowerCase()}}})(k);(function(b){function g(d){var e,d="SIP/2.0 "+d+" "+b.C.REASON_PHRASE[d]+"\r\n";e=f.countHeader("via");var g=0;for(g;g<e;g++)d+="Via: "+f.getHeader("via",g)+"\r\n";e=f.getHeader("To");f.to_tag||(e+=";tag="+b.Utils.newTag());d=d+("To: "+e+"\r\n")+("From: "+f.getHeader("From")+
"\r\n");d+="Call-ID: "+f.call_id+"\r\n";d+="CSeq: "+f.cseq+" "+f.method+"\r\n";i.send(d+"\r\n")}var d=b.name+" | SANITY CHECK | ",f,e,i,k=[],m=[],l=[];k.push(function(){if("sip"!==f.s("to").uri.scheme)return g(416),!1});k.push(function(){if(!f.to_tag&&f.call_id.substr(0,5)===e.configuration.jssip_id)return g(482),!1});k.push(function(){var d=b.Utils.str_utf8_length(f.body),e=f.getHeader("content-length");if(d<e)return g(400),!1});k.push(function(){var d,i,k=f.from_tag,l=f.call_id,o=f.cseq;if(!f.to_tag)if(f.method===
b.C.INVITE){if(d=e.transactions.ist[f.via_branch])for(i in e.transactions.ist)if(d=e.transactions.ist[i],d.request.from_tag===k&&d.request.call_id===l&&d.request.cseq===o)return g(482),!1}else if(d=e.transactions.nist[f.via_branch])for(i in e.transactions.nist)if(d=e.transactions.nist[i],d.request.from_tag===k&&d.request.call_id===l&&d.request.cseq===o)return g(482),!1});m.push(function(){if(1<f.countHeader("via"))return console.warn(d+"More than one Via header field present in the response. Dropping the response"),
!1});m.push(function(){if(f.via.host!==e.configuration.via_host)return console.warn(d+"Via host in the response does not match UA Via host value. Dropping the response"),!1});m.push(function(){var e=b.Utils.str_utf8_length(f.body),g=f.getHeader("content-length");if(e<g)return console.warn(d+"Message body length is lower than the value in Content-Length header field. Dropping the response"),!1});l.push(function(){for(var b=["from","to","call_id","cseq","via"],e=b.length;e--;)if(!f.hasHeader(b[e]))return console.warn(d+
"Missing mandatory header field : "+b[e]+". Dropping the response"),!1});b.sanityCheck=function(d,g,v){f=d;e=g;i=v;for(d=l.length;d--;)if(g=l[d](f),!1===g)return!1;if(f instanceof b.IncomingRequest)for(d=k.length;d--;){if(g=k[d](f),!1===g)return!1}else if(f instanceof b.IncomingResponse)for(d=m.length;d--;)if(g=m[d](f),!1===g)return!1;console.log("sanitycheck true");return!0}})(k);(function(b){var g,d=b.name+" | DIGEST AUTHENTICATION | ";g=function(b){this.username=b.configuration.authorization_user;
this.password=b.configuration.password;this.cnonce=null;this.nc=0;this.ncHex="00000000";this.response=null};g.prototype.authenticate=function(f,e){this.algorithm=e.algorithm;this.realm=e.realm;this.nonce=e.nonce;this.opaque=e.opaque;this.stale=e.stale;if(this.algorithm){if("MD5"!==this.algorithm)return console.warn(d+'challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return console.warn(d+"challenge without Digest realm, authentication aborted"),
!1;if(!this.nonce)return console.warn(d+"challenge without Digest nonce, authentication aborted"),!1;if(e.qop)if(-1<e.qop.indexOf("auth"))this.qop="auth";else if(-1<e.qop.indexOf("auth-int"))this.qop="auth-int";else return console.warn(d+'challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;else this.qop=null;this.method=f.method;this.uri=f.ruri;this.cnonce=b.Utils.createRandomToken(12);this.nc+=1;this.updateNcHex();4294967296===this.nc&&(this.nc=1,this.ncHex=
"00000001");this.calculateResponse();return!0};g.prototype.calculateResponse=function(){var d,e;d=b.Utils.calculateMD5(this.username+":"+this.realm+":"+this.password);"auth"===this.qop?(e=b.Utils.calculateMD5(this.method+":"+this.uri),this.response=b.Utils.calculateMD5(d+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+e)):"auth-int"===this.qop?(e=b.Utils.calculateMD5(this.method+":"+this.uri+":"+b.Utils.calculateMD5(this.body?this.body:"")),this.response=b.Utils.calculateMD5(d+":"+this.nonce+
":"+this.ncHex+":"+this.cnonce+":auth-int:"+e)):null===this.qop&&(e=b.Utils.calculateMD5(this.method+":"+this.uri),this.response=b.Utils.calculateMD5(d+":"+this.nonce+":"+e))};g.prototype.toString=function(){var b=[];if(!this.response)throw Error("response field does not exist, cannot generate Authorization header");b.push("algorithm="+this.algorithm);b.push('username="'+this.username+'"');b.push('realm="'+this.realm+'"');b.push('nonce="'+this.nonce+'"');b.push('uri="'+this.uri+'"');b.push('response="'+
this.response+'"');this.opaque&&b.push('opaque="'+this.opaque+'"');this.qop&&(b.push("qop="+this.qop),b.push('cnonce="'+this.cnonce+'"'),b.push("nc="+this.ncHex));return"Digest "+b.join(", ")};g.prototype.updateNcHex=function(){var b=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-b.length)+b};b.DigestAuthentication=g})(k);(function(b){var g;g={};m.navigator.webkitGetUserMedia?g.getUserMedia=m.navigator.webkitGetUserMedia.bind(navigator):m.navigator.mozGetUserMedia?g.getUserMedia=m.navigator.mozGetUserMedia.bind(navigator):
m.navigator.getUserMedia&&(g.getUserMedia=m.navigator.getUserMedia.bind(navigator));m.webkitRTCPeerConnection?g.RTCPeerConnection=m.webkitRTCPeerConnection:m.mozRTCPeerConnection?g.RTCPeerConnection=m.mozRTCPeerConnection:m.RTCPeerConnection&&(g.RTCPeerConnection=m.RTCPeerConnection);m.webkitRTCSessionDescription?(console.log("webkit"),g.RTCSessionDescription=m.webkitRTCSessionDescription):m.mozRTCSessionDescription?(console.log("moz"),g.RTCSessionDescription=m.mozRTCSessionDescription):m.RTCSessionDescription&&
(console.log("~~sdp"),g.RTCSessionDescription=m.RTCSessionDescription);g.RTCPeerConnection&&g.RTCPeerConnection.prototype&&!g.RTCPeerConnection.prototype.getLocalStreams&&(g.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},g.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams});g.isSupported=g.getUserMedia&&g.RTCPeerConnection&&g.RTCSessionDescription?!0:!1;b.WebRTC=g})(k);m.JsSIP=k})(window);
JsSIP.Grammar=function(){function m(b){return'"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var k={parse:function(b,g){function d(a){c<R||(c>R&&(R=c,za=[]),za.push(a))}function f(){var a;"\r\n"===b.substr(c,2)?(a="\r\n",c+=2):(a=null,0===j&&d('"\\r\\n"'));return a}function e(){var a;/^[0-9]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=
null,0===j&&d("[0-9]"));return a}function i(){var a;/^[a-zA-Z]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[a-zA-Z]"));return a}function k(){var a;/^[0-9a-fA-F]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[0-9a-fA-F]"));return a}function z(){var a;a=B();null===a&&(a=v());return a}function l(){var a;/^[\0-\xFF]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[\\0-\\xFF]"));return a}function C(){var a;/^["]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d('["]'));
return a}function B(){var a;32===b.charCodeAt(c)?(a=" ",c++):(a=null,0===j&&d('" "'));return a}function v(){var a;9===b.charCodeAt(c)?(a="\t",c++):(a=null,0===j&&d('"\\t"'));return a}function n(){var a;/^[a-zA-Z0-9]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[a-zA-Z0-9]"));return a}function u(){var a;59===b.charCodeAt(c)?(a=";",c++):(a=null,0===j&&d('";"'));if(null===a&&(47===b.charCodeAt(c)?(a="/",c++):(a=null,0===j&&d('"/"')),null===a))if(63===b.charCodeAt(c)?(a="?",c++):(a=null,0===
j&&d('"?"')),null===a)if(58===b.charCodeAt(c)?(a=":",c++):(a=null,0===j&&d('":"')),null===a)if(64===b.charCodeAt(c)?(a="@",c++):(a=null,0===j&&d('"@"')),null===a)if(38===b.charCodeAt(c)?(a="&",c++):(a=null,0===j&&d('"&"')),null===a)if(61===b.charCodeAt(c)?(a="=",c++):(a=null,0===j&&d('"="')),null===a)if(43===b.charCodeAt(c)?(a="+",c++):(a=null,0===j&&d('"+"')),null===a)if(36===b.charCodeAt(c)?(a="$",c++):(a=null,0===j&&d('"$"')),null===a)44===b.charCodeAt(c)?(a=",",c++):(a=null,0===j&&d('","'));return a}
function r(){var a;a=n();null===a&&(a=w());return a}function w(){var a;45===b.charCodeAt(c)?(a="-",c++):(a=null,0===j&&d('"-"'));if(null===a&&(95===b.charCodeAt(c)?(a="_",c++):(a=null,0===j&&d('"_"')),null===a))if(46===b.charCodeAt(c)?(a=".",c++):(a=null,0===j&&d('"."')),null===a)if(33===b.charCodeAt(c)?(a="!",c++):(a=null,0===j&&d('"!"')),null===a)if(126===b.charCodeAt(c)?(a="~",c++):(a=null,0===j&&d('"~"')),null===a)if(42===b.charCodeAt(c)?(a="*",c++):(a=null,0===j&&d('"*"')),null===a)if(39===b.charCodeAt(c)?
(a="'",c++):(a=null,0===j&&d('"\'"')),null===a)if(40===b.charCodeAt(c)?(a="(",c++):(a=null,0===j&&d('"("')),null===a)41===b.charCodeAt(c)?(a=")",c++):(a=null,0===j&&d('")"'));return a}function s(){var a,h,p,e;e=c;37===b.charCodeAt(c)?(a="%",c++):(a=null,0===j&&d('"%"'));null!==a?(h=k(),null!==h?(p=k(),null!==p?a=[a,h,p]:(a=null,c=e)):(a=null,c=e)):(a=null,c=e);return a}function x(){var a,b,d,e,Aa;d=Aa=e=c;a=[];for(b=z();null!==b;)a.push(b),b=z();null!==a?(b=f(),null!==b?a=[a,b]:(a=null,c=d)):(a=null,
c=d);a=null!==a?a:"";if(null!==a){d=z();if(null!==d)for(b=[];null!==d;)b.push(d),d=z();else b=null;null!==b?a=[a,b]:(a=null,c=Aa)}else a=null,c=Aa;null!==a&&(a=" ");null===a&&(c=e);return a}function t(){var a;a=x();return null!==a?a:""}function M(){var a,h,p,e,f;f=e=c;a=[];h=B();for(null===h&&(h=v());null!==h;)a.push(h),h=B(),null===h&&(h=v());null!==a?(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h)?(p=t(),null!==p?a=[a,h,p]:(a=null,c=f)):(a=null,c=f):(a=null,c=f);null!==a&&(a=
":");null===a&&(c=e);return a}function D(){var a,h,d,e,f,g,j;g=f=c;h=H();if(null!==h)for(a=[];null!==h;)a.push(h),h=H();else a=null;if(null!==a){h=[];j=c;d=[];for(e=x();null!==e;)d.push(e),e=x();null!==d?(e=H(),null!==e?d=[d,e]:(d=null,c=j)):(d=null,c=j);for(;null!==d;){h.push(d);j=c;d=[];for(e=x();null!==e;)d.push(e),e=x();null!==d?(e=H(),null!==e?d=[d,e]:(d=null,c=j)):(d=null,c=j)}null!==h?a=[a,h]:(a=null,c=g)}else a=null,c=g;null!==a&&(a=b.substring(c,f));null===a&&(c=f);return a}function H(){var a;
/^[!-~]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[!-~]"));null===a&&(a=J());return a}function J(){var a;/^[\x80-\uFFFF]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[\\x80-\\uFFFF]"));return a}function I(){var a;/^[\x80-\xBF]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[\\x80-\\xBF]"));return a}function A(){var a,h,p;p=c;h=n();if(null===h&&(45===b.charCodeAt(c)?(h="-",c++):(h=null,0===j&&d('"-"')),null===h))if(46===b.charCodeAt(c)?(h=".",c++):(h=null,0===j&&
d('"."')),null===h)if(33===b.charCodeAt(c)?(h="!",c++):(h=null,0===j&&d('"!"')),null===h)if(37===b.charCodeAt(c)?(h="%",c++):(h=null,0===j&&d('"%"')),null===h)if(42===b.charCodeAt(c)?(h="*",c++):(h=null,0===j&&d('"*"')),null===h)if(95===b.charCodeAt(c)?(h="_",c++):(h=null,0===j&&d('"_"')),null===h)if(43===b.charCodeAt(c)?(h="+",c++):(h=null,0===j&&d('"+"')),null===h)if(96===b.charCodeAt(c)?(h="`",c++):(h=null,0===j&&d('"`"')),null===h)if(39===b.charCodeAt(c)?(h="'",c++):(h=null,0===j&&d('"\'"')),
null===h)126===b.charCodeAt(c)?(h="~",c++):(h=null,0===j&&d('"~"'));if(null!==h)for(a=[];null!==h;){if(a.push(h),h=n(),null===h&&(45===b.charCodeAt(c)?(h="-",c++):(h=null,0===j&&d('"-"')),null===h))if(46===b.charCodeAt(c)?(h=".",c++):(h=null,0===j&&d('"."')),null===h)if(33===b.charCodeAt(c)?(h="!",c++):(h=null,0===j&&d('"!"')),null===h)if(37===b.charCodeAt(c)?(h="%",c++):(h=null,0===j&&d('"%"')),null===h)if(42===b.charCodeAt(c)?(h="*",c++):(h=null,0===j&&d('"*"')),null===h)if(95===b.charCodeAt(c)?
(h="_",c++):(h=null,0===j&&d('"_"')),null===h)if(43===b.charCodeAt(c)?(h="+",c++):(h=null,0===j&&d('"+"')),null===h)if(96===b.charCodeAt(c)?(h="`",c++):(h=null,0===j&&d('"`"')),null===h)if(39===b.charCodeAt(c)?(h="'",c++):(h=null,0===j&&d('"\'"')),null===h)126===b.charCodeAt(c)?(h="~",c++):(h=null,0===j&&d('"~"'))}else a=null;null!==a&&(a=b.substring(c,p));null===a&&(c=p);return a}function da(){var a,h,p;p=c;h=n();if(null===h&&(45===b.charCodeAt(c)?(h="-",c++):(h=null,0===j&&d('"-"')),null===h))if(33===
b.charCodeAt(c)?(h="!",c++):(h=null,0===j&&d('"!"')),null===h)if(37===b.charCodeAt(c)?(h="%",c++):(h=null,0===j&&d('"%"')),null===h)if(42===b.charCodeAt(c)?(h="*",c++):(h=null,0===j&&d('"*"')),null===h)if(95===b.charCodeAt(c)?(h="_",c++):(h=null,0===j&&d('"_"')),null===h)if(43===b.charCodeAt(c)?(h="+",c++):(h=null,0===j&&d('"+"')),null===h)if(96===b.charCodeAt(c)?(h="`",c++):(h=null,0===j&&d('"`"')),null===h)if(39===b.charCodeAt(c)?(h="'",c++):(h=null,0===j&&d('"\'"')),null===h)126===b.charCodeAt(c)?
(h="~",c++):(h=null,0===j&&d('"~"'));if(null!==h)for(a=[];null!==h;){if(a.push(h),h=n(),null===h&&(45===b.charCodeAt(c)?(h="-",c++):(h=null,0===j&&d('"-"')),null===h))if(33===b.charCodeAt(c)?(h="!",c++):(h=null,0===j&&d('"!"')),null===h)if(37===b.charCodeAt(c)?(h="%",c++):(h=null,0===j&&d('"%"')),null===h)if(42===b.charCodeAt(c)?(h="*",c++):(h=null,0===j&&d('"*"')),null===h)if(95===b.charCodeAt(c)?(h="_",c++):(h=null,0===j&&d('"_"')),null===h)if(43===b.charCodeAt(c)?(h="+",c++):(h=null,0===j&&d('"+"')),
null===h)if(96===b.charCodeAt(c)?(h="`",c++):(h=null,0===j&&d('"`"')),null===h)if(39===b.charCodeAt(c)?(h="'",c++):(h=null,0===j&&d('"\'"')),null===h)126===b.charCodeAt(c)?(h="~",c++):(h=null,0===j&&d('"~"'))}else a=null;null!==a&&(a=b.substring(c,p));null===a&&(c=p);return a}function Ba(){var a,h,p;p=c;h=n();if(null===h&&(45===b.charCodeAt(c)?(h="-",c++):(h=null,0===j&&d('"-"')),null===h))if(46===b.charCodeAt(c)?(h=".",c++):(h=null,0===j&&d('"."')),null===h)if(33===b.charCodeAt(c)?(h="!",c++):(h=
null,0===j&&d('"!"')),null===h)if(37===b.charCodeAt(c)?(h="%",c++):(h=null,0===j&&d('"%"')),null===h)if(42===b.charCodeAt(c)?(h="*",c++):(h=null,0===j&&d('"*"')),null===h)if(95===b.charCodeAt(c)?(h="_",c++):(h=null,0===j&&d('"_"')),null===h)if(43===b.charCodeAt(c)?(h="+",c++):(h=null,0===j&&d('"+"')),null===h)if(96===b.charCodeAt(c)?(h="`",c++):(h=null,0===j&&d('"`"')),null===h)if(39===b.charCodeAt(c)?(h="'",c++):(h=null,0===j&&d('"\'"')),null===h)if(126===b.charCodeAt(c)?(h="~",c++):(h=null,0===
j&&d('"~"')),null===h)if(40===b.charCodeAt(c)?(h="(",c++):(h=null,0===j&&d('"("')),null===h)if(41===b.charCodeAt(c)?(h=")",c++):(h=null,0===j&&d('")"')),null===h)if(60===b.charCodeAt(c)?(h="<",c++):(h=null,0===j&&d('"<"')),null===h)if(62===b.charCodeAt(c)?(h=">",c++):(h=null,0===j&&d('">"')),null===h)if(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null===h)if(92===b.charCodeAt(c)?(h="\\",c++):(h=null,0===j&&d('"\\\\"')),null===h)if(h=C(),null===h&&(47===b.charCodeAt(c)?(h="/",c++):(h=
null,0===j&&d('"/"')),null===h))if(91===b.charCodeAt(c)?(h="[",c++):(h=null,0===j&&d('"["')),null===h)if(93===b.charCodeAt(c)?(h="]",c++):(h=null,0===j&&d('"]"')),null===h)if(63===b.charCodeAt(c)?(h="?",c++):(h=null,0===j&&d('"?"')),null===h)if(123===b.charCodeAt(c)?(h="{",c++):(h=null,0===j&&d('"{"')),null===h)125===b.charCodeAt(c)?(h="}",c++):(h=null,0===j&&d('"}"'));if(null!==h)for(a=[];null!==h;){if(a.push(h),h=n(),null===h&&(45===b.charCodeAt(c)?(h="-",c++):(h=null,0===j&&d('"-"')),null===h))if(46===
b.charCodeAt(c)?(h=".",c++):(h=null,0===j&&d('"."')),null===h)if(33===b.charCodeAt(c)?(h="!",c++):(h=null,0===j&&d('"!"')),null===h)if(37===b.charCodeAt(c)?(h="%",c++):(h=null,0===j&&d('"%"')),null===h)if(42===b.charCodeAt(c)?(h="*",c++):(h=null,0===j&&d('"*"')),null===h)if(95===b.charCodeAt(c)?(h="_",c++):(h=null,0===j&&d('"_"')),null===h)if(43===b.charCodeAt(c)?(h="+",c++):(h=null,0===j&&d('"+"')),null===h)if(96===b.charCodeAt(c)?(h="`",c++):(h=null,0===j&&d('"`"')),null===h)if(39===b.charCodeAt(c)?
(h="'",c++):(h=null,0===j&&d('"\'"')),null===h)if(126===b.charCodeAt(c)?(h="~",c++):(h=null,0===j&&d('"~"')),null===h)if(40===b.charCodeAt(c)?(h="(",c++):(h=null,0===j&&d('"("')),null===h)if(41===b.charCodeAt(c)?(h=")",c++):(h=null,0===j&&d('")"')),null===h)if(60===b.charCodeAt(c)?(h="<",c++):(h=null,0===j&&d('"<"')),null===h)if(62===b.charCodeAt(c)?(h=">",c++):(h=null,0===j&&d('">"')),null===h)if(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null===h)if(92===b.charCodeAt(c)?(h="\\",c++):
(h=null,0===j&&d('"\\\\"')),null===h)if(h=C(),null===h&&(47===b.charCodeAt(c)?(h="/",c++):(h=null,0===j&&d('"/"')),null===h))if(91===b.charCodeAt(c)?(h="[",c++):(h=null,0===j&&d('"["')),null===h)if(93===b.charCodeAt(c)?(h="]",c++):(h=null,0===j&&d('"]"')),null===h)if(63===b.charCodeAt(c)?(h="?",c++):(h=null,0===j&&d('"?"')),null===h)if(123===b.charCodeAt(c)?(h="{",c++):(h=null,0===j&&d('"{"')),null===h)125===b.charCodeAt(c)?(h="}",c++):(h=null,0===j&&d('"}"'))}else a=null;null!==a&&(a=b.substring(c,
p));null===a&&(c=p);return a}function fb(){var a,h,p,e,f;f=e=c;a=t();null!==a?(42===b.charCodeAt(c)?(h="*",c++):(h=null,0===j&&d('"*"')),null!==h)?(p=t(),null!==p?a=[a,h,p]:(a=null,c=f)):(a=null,c=f):(a=null,c=f);null!==a&&(a="*");null===a&&(c=e);return a}function ea(){var a,h,p,e,f;f=e=c;a=t();null!==a?(47===b.charCodeAt(c)?(h="/",c++):(h=null,0===j&&d('"/"')),null!==h)?(p=t(),null!==p?a=[a,h,p]:(a=null,c=f)):(a=null,c=f):(a=null,c=f);null!==a&&(a="/");null===a&&(c=e);return a}function E(){var a,
h,p,e,f;f=e=c;a=t();null!==a?(61===b.charCodeAt(c)?(h="=",c++):(h=null,0===j&&d('"="')),null!==h)?(p=t(),null!==p?a=[a,h,p]:(a=null,c=f)):(a=null,c=f):(a=null,c=f);null!==a&&(a="=");null===a&&(c=e);return a}function gb(){var a,h,p,e,f;f=e=c;a=t();null!==a?(40===b.charCodeAt(c)?(h="(",c++):(h=null,0===j&&d('"("')),null!==h)?(p=t(),null!==p?a=[a,h,p]:(a=null,c=f)):(a=null,c=f):(a=null,c=f);null!==a&&(a="(");null===a&&(c=e);return a}function hb(){var a,h,p,e,f;f=e=c;a=t();null!==a?(41===b.charCodeAt(c)?
(h=")",c++):(h=null,0===j&&d('")"')),null!==h)?(p=t(),null!==p?a=[a,h,p]:(a=null,c=f)):(a=null,c=f):(a=null,c=f);null!==a&&(a=")");null===a&&(c=e);return a}function Ca(){var a,h,p,e;e=p=c;62===b.charCodeAt(c)?(a=">",c++):(a=null,0===j&&d('">"'));null!==a?(h=t(),null!==h?a=[a,h]:(a=null,c=e)):(a=null,c=e);null!==a&&(a=">");null===a&&(c=p);return a}function Da(){var a,h,p,e;e=p=c;a=t();null!==a?(60===b.charCodeAt(c)?(h="<",c++):(h=null,0===j&&d('"<"')),null!==h)?a=[a,h]:(a=null,c=e):(a=null,c=e);null!==
a&&(a="<");null===a&&(c=p);return a}function F(){var a,h,p,e,f;f=e=c;a=t();null!==a?(44===b.charCodeAt(c)?(h=",",c++):(h=null,0===j&&d('","')),null!==h)?(p=t(),null!==p?a=[a,h,p]:(a=null,c=f)):(a=null,c=f):(a=null,c=f);null!==a&&(a=",");null===a&&(c=e);return a}function G(){var a,h,p,e,f;f=e=c;a=t();null!==a?(59===b.charCodeAt(c)?(h=";",c++):(h=null,0===j&&d('";"')),null!==h)?(p=t(),null!==p?a=[a,h,p]:(a=null,c=f)):(a=null,c=f):(a=null,c=f);null!==a&&(a=";");null===a&&(c=e);return a}function ib(){var a,
h,p,e,f;f=e=c;a=t();null!==a?(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h)?(p=t(),null!==p?a=[a,h,p]:(a=null,c=f)):(a=null,c=f):(a=null,c=f);null!==a&&(a=":");null===a&&(c=e);return a}function Ea(){var a,b,d,e;e=d=c;a=t();null!==a?(b=C(),null!==b?a=[a,b]:(a=null,c=e)):(a=null,c=e);null!==a&&(a='"');null===a&&(c=d);return a}function Fa(){var a,b,d,e;e=d=c;a=C();null!==a?(b=t(),null!==b?a=[a,b]:(a=null,c=e)):(a=null,c=e);null!==a&&(a='"');null===a&&(c=d);return a}function Ga(){var a,
b,d,e;e=c;a=gb();if(null!==a){b=[];d=Ha();null===d&&(d=N(),null===d&&(d=Ga()));for(;null!==d;)b.push(d),d=Ha(),null===d&&(d=N(),null===d&&(d=Ga()));null!==b?(d=hb(),null!==d?a=[a,b,d]:(a=null,c=e)):(a=null,c=e)}else a=null,c=e;return a}function Ha(){var a;/^[!-']/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[!-']"));if(null===a&&(/^[*-[]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[*-[]")),null===a))if(/^[\]-~]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[\\]-~]")),
null===a)a=J(),null===a&&(a=x());return a}function S(){var a,h,d,e,f,g;g=f=c;a=t();if(null!==a)if(h=C(),null!==h){d=[];e=T();for(null===e&&(e=N());null!==e;)d.push(e),e=T(),null===e&&(e=N());null!==d?(e=C(),null!==e?a=[a,h,d,e]:(a=null,c=g)):(a=null,c=g)}else a=null,c=g;else a=null,c=g;null!==a&&(a=b.substring(c,f));null===a&&(c=f);return a}function fa(){var a,h,d,e,f,g;g=f=c;a=t();if(null!==a)if(h=C(),null!==h){d=[];e=T();for(null===e&&(e=N());null!==e;)d.push(e),e=T(),null===e&&(e=N());null!==d?
(e=C(),null!==e?a=[a,h,d,e]:(a=null,c=g)):(a=null,c=g)}else a=null,c=g;else a=null,c=g;null!==a&&(a=b.substring(c-1,f+1));null===a&&(c=f);return a}function T(){var a;a=x();if(null===a&&(33===b.charCodeAt(c)?(a="!",c++):(a=null,0===j&&d('"!"')),null===a))if(/^[#-[]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[#-[]")),null===a)/^[\]-~]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[\\]-~]")),null===a&&(a=J());return a}function N(){var a,h,p;p=c;92===b.charCodeAt(c)?(a="\\",c++):
(a=null,0===j&&d('"\\\\"'));if(null!==a){/^[\0-\t]/.test(b.charAt(c))?(h=b.charAt(c),c++):(h=null,0===j&&d("[\\0-\\t]"));if(null===h&&(/^[\x0B-\f]/.test(b.charAt(c))?(h=b.charAt(c),c++):(h=null,0===j&&d("[\\x0B-\\f]")),null===h))/^[\x0E-\u007f]/.test(b.charAt(c))?(h=b.charAt(c),c++):(h=null,0===j&&d("[\\x0E-\u007f]"));null!==h?a=[a,h]:(a=null,c=p)}else a=null,c=p;return a}function ga(){var a,h,p,e,f,g;g=f=c;a=Ia();null!==a?(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h)?(p=ha(),
p=null!==p?p:"",null!==p?(e=ia(),null!==e?a=[a,h,p,e]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g):(a=null,c=g);if(null!==a){try{q.uri=new JsSIP.URI(q.scheme,q.user,q.host,q.port),delete q.scheme,delete q.user,delete q.host,delete q.host_type,delete q.port}catch(i){q=-1}a=void 0}null===a&&(c=f);return a}function ja(){var a,h,p,e,f,i,k,l;l=k=c;a=Ia();null!==a?(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h)?(p=ha(),p=null!==p?p:"",null!==p?(e=ia(),null!==e?(f=jb(),null!==f?(i=kb(),
i=null!==i?i:"",null!==i?a=[a,h,p,e,f,i]:(a=null,c=l)):(a=null,c=l)):(a=null,c=l)):(a=null,c=l)):(a=null,c=l):(a=null,c=l);if(null!==a){try{q.uri=new JsSIP.URI(q.scheme,q.user,q.host,q.port,q.uri_params,q.uri_headers),delete q.scheme,delete q.user,delete q.host,delete q.host_type,delete q.port,delete q.uri_params,"SIP_URI"===g&&(q=q.uri)}catch(o){q=-1}a=void 0}null===a&&(c=k);return a}function Ia(){var a,h;h=c;"sip"===b.substr(c,3).toLowerCase()?(a=b.substr(c,3),c+=3):(a=null,0===j&&d('"sip"'));null!==
a&&(q.scheme=a.toLowerCase(),a=void 0);null===a&&(c=h);return a}function ha(){var a,h,p,e,f,g;f=e=c;a=lb();null!==a?(g=c,58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h?(p=mb(),null!==p?h=[h,p]:(h=null,c=g)):(h=null,c=g),h=null!==h?h:"",null!==h)?(64===b.charCodeAt(c)?(p="@",c++):(p=null,0===j&&d('"@"')),null!==p)?a=[a,h,p]:(a=null,c=f):(a=null,c=f):(a=null,c=f);null!==a&&(q.user=window.decodeURIComponent(b.substring(c-1,e)),a=void 0);null===a&&(c=e);return a}function lb(){var a,
c;c=r();null===c&&(c=s(),null===c&&(c=Ja()));if(null!==c)for(a=[];null!==c;)a.push(c),c=r(),null===c&&(c=s(),null===c&&(c=Ja()));else a=null;return a}function Ja(){var a;38===b.charCodeAt(c)?(a="&",c++):(a=null,0===j&&d('"&"'));if(null===a&&(61===b.charCodeAt(c)?(a="=",c++):(a=null,0===j&&d('"="')),null===a))if(43===b.charCodeAt(c)?(a="+",c++):(a=null,0===j&&d('"+"')),null===a)if(36===b.charCodeAt(c)?(a="$",c++):(a=null,0===j&&d('"$"')),null===a)if(44===b.charCodeAt(c)?(a=",",c++):(a=null,0===j&&
d('","')),null===a)if(59===b.charCodeAt(c)?(a=";",c++):(a=null,0===j&&d('";"')),null===a)if(63===b.charCodeAt(c)?(a="?",c++):(a=null,0===j&&d('"?"')),null===a)47===b.charCodeAt(c)?(a="/",c++):(a=null,0===j&&d('"/"'));return a}function mb(){var a,h,p;p=c;a=[];h=r();if(null===h&&(h=s(),null===h&&(38===b.charCodeAt(c)?(h="&",c++):(h=null,0===j&&d('"&"')),null===h)))if(61===b.charCodeAt(c)?(h="=",c++):(h=null,0===j&&d('"="')),null===h)if(43===b.charCodeAt(c)?(h="+",c++):(h=null,0===j&&d('"+"')),null===
h)if(36===b.charCodeAt(c)?(h="$",c++):(h=null,0===j&&d('"$"')),null===h)44===b.charCodeAt(c)?(h=",",c++):(h=null,0===j&&d('","'));for(;null!==h;)if(a.push(h),h=r(),null===h&&(h=s(),null===h&&(38===b.charCodeAt(c)?(h="&",c++):(h=null,0===j&&d('"&"')),null===h)))if(61===b.charCodeAt(c)?(h="=",c++):(h=null,0===j&&d('"="')),null===h)if(43===b.charCodeAt(c)?(h="+",c++):(h=null,0===j&&d('"+"')),null===h)if(36===b.charCodeAt(c)?(h="$",c++):(h=null,0===j&&d('"$"')),null===h)44===b.charCodeAt(c)?(h=",",c++):
(h=null,0===j&&d('","'));null!==a&&(q.password=b.substring(c,p),a=void 0);null===a&&(c=p);return a}function ia(){var a,h,p,e,f;e=c;a=U();null!==a?(f=c,58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h?(p=Ka(),null!==p?h=[h,p]:(h=null,c=f)):(h=null,c=f),h=null!==h?h:"",null!==h)?a=[a,h]:(a=null,c=e):(a=null,c=e);return a}function U(){var a,h;h=c;a=La();null===a&&(a=O(),null===a&&(a=ka()));null!==a&&(q.host=b.substring(c,h).toLowerCase(),a=q.host);null===a&&(c=h);return a}function La(){var a,
h,p,e,f,g;f=e=c;a=[];g=c;h=Ma();null!==h?(46===b.charCodeAt(c)?(p=".",c++):(p=null,0===j&&d('"."')),null!==p)?h=[h,p]:(h=null,c=g):(h=null,c=g);for(;null!==h;)(a.push(h),g=c,h=Ma(),null!==h)?(46===b.charCodeAt(c)?(p=".",c++):(p=null,0===j&&d('"."')),null!==p)?h=[h,p]:(h=null,c=g):(h=null,c=g);null!==a?(h=nb(),null!==h)?(46===b.charCodeAt(c)?(p=".",c++):(p=null,0===j&&d('"."')),p=null!==p?p:"",null!==p)?a=[a,h,p]:(a=null,c=f):(a=null,c=f):(a=null,c=f);null!==a&&(q.host_type="domain",a=b.substring(c,
e));null===a&&(c=e);return a}function Ma(){var a,h;/^[a-zA-Z0-9_\-]/.test(b.charAt(c))?(h=b.charAt(c),c++):(h=null,0===j&&d("[a-zA-Z0-9_\\-]"));if(null!==h)for(a=[];null!==h;)a.push(h),/^[a-zA-Z0-9_\-]/.test(b.charAt(c))?(h=b.charAt(c),c++):(h=null,0===j&&d("[a-zA-Z0-9_\\-]"));else a=null;return a}function nb(){var a,h;/^[a-zA-Z_\-]/.test(b.charAt(c))?(h=b.charAt(c),c++):(h=null,0===j&&d("[a-zA-Z_\\-]"));if(null!==h)for(a=[];null!==h;)a.push(h),/^[a-zA-Z_\-]/.test(b.charAt(c))?(h=b.charAt(c),c++):
(h=null,0===j&&d("[a-zA-Z_\\-]"));else a=null;return a}function ka(){var a,h,p,e,f;f=e=c;91===b.charCodeAt(c)?(a="[",c++):(a=null,0===j&&d('"["'));null!==a?(h=Na(),null!==h)?(93===b.charCodeAt(c)?(p="]",c++):(p=null,0===j&&d('"]"')),null!==p)?a=[a,h,p]:(a=null,c=f):(a=null,c=f):(a=null,c=f);null!==a&&(q.host_type="IPv6",a=b.substring(c,e));null===a&&(c=e);return a}function Na(){var a,h,p,e,f,g,i,k,l,o,m,r,v,A,n;n=A=c;a=y();null!==a?(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==
h)?(p=y(),null!==p)?(58===b.charCodeAt(c)?(e=":",c++):(e=null,0===j&&d('":"')),null!==e)?(f=y(),null!==f)?(58===b.charCodeAt(c)?(g=":",c++):(g=null,0===j&&d('":"')),null!==g)?(i=y(),null!==i)?(58===b.charCodeAt(c)?(k=":",c++):(k=null,0===j&&d('":"')),null!==k)?(l=y(),null!==l)?(58===b.charCodeAt(c)?(o=":",c++):(o=null,0===j&&d('":"')),null!==o)?(m=y(),null!==m)?(58===b.charCodeAt(c)?(r=":",c++):(r=null,0===j&&d('":"')),null!==r)?(v=L(),null!==v?a=[a,h,p,e,f,g,i,k,l,o,m,r,v]:(a=null,c=n)):(a=null,
c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n);if(null===a&&(n=c,"::"===b.substr(c,2)?(a="::",c+=2):(a=null,0===j&&d('"::"')),null!==a?(h=y(),null!==h)?(58===b.charCodeAt(c)?(p=":",c++):(p=null,0===j&&d('":"')),null!==p)?(e=y(),null!==e)?(58===b.charCodeAt(c)?(f=":",c++):(f=null,0===j&&d('":"')),null!==f)?(g=y(),null!==g)?(58===b.charCodeAt(c)?(i=":",c++):(i=null,0===j&&d('":"')),null!==i)?(k=y(),
null!==k)?(58===b.charCodeAt(c)?(l=":",c++):(l=null,0===j&&d('":"')),null!==l)?(o=y(),null!==o)?(58===b.charCodeAt(c)?(m=":",c++):(m=null,0===j&&d('":"')),null!==m)?(r=L(),null!==r?a=[a,h,p,e,f,g,i,k,l,o,m,r]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a))if(n=c,"::"===b.substr(c,2)?(a="::",c+=2):(a=null,0===j&&d('"::"')),null!==a?(h=y(),null!==h)?(58===b.charCodeAt(c)?(p=":",c++):
(p=null,0===j&&d('":"')),null!==p)?(e=y(),null!==e)?(58===b.charCodeAt(c)?(f=":",c++):(f=null,0===j&&d('":"')),null!==f)?(g=y(),null!==g)?(58===b.charCodeAt(c)?(i=":",c++):(i=null,0===j&&d('":"')),null!==i)?(k=y(),null!==k)?(58===b.charCodeAt(c)?(l=":",c++):(l=null,0===j&&d('":"')),null!==l)?(o=L(),null!==o?a=[a,h,p,e,f,g,i,k,l,o]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a)if(n=c,"::"===b.substr(c,2)?
(a="::",c+=2):(a=null,0===j&&d('"::"')),null!==a?(h=y(),null!==h)?(58===b.charCodeAt(c)?(p=":",c++):(p=null,0===j&&d('":"')),null!==p)?(e=y(),null!==e)?(58===b.charCodeAt(c)?(f=":",c++):(f=null,0===j&&d('":"')),null!==f)?(g=y(),null!==g)?(58===b.charCodeAt(c)?(i=":",c++):(i=null,0===j&&d('":"')),null!==i)?(k=L(),null!==k?a=[a,h,p,e,f,g,i,k]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a)if(n=c,"::"===b.substr(c,2)?(a="::",c+=2):(a=
null,0===j&&d('"::"')),null!==a?(h=y(),null!==h)?(58===b.charCodeAt(c)?(p=":",c++):(p=null,0===j&&d('":"')),null!==p)?(e=y(),null!==e)?(58===b.charCodeAt(c)?(f=":",c++):(f=null,0===j&&d('":"')),null!==f)?(g=L(),null!==g?a=[a,h,p,e,f,g]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a)if(n=c,"::"===b.substr(c,2)?(a="::",c+=2):(a=null,0===j&&d('"::"')),null!==a?(h=y(),null!==h)?(58===b.charCodeAt(c)?(p=":",c++):(p=null,0===j&&d('":"')),null!==p)?(e=L(),null!==
e?a=[a,h,p,e]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a)if(n=c,"::"===b.substr(c,2)?(a="::",c+=2):(a=null,0===j&&d('"::"')),null!==a?(h=L(),null!==h?a=[a,h]:(a=null,c=n)):(a=null,c=n),null===a)if(n=c,"::"===b.substr(c,2)?(a="::",c+=2):(a=null,0===j&&d('"::"')),null!==a?(h=y(),null!==h?a=[a,h]:(a=null,c=n)):(a=null,c=n),null===a)if(n=c,a=y(),null!==a?("::"===b.substr(c,2)?(h="::",c+=2):(h=null,0===j&&d('"::"')),null!==h)?(p=y(),null!==p)?(58===b.charCodeAt(c)?(e=":",c++):(e=null,
0===j&&d('":"')),null!==e)?(f=y(),null!==f)?(58===b.charCodeAt(c)?(g=":",c++):(g=null,0===j&&d('":"')),null!==g)?(i=y(),null!==i)?(58===b.charCodeAt(c)?(k=":",c++):(k=null,0===j&&d('":"')),null!==k)?(l=y(),null!==l)?(58===b.charCodeAt(c)?(o=":",c++):(o=null,0===j&&d('":"')),null!==o)?(m=L(),null!==m?a=[a,h,p,e,f,g,i,k,l,o,m]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a)if(n=c,a=y(),null!==a?
(l=c,58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h?(p=y(),null!==p?h=[h,p]:(h=null,c=l)):(h=null,c=l),h=null!==h?h:"",null!==h)?("::"===b.substr(c,2)?(p="::",c+=2):(p=null,0===j&&d('"::"')),null!==p)?(e=y(),null!==e)?(58===b.charCodeAt(c)?(f=":",c++):(f=null,0===j&&d('":"')),null!==f)?(g=y(),null!==g)?(58===b.charCodeAt(c)?(i=":",c++):(i=null,0===j&&d('":"')),null!==i)?(k=y(),null!==k)?(58===b.charCodeAt(c)?(l=":",c++):(l=null,0===j&&d('":"')),null!==l)?(o=L(),null!==o?a=[a,h,
p,e,f,g,i,k,l,o]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a)if(n=c,a=y(),null!==a?(l=c,58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h?(p=y(),null!==p?h=[h,p]:(h=null,c=l)):(h=null,c=l),h=null!==h?h:"",null!==h)?(l=c,58===b.charCodeAt(c)?(p=":",c++):(p=null,0===j&&d('":"')),null!==p?(e=y(),null!==e?p=[p,e]:(p=null,c=l)):(p=null,c=l),p=null!==p?p:"",null!==p)?("::"===b.substr(c,2)?(e=
"::",c+=2):(e=null,0===j&&d('"::"')),null!==e)?(f=y(),null!==f)?(58===b.charCodeAt(c)?(g=":",c++):(g=null,0===j&&d('":"')),null!==g)?(i=y(),null!==i)?(58===b.charCodeAt(c)?(k=":",c++):(k=null,0===j&&d('":"')),null!==k)?(l=L(),null!==l?a=[a,h,p,e,f,g,i,k,l]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a)if(n=c,a=y(),null!==a?(l=c,58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h?(p=y(),null!==p?h=[h,p]:
(h=null,c=l)):(h=null,c=l),h=null!==h?h:"",null!==h)?(l=c,58===b.charCodeAt(c)?(p=":",c++):(p=null,0===j&&d('":"')),null!==p?(e=y(),null!==e?p=[p,e]:(p=null,c=l)):(p=null,c=l),p=null!==p?p:"",null!==p)?(l=c,58===b.charCodeAt(c)?(e=":",c++):(e=null,0===j&&d('":"')),null!==e?(f=y(),null!==f?e=[e,f]:(e=null,c=l)):(e=null,c=l),e=null!==e?e:"",null!==e)?("::"===b.substr(c,2)?(f="::",c+=2):(f=null,0===j&&d('"::"')),null!==f)?(g=y(),null!==g)?(58===b.charCodeAt(c)?(i=":",c++):(i=null,0===j&&d('":"')),null!==
i)?(k=L(),null!==k?a=[a,h,p,e,f,g,i,k]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a)if(n=c,a=y(),null!==a?(l=c,58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h?(p=y(),null!==p?h=[h,p]:(h=null,c=l)):(h=null,c=l),h=null!==h?h:"",null!==h)?(l=c,58===b.charCodeAt(c)?(p=":",c++):(p=null,0===j&&d('":"')),null!==p?(e=y(),null!==e?p=[p,e]:(p=null,c=l)):(p=null,c=l),p=null!==p?p:"",null!==p)?(l=c,58===b.charCodeAt(c)?(e=
":",c++):(e=null,0===j&&d('":"')),null!==e?(f=y(),null!==f?e=[e,f]:(e=null,c=l)):(e=null,c=l),e=null!==e?e:"",null!==e)?(l=c,58===b.charCodeAt(c)?(f=":",c++):(f=null,0===j&&d('":"')),null!==f?(g=y(),null!==g?f=[f,g]:(f=null,c=l)):(f=null,c=l),f=null!==f?f:"",null!==f)?("::"===b.substr(c,2)?(g="::",c+=2):(g=null,0===j&&d('"::"')),null!==g)?(i=L(),null!==i?a=[a,h,p,e,f,g,i]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a)if(n=c,a=y(),null!==a?(l=
c,58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h?(p=y(),null!==p?h=[h,p]:(h=null,c=l)):(h=null,c=l),h=null!==h?h:"",null!==h)?(l=c,58===b.charCodeAt(c)?(p=":",c++):(p=null,0===j&&d('":"')),null!==p?(e=y(),null!==e?p=[p,e]:(p=null,c=l)):(p=null,c=l),p=null!==p?p:"",null!==p)?(l=c,58===b.charCodeAt(c)?(e=":",c++):(e=null,0===j&&d('":"')),null!==e?(f=y(),null!==f?e=[e,f]:(e=null,c=l)):(e=null,c=l),e=null!==e?e:"",null!==e)?(l=c,58===b.charCodeAt(c)?(f=":",c++):(f=null,0===j&&d('":"')),
null!==f?(g=y(),null!==g?f=[f,g]:(f=null,c=l)):(f=null,c=l),f=null!==f?f:"",null!==f)?(l=c,58===b.charCodeAt(c)?(g=":",c++):(g=null,0===j&&d('":"')),null!==g?(i=y(),null!==i?g=[g,i]:(g=null,c=l)):(g=null,c=l),g=null!==g?g:"",null!==g)?("::"===b.substr(c,2)?(i="::",c+=2):(i=null,0===j&&d('"::"')),null!==i)?(k=y(),null!==k?a=[a,h,p,e,f,g,i,k]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n),null===a)(n=c,a=y(),null!==a)?(l=c,58===b.charCodeAt(c)?
(h=":",c++):(h=null,0===j&&d('":"')),null!==h?(p=y(),null!==p?h=[h,p]:(h=null,c=l)):(h=null,c=l),h=null!==h?h:"",null!==h)?(l=c,58===b.charCodeAt(c)?(p=":",c++):(p=null,0===j&&d('":"')),null!==p?(e=y(),null!==e?p=[p,e]:(p=null,c=l)):(p=null,c=l),p=null!==p?p:"",null!==p)?(l=c,58===b.charCodeAt(c)?(e=":",c++):(e=null,0===j&&d('":"')),null!==e?(f=y(),null!==f?e=[e,f]:(e=null,c=l)):(e=null,c=l),e=null!==e?e:"",null!==e)?(l=c,58===b.charCodeAt(c)?(f=":",c++):(f=null,0===j&&d('":"')),null!==f?(g=y(),null!==
g?f=[f,g]:(f=null,c=l)):(f=null,c=l),f=null!==f?f:"",null!==f)?(l=c,58===b.charCodeAt(c)?(g=":",c++):(g=null,0===j&&d('":"')),null!==g?(i=y(),null!==i?g=[g,i]:(g=null,c=l)):(g=null,c=l),g=null!==g?g:"",null!==g)?(l=c,58===b.charCodeAt(c)?(i=":",c++):(i=null,0===j&&d('":"')),null!==i?(k=y(),null!==k?i=[i,k]:(i=null,c=l)):(i=null,c=l),i=null!==i?i:"",null!==i)?("::"===b.substr(c,2)?(k="::",c+=2):(k=null,0===j&&d('"::"')),null!==k)?a=[a,h,p,e,f,g,i,k]:(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=
n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n);null!==a&&(q.host_type="IPv6",a=b.substring(c,A));null===a&&(c=A);return a}function y(){var a,b,d,e,f;f=c;a=k();null!==a?(b=k(),b=null!==b?b:"",null!==b?(d=k(),d=null!==d?d:"",null!==d?(e=k(),e=null!==e?e:"",null!==e?a=[a,b,d,e]:(a=null,c=f)):(a=null,c=f)):(a=null,c=f)):(a=null,c=f);return a}function L(){var a,h,e,f;f=c;a=y();null!==a?(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h)?(e=y(),null!==e?a=[a,h,e]:(a=null,c=f)):
(a=null,c=f):(a=null,c=f);null===a&&(a=O());return a}function O(){var a,h,e,f,g,i,k,l,n;n=l=c;a=V();null!==a?(46===b.charCodeAt(c)?(h=".",c++):(h=null,0===j&&d('"."')),null!==h)?(e=V(),null!==e)?(46===b.charCodeAt(c)?(f=".",c++):(f=null,0===j&&d('"."')),null!==f)?(g=V(),null!==g)?(46===b.charCodeAt(c)?(i=".",c++):(i=null,0===j&&d('"."')),null!==i)?(k=V(),null!==k?a=[a,h,e,f,g,i,k]:(a=null,c=n)):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n):(a=null,c=n);null!==a&&(q.host_type="IPv4",
a=b.substring(c,l));null===a&&(c=l);return a}function V(){var a,h,f,g;g=c;"25"===b.substr(c,2)?(a="25",c+=2):(a=null,0===j&&d('"25"'));null!==a?(/^[0-5]/.test(b.charAt(c))?(h=b.charAt(c),c++):(h=null,0===j&&d("[0-5]")),null!==h)?a=[a,h]:(a=null,c=g):(a=null,c=g);if(null===a&&(g=c,50===b.charCodeAt(c)?(a="2",c++):(a=null,0===j&&d('"2"')),null!==a?(/^[0-4]/.test(b.charAt(c))?(h=b.charAt(c),c++):(h=null,0===j&&d("[0-4]")),null!==h)?(f=e(),null!==f?a=[a,h,f]:(a=null,c=g)):(a=null,c=g):(a=null,c=g),null===
a))if(g=c,49===b.charCodeAt(c)?(a="1",c++):(a=null,0===j&&d('"1"')),null!==a?(h=e(),null!==h?(f=e(),null!==f?a=[a,h,f]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g),null===a)g=c,/^[1-9]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[1-9]")),null!==a?(h=e(),null!==h?a=[a,h]:(a=null,c=g)):(a=null,c=g),null===a&&(a=e());return a}function Ka(){var a,b,d,f,g,i,j;j=i=c;a=e();a=null!==a?a:"";null!==a?(b=e(),b=null!==b?b:"",null!==b?(d=e(),d=null!==d?d:"",null!==d?(f=e(),f=null!==f?f:"",null!==f?(g=
e(),g=null!==g?g:"",null!==g?a=[a,b,d,f,g]:(a=null,c=j)):(a=null,c=j)):(a=null,c=j)):(a=null,c=j)):(a=null,c=j);null!==a&&(a=parseInt(a.join("")),q.port=a);null===a&&(c=i);return a}function jb(){var a,h,e,f;a=[];f=c;59===b.charCodeAt(c)?(h=";",c++):(h=null,0===j&&d('";"'));null!==h?(e=Oa(),null!==e?h=[h,e]:(h=null,c=f)):(h=null,c=f);for(;null!==h;)(a.push(h),f=c,59===b.charCodeAt(c)?(h=";",c++):(h=null,0===j&&d('";"')),null!==h)?(e=Oa(),null!==e?h=[h,e]:(h=null,c=f)):(h=null,c=f);return a}function Oa(){var a;
a=ob();null===a&&(a=pb(),null===a&&(a=qb(),null===a&&(a=rb(),null===a&&(a=sb(),null===a&&(a=tb(),null===a&&(a=ub()))))));return a}function ob(){var a,h,e,f;f=e=c;"transport="===b.substr(c,10).toLowerCase()?(a=b.substr(c,10),c+=10):(a=null,0===j&&d('"transport="'));if(null!==a){"udp"===b.substr(c,3).toLowerCase()?(h=b.substr(c,3),c+=3):(h=null,0===j&&d('"udp"'));if(null===h&&("tcp"===b.substr(c,3).toLowerCase()?(h=b.substr(c,3),c+=3):(h=null,0===j&&d('"tcp"')),null===h))if("sctp"===b.substr(c,4).toLowerCase()?
(h=b.substr(c,4),c+=4):(h=null,0===j&&d('"sctp"')),null===h)"tls"===b.substr(c,3).toLowerCase()?(h=b.substr(c,3),c+=3):(h=null,0===j&&d('"tls"')),null===h&&(h=A());null!==h?a=[a,h]:(a=null,c=f)}else a=null,c=f;null!==a&&(a=a[1],q.uri_params||(q.uri_params={}),q.uri_params.transport=a.toLowerCase(),a=void 0);null===a&&(c=e);return a}function pb(){var a,h,e,f;f=e=c;"user="===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"user="'));null!==a?("phone"===b.substr(c,5).toLowerCase()?
(h=b.substr(c,5),c+=5):(h=null,0===j&&d('"phone"')),null===h&&("ip"===b.substr(c,2).toLowerCase()?(h=b.substr(c,2),c+=2):(h=null,0===j&&d('"ip"')),null===h&&(h=A())),null!==h)?a=[a,h]:(a=null,c=f):(a=null,c=f);null!==a&&(a=a[1],q.uri_params||(q.uri_params={}),q.uri_params.user=a.toLowerCase(),a=void 0);null===a&&(c=e);return a}function qb(){var a,h,e,f;f=e=c;"method="===b.substr(c,7).toLowerCase()?(a=b.substr(c,7),c+=7):(a=null,0===j&&d('"method="'));null!==a?(h=la(),null!==h?a=[a,h]:(a=null,c=f)):
(a=null,c=f);null!==a&&(a=a[1],q.uri_params||(q.uri_params={}),q.uri_params.method=a,a=void 0);null===a&&(c=e);return a}function rb(){var a,h,e,f;f=e=c;"ttl="===b.substr(c,4).toLowerCase()?(a=b.substr(c,4),c+=4):(a=null,0===j&&d('"ttl="'));null!==a?(h=Pa(),null!==h?a=[a,h]:(a=null,c=f)):(a=null,c=f);null!==a&&(a=a[1],q.params||(q.params={}),q.params.ttl=a,a=void 0);null===a&&(c=e);return a}function sb(){var a,h,e,f;f=e=c;"maddr="===b.substr(c,6).toLowerCase()?(a=b.substr(c,6),c+=6):(a=null,0===j&&
d('"maddr="'));null!==a?(h=U(),null!==h?a=[a,h]:(a=null,c=f)):(a=null,c=f);null!==a&&(a=a[1],q.uri_params||(q.uri_params={}),q.uri_params.maddr=a,a=void 0);null===a&&(c=e);return a}function tb(){var a,h,e,f,g,i;g=f=c;"lr"===b.substr(c,2).toLowerCase()?(a=b.substr(c,2),c+=2):(a=null,0===j&&d('"lr"'));null!==a?(i=c,61===b.charCodeAt(c)?(h="=",c++):(h=null,0===j&&d('"="')),null!==h?(e=A(),null!==e?h=[h,e]:(h=null,c=i)):(h=null,c=i),h=null!==h?h:"",null!==h)?a=[a,h]:(a=null,c=g):(a=null,c=g);null!==a&&
(q.uri_params||(q.uri_params={}),a=q.uri_params.lr=void 0);null===a&&(c=f);return a}function ub(){var a,h,e,f,g,i;g=f=c;a=vb();null!==a?(i=c,61===b.charCodeAt(c)?(h="=",c++):(h=null,0===j&&d('"="')),null!==h?(e=wb(),null!==e?h=[h,e]:(h=null,c=i)):(h=null,c=i),h=null!==h?h:"",null!==h)?a=[a,h]:(a=null,c=g):(a=null,c=g);null!==a&&(h=a[0],a=a[1],q.uri_params||(q.uri_params={}),a="undefined"===typeof a?void 0:a[1],q.uri_params[h.toLowerCase()]=a&&a.toLowerCase(),a=void 0);null===a&&(c=f);return a}function vb(){var a,
b,d;d=c;b=W();if(null!==b)for(a=[];null!==b;)a.push(b),b=W();else a=null;null!==a&&(a=a.join(""));null===a&&(c=d);return a}function wb(){var a,b,d;d=c;b=W();if(null!==b)for(a=[];null!==b;)a.push(b),b=W();else a=null;null!==a&&(a=a.join(""));null===a&&(c=d);return a}function W(){var a;a=xb();null===a&&(a=r(),null===a&&(a=s()));return a}function xb(){var a;91===b.charCodeAt(c)?(a="[",c++):(a=null,0===j&&d('"["'));if(null===a&&(93===b.charCodeAt(c)?(a="]",c++):(a=null,0===j&&d('"]"')),null===a))if(47===
b.charCodeAt(c)?(a="/",c++):(a=null,0===j&&d('"/"')),null===a)if(58===b.charCodeAt(c)?(a=":",c++):(a=null,0===j&&d('":"')),null===a)if(38===b.charCodeAt(c)?(a="&",c++):(a=null,0===j&&d('"&"')),null===a)if(43===b.charCodeAt(c)?(a="+",c++):(a=null,0===j&&d('"+"')),null===a)36===b.charCodeAt(c)?(a="$",c++):(a=null,0===j&&d('"$"'));return a}function kb(){var a,h,e,f,g,i,k;i=c;63===b.charCodeAt(c)?(a="?",c++):(a=null,0===j&&d('"?"'));if(null!==a)if(h=ma(),null!==h){e=[];k=c;38===b.charCodeAt(c)?(f="&",
c++):(f=null,0===j&&d('"&"'));null!==f?(g=ma(),null!==g?f=[f,g]:(f=null,c=k)):(f=null,c=k);for(;null!==f;)(e.push(f),k=c,38===b.charCodeAt(c)?(f="&",c++):(f=null,0===j&&d('"&"')),null!==f)?(g=ma(),null!==g?f=[f,g]:(f=null,c=k)):(f=null,c=k);null!==e?a=[a,h,e]:(a=null,c=i)}else a=null,c=i;else a=null,c=i;return a}function ma(){var a,h,e,f,g;g=f=c;a=yb();null!==a?(61===b.charCodeAt(c)?(h="=",c++):(h=null,0===j&&d('"="')),null!==h)?(e=zb(),null!==e?a=[a,h,e]:(a=null,c=g)):(a=null,c=g):(a=null,c=g);null!==
a&&(h=a[0],a=a[2],h=h.join("").toLowerCase(),a=a.join(""),q.uri_headers||(q.uri_headers={}),q.uri_headers[h]?q.uri_headers[h].push(a):q.uri_headers[h]=[a],a=void 0);null===a&&(c=f);return a}function yb(){var a,c;c=X();null===c&&(c=r(),null===c&&(c=s()));if(null!==c)for(a=[];null!==c;)a.push(c),c=X(),null===c&&(c=r(),null===c&&(c=s()));else a=null;return a}function zb(){var a,c;a=[];c=X();null===c&&(c=r(),null===c&&(c=s()));for(;null!==c;)a.push(c),c=X(),null===c&&(c=r(),null===c&&(c=s()));return a}
function X(){var a;91===b.charCodeAt(c)?(a="[",c++):(a=null,0===j&&d('"["'));if(null===a&&(93===b.charCodeAt(c)?(a="]",c++):(a=null,0===j&&d('"]"')),null===a))if(47===b.charCodeAt(c)?(a="/",c++):(a=null,0===j&&d('"/"')),null===a)if(63===b.charCodeAt(c)?(a="?",c++):(a=null,0===j&&d('"?"')),null===a)if(58===b.charCodeAt(c)?(a=":",c++):(a=null,0===j&&d('":"')),null===a)if(43===b.charCodeAt(c)?(a="+",c++):(a=null,0===j&&d('"+"')),null===a)36===b.charCodeAt(c)?(a="$",c++):(a=null,0===j&&d('"$"'));return a}
function Ab(){var a,b,d,e,f,g;g=c;a=la();null!==a?(b=B(),null!==b?(d=Bb(),null!==d?(e=B(),null!==e?(f=Qa(),null!==f?a=[a,b,d,e,f]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g)):(a=null,c=g)):(a=null,c=g);return a}function Bb(){var a;a=ja();null===a&&(a=Ra());return a}function Ra(){var a,h,e,f;f=c;a=Cb();null!==a?(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null!==h)?(e=Db(),null===e&&(e=Eb()),null!==e?a=[a,h,e]:(a=null,c=f)):(a=null,c=f):(a=null,c=f);return a}function Db(){var a,h,e,f,g;
f=c;a=Fb();null===a&&(a=na());null!==a?(g=c,63===b.charCodeAt(c)?(h="?",c++):(h=null,0===j&&d('"?"')),null!==h?(e=Gb(),null!==e?h=[h,e]:(h=null,c=g)):(h=null,c=g),h=null!==h?h:"",null!==h)?a=[a,h]:(a=null,c=f):(a=null,c=f);return a}function Fb(){var a,h,e,f;f=c;"//"===b.substr(c,2)?(a="//",c+=2):(a=null,0===j&&d('"//"'));null!==a?(h=Hb(),null!==h?(e=na(),e=null!==e?e:"",null!==e?a=[a,h,e]:(a=null,c=f)):(a=null,c=f)):(a=null,c=f);return a}function na(){var a,h,e;e=c;47===b.charCodeAt(c)?(a="/",c++):
(a=null,0===j&&d('"/"'));null!==a?(h=Ib(),null!==h?a=[a,h]:(a=null,c=e)):(a=null,c=e);return a}function Eb(){var a,b,d,e;e=c;a=Jb();if(null!==a){b=[];for(d=Y();null!==d;)b.push(d),d=Y();null!==b?a=[a,b]:(a=null,c=e)}else a=null,c=e;return a}function Y(){var a;a=u();null===a&&(a=r(),null===a&&(a=s()));return a}function Jb(){var a;a=r();if(null===a&&(a=s(),null===a&&(59===b.charCodeAt(c)?(a=";",c++):(a=null,0===j&&d('";"')),null===a)))if(63===b.charCodeAt(c)?(a="?",c++):(a=null,0===j&&d('"?"')),null===
a)if(58===b.charCodeAt(c)?(a=":",c++):(a=null,0===j&&d('":"')),null===a)if(64===b.charCodeAt(c)?(a="@",c++):(a=null,0===j&&d('"@"')),null===a)if(38===b.charCodeAt(c)?(a="&",c++):(a=null,0===j&&d('"&"')),null===a)if(61===b.charCodeAt(c)?(a="=",c++):(a=null,0===j&&d('"="')),null===a)if(43===b.charCodeAt(c)?(a="+",c++):(a=null,0===j&&d('"+"')),null===a)if(36===b.charCodeAt(c)?(a="$",c++):(a=null,0===j&&d('"$"')),null===a)44===b.charCodeAt(c)?(a=",",c++):(a=null,0===j&&d('","'));return a}function Ib(){var a,
h,e,f,g,i;g=c;a=oa();if(null!==a){h=[];i=c;47===b.charCodeAt(c)?(e="/",c++):(e=null,0===j&&d('"/"'));null!==e?(f=oa(),null!==f?e=[e,f]:(e=null,c=i)):(e=null,c=i);for(;null!==e;)(h.push(e),i=c,47===b.charCodeAt(c)?(e="/",c++):(e=null,0===j&&d('"/"')),null!==e)?(f=oa(),null!==f?e=[e,f]:(e=null,c=i)):(e=null,c=i);null!==h?a=[a,h]:(a=null,c=g)}else a=null,c=g;return a}function oa(){var a,h,e,f,g,i;g=c;a=[];for(h=Z();null!==h;)a.push(h),h=Z();if(null!==a){h=[];i=c;59===b.charCodeAt(c)?(e=";",c++):(e=null,
0===j&&d('";"'));null!==e?(f=Sa(),null!==f?e=[e,f]:(e=null,c=i)):(e=null,c=i);for(;null!==e;)(h.push(e),i=c,59===b.charCodeAt(c)?(e=";",c++):(e=null,0===j&&d('";"')),null!==e)?(f=Sa(),null!==f?e=[e,f]:(e=null,c=i)):(e=null,c=i);null!==h?a=[a,h]:(a=null,c=g)}else a=null,c=g;return a}function Sa(){var a,c;a=[];for(c=Z();null!==c;)a.push(c),c=Z();return a}function Z(){var a;a=r();if(null===a&&(a=s(),null===a&&(58===b.charCodeAt(c)?(a=":",c++):(a=null,0===j&&d('":"')),null===a)))if(64===b.charCodeAt(c)?
(a="@",c++):(a=null,0===j&&d('"@"')),null===a)if(38===b.charCodeAt(c)?(a="&",c++):(a=null,0===j&&d('"&"')),null===a)if(61===b.charCodeAt(c)?(a="=",c++):(a=null,0===j&&d('"="')),null===a)if(43===b.charCodeAt(c)?(a="+",c++):(a=null,0===j&&d('"+"')),null===a)if(36===b.charCodeAt(c)?(a="$",c++):(a=null,0===j&&d('"$"')),null===a)44===b.charCodeAt(c)?(a=",",c++):(a=null,0===j&&d('","'));return a}function Cb(){var a,h,f,g,k;k=g=c;a=i();if(null!==a){h=[];f=i();if(null===f&&(f=e(),null===f&&(43===b.charCodeAt(c)?
(f="+",c++):(f=null,0===j&&d('"+"')),null===f)))if(45===b.charCodeAt(c)?(f="-",c++):(f=null,0===j&&d('"-"')),null===f)46===b.charCodeAt(c)?(f=".",c++):(f=null,0===j&&d('"."'));for(;null!==f;)if(h.push(f),f=i(),null===f&&(f=e(),null===f&&(43===b.charCodeAt(c)?(f="+",c++):(f=null,0===j&&d('"+"')),null===f)))if(45===b.charCodeAt(c)?(f="-",c++):(f=null,0===j&&d('"-"')),null===f)46===b.charCodeAt(c)?(f=".",c++):(f=null,0===j&&d('"."'));null!==h?a=[a,h]:(a=null,c=k)}else a=null,c=k;null!==a&&(q.scheme=
b.substring(c,g),a=void 0);null===a&&(c=g);return a}function Hb(){var a;a=Kb();null===a&&(a=aa());return a}function Kb(){var a,h,e,f;f=e=c;a=ha();null!==a?(64===b.charCodeAt(c)?(h="@",c++):(h=null,0===j&&d('"@"')),null!==h)?a=[a,h]:(a=null,c=f):(a=null,c=f);a=null!==a?a:"";null!==a?(h=ia(),null!==h?a=[a,h]:(a=null,c=e)):(a=null,c=e);return null!==a?a:""}function aa(){var a,h;h=r();if(null===h&&(h=s(),null===h&&(36===b.charCodeAt(c)?(h="$",c++):(h=null,0===j&&d('"$"')),null===h)))if(44===b.charCodeAt(c)?
(h=",",c++):(h=null,0===j&&d('","')),null===h)if(59===b.charCodeAt(c)?(h=";",c++):(h=null,0===j&&d('";"')),null===h)if(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null===h)if(64===b.charCodeAt(c)?(h="@",c++):(h=null,0===j&&d('"@"')),null===h)if(38===b.charCodeAt(c)?(h="&",c++):(h=null,0===j&&d('"&"')),null===h)if(61===b.charCodeAt(c)?(h="=",c++):(h=null,0===j&&d('"="')),null===h)43===b.charCodeAt(c)?(h="+",c++):(h=null,0===j&&d('"+"'));if(null!==h)for(a=[];null!==h;){if(a.push(h),h=
r(),null===h&&(h=s(),null===h&&(36===b.charCodeAt(c)?(h="$",c++):(h=null,0===j&&d('"$"')),null===h)))if(44===b.charCodeAt(c)?(h=",",c++):(h=null,0===j&&d('","')),null===h)if(59===b.charCodeAt(c)?(h=";",c++):(h=null,0===j&&d('";"')),null===h)if(58===b.charCodeAt(c)?(h=":",c++):(h=null,0===j&&d('":"')),null===h)if(64===b.charCodeAt(c)?(h="@",c++):(h=null,0===j&&d('"@"')),null===h)if(38===b.charCodeAt(c)?(h="&",c++):(h=null,0===j&&d('"&"')),null===h)if(61===b.charCodeAt(c)?(h="=",c++):(h=null,0===j&&
d('"="')),null===h)43===b.charCodeAt(c)?(h="+",c++):(h=null,0===j&&d('"+"'))}else a=null;return a}function Gb(){var a,c;a=[];for(c=Y();null!==c;)a.push(c),c=Y();return a}function Qa(){var a,h,f,g,i,k,l,n;n=l=c;"sip"===b.substr(c,3).toLowerCase()?(a=b.substr(c,3),c+=3):(a=null,0===j&&d('"SIP"'));if(null!==a)if(47===b.charCodeAt(c)?(h="/",c++):(h=null,0===j&&d('"/"')),null!==h){g=e();if(null!==g)for(f=[];null!==g;)f.push(g),g=e();else f=null;if(null!==f)if(46===b.charCodeAt(c)?(g=".",c++):(g=null,0===
j&&d('"."')),null!==g){k=e();if(null!==k)for(i=[];null!==k;)i.push(k),k=e();else i=null;null!==i?a=[a,h,f,g,i]:(a=null,c=n)}else a=null,c=n;else a=null,c=n}else a=null,c=n;else a=null,c=n;null!==a&&(q.sip_version=b.substring(c,l),a=void 0);null===a&&(c=l);return a}function Lb(){var a;"INVITE"===b.substr(c,6)?(a="INVITE",c+=6):(a=null,0===j&&d('"INVITE"'));return a}function Mb(){var a;"ACK"===b.substr(c,3)?(a="ACK",c+=3):(a=null,0===j&&d('"ACK"'));return a}function Nb(){var a;"OPTIONS"===b.substr(c,
7)?(a="OPTIONS",c+=7):(a=null,0===j&&d('"OPTIONS"'));return a}function Ob(){var a;"BYE"===b.substr(c,3)?(a="BYE",c+=3):(a=null,0===j&&d('"BYE"'));return a}function Pb(){var a;"CANCEL"===b.substr(c,6)?(a="CANCEL",c+=6):(a=null,0===j&&d('"CANCEL"'));return a}function Qb(){var a;"REGISTER"===b.substr(c,8)?(a="REGISTER",c+=8):(a=null,0===j&&d('"REGISTER"'));return a}function Rb(){var a;"SUBSCRIBE"===b.substr(c,9)?(a="SUBSCRIBE",c+=9):(a=null,0===j&&d('"SUBSCRIBE"'));return a}function Sb(){var a;"NOTIFY"===
b.substr(c,6)?(a="NOTIFY",c+=6):(a=null,0===j&&d('"NOTIFY"'));return a}function la(){var a,d;d=c;a=Lb();null===a&&(a=Mb(),null===a&&(a=Nb(),null===a&&(a=Ob(),null===a&&(a=Pb(),null===a&&(a=Qb(),null===a&&(a=Rb(),null===a&&(a=Sb(),null===a&&(a=A()))))))));null!==a&&(q.method=b.substring(c,d),a=q.method);null===a&&(c=d);return a}function Tb(){var a,b,d,e,f,g;g=c;a=Qa();null!==a?(b=B(),null!==b?(d=Ub(),null!==d?(e=B(),null!==e?(f=Vb(),null!==f?a=[a,b,d,e,f]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g)):
(a=null,c=g)):(a=null,c=g);return a}function Ub(){var a,b;b=c;a=Wb();null!==a&&(q.status_code=parseInt(a.join("")),a=void 0);null===a&&(c=b);return a}function Wb(){var a,b,d,f;f=c;a=e();null!==a?(b=e(),null!==b?(d=e(),null!==d?a=[a,b,d]:(a=null,c=f)):(a=null,c=f)):(a=null,c=f);return a}function Vb(){var a,d,e;e=c;a=[];d=u();null===d&&(d=r(),null===d&&(d=s(),null===d&&(d=J(),null===d&&(d=I(),null===d&&(d=B(),null===d&&(d=v()))))));for(;null!==d;)a.push(d),d=u(),null===d&&(d=r(),null===d&&(d=s(),null===
d&&(d=J(),null===d&&(d=I(),null===d&&(d=B(),null===d&&(d=v()))))));null!==a&&(q.reason_phrase=b.substring(c,e),a=void 0);null===a&&(c=e);return a}function pa(){var a,b,d,e,f,g,i;g=f=c;a=ga();null===a&&(a=P());if(null!==a){b=[];i=c;d=G();null!==d?(e=Ta(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);for(;null!==d;)b.push(d),i=c,d=G(),null!==d?(e=Ta(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);null!==b?a=[a,b]:(a=null,c=g)}else a=null,c=g;if(null!==a){var j;q.multi_header||(q.multi_header=[]);try{j=
new JsSIP.NameAddrHeader(q.uri,q.display_name,q.params),delete q.uri,delete q.display_name,delete q.params}catch(k){j=null}q.multi_header.push({possition:c,offset:f,parsed:j});a=void 0}null===a&&(c=f);return a}function P(){var a,b,d,e,f;f=c;a=qa();a=null!==a?a:"";null!==a?(b=Da(),null!==b?(d=ja(),null!==d?(e=Ca(),null!==e?a=[a,b,d,e]:(a=null,c=f)):(a=null,c=f)):(a=null,c=f)):(a=null,c=f);return a}function qa(){var a,d,e,f,g,i,j;i=g=c;a=A();if(null!==a){d=[];j=c;e=x();null!==e?(f=A(),null!==f?e=[e,
f]:(e=null,c=j)):(e=null,c=j);for(;null!==e;)d.push(e),j=c,e=x(),null!==e?(f=A(),null!==f?e=[e,f]:(e=null,c=j)):(e=null,c=j);null!==d?a=[a,d]:(a=null,c=i)}else a=null,c=i;null===a&&(a=S());null!==a&&(a=b.substring(c,g).trim(),'"'===a[0]&&(a=a.substring(1,a.length-1)),q.display_name=a,a=void 0);null===a&&(c=g);return a}function Ta(){var a;a=Xb();null===a&&(a=Yb(),null===a&&(a=K()));return a}function Xb(){var a,h,e,f,g;g=f=c;"q"===b.substr(c,1).toLowerCase()?(a=b.substr(c,1),c++):(a=null,0===j&&d('"q"'));
null!==a?(h=E(),null!==h?(e=Zb(),null!==e?a=[a,h,e]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g);null!==a&&(a=a[2],q.params||(q.params={}),q.params.q=a,a=void 0);null===a&&(c=f);return a}function Yb(){var a,h,e,f,g;g=f=c;"expires"===b.substr(c,7).toLowerCase()?(a=b.substr(c,7),c+=7):(a=null,0===j&&d('"expires"'));null!==a?(h=E(),null!==h?(e=Q(),null!==e?a=[a,h,e]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g);null!==a&&(a=a[2],q.params||(q.params={}),q.params.expires=a,a=void 0);null===a&&(c=f);return a}function Q(){var a,
b,d;d=c;b=e();if(null!==b)for(a=[];null!==b;)a.push(b),b=e();else a=null;null!==a&&(a=parseInt(a.join("")));null===a&&(c=d);return a}function Zb(){var a,h,f,g,i,k,l,n;l=k=c;48===b.charCodeAt(c)?(a="0",c++):(a=null,0===j&&d('"0"'));null!==a?(n=c,46===b.charCodeAt(c)?(h=".",c++):(h=null,0===j&&d('"."')),null!==h?(f=e(),f=null!==f?f:"",null!==f?(g=e(),g=null!==g?g:"",null!==g?(i=e(),i=null!==i?i:"",null!==i?h=[h,f,g,i]:(h=null,c=n)):(h=null,c=n)):(h=null,c=n)):(h=null,c=n),h=null!==h?h:"",null!==h)?
a=[a,h]:(a=null,c=l):(a=null,c=l);null!==a&&(a=parseFloat(b.substring(c,k)));null===a&&(c=k);return a}function K(){var a,b,d,e,f,g;f=e=c;a=A();null!==a?(g=c,b=E(),null!==b?(d=$b(),null!==d?b=[b,d]:(b=null,c=g)):(b=null,c=g),b=null!==b?b:"",null!==b)?a=[a,b]:(a=null,c=f):(a=null,c=f);null!==a&&(b=a[0],a=a[1],q.params||(q.params={}),a="undefined"===typeof a?void 0:a[1],q.params[b.toLowerCase()]=a,a=void 0);null===a&&(c=e);return a}function $b(){var a;a=A();null===a&&(a=U(),null===a&&(a=S()));return a}
function ac(){var a;"render"===b.substr(c,6).toLowerCase()?(a=b.substr(c,6),c+=6):(a=null,0===j&&d('"render"'));if(null===a&&("session"===b.substr(c,7).toLowerCase()?(a=b.substr(c,7),c+=7):(a=null,0===j&&d('"session"')),null===a))if("icon"===b.substr(c,4).toLowerCase()?(a=b.substr(c,4),c+=4):(a=null,0===j&&d('"icon"')),null===a)"alert"===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"alert"')),null===a&&(a=A());return a}function Ua(){var a;a=bc();null===a&&(a=K());return a}
function bc(){var a,h,e,f;f=c;"handling"===b.substr(c,8).toLowerCase()?(a=b.substr(c,8),c+=8):(a=null,0===j&&d('"handling"'));null!==a?(h=E(),null!==h)?("optional"===b.substr(c,8).toLowerCase()?(e=b.substr(c,8),c+=8):(e=null,0===j&&d('"optional"')),null===e&&("required"===b.substr(c,8).toLowerCase()?(e=b.substr(c,8),c+=8):(e=null,0===j&&d('"required"')),null===e&&(e=A())),null!==e)?a=[a,h,e]:(a=null,c=f):(a=null,c=f):(a=null,c=f);return a}function cc(){var a,b,d,e,f,g,i,j;i=c;a=dc();if(null!==a)if(b=
ea(),null!==b)if(d=ec(),null!==d){e=[];j=c;f=G();null!==f?(g=Va(),null!==g?f=[f,g]:(f=null,c=j)):(f=null,c=j);for(;null!==f;)e.push(f),j=c,f=G(),null!==f?(g=Va(),null!==g?f=[f,g]:(f=null,c=j)):(f=null,c=j);null!==e?a=[a,b,d,e]:(a=null,c=i)}else a=null,c=i;else a=null,c=i;else a=null,c=i;return a}function dc(){var a;a=fc();null===a&&(a=gc());return a}function fc(){var a;"text"===b.substr(c,4).toLowerCase()?(a=b.substr(c,4),c+=4):(a=null,0===j&&d('"text"'));if(null===a&&("image"===b.substr(c,5).toLowerCase()?
(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"image"')),null===a))if("audio"===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"audio"')),null===a)if("video"===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"video"')),null===a)"application"===b.substr(c,11).toLowerCase()?(a=b.substr(c,11),c+=11):(a=null,0===j&&d('"application"')),null===a&&(a=ra());return a}function gc(){var a;"message"===b.substr(c,7).toLowerCase()?(a=b.substr(c,7),c+=7):(a=null,0===j&&d('"message"'));
null===a&&("multipart"===b.substr(c,9).toLowerCase()?(a=b.substr(c,9),c+=9):(a=null,0===j&&d('"multipart"')),null===a&&(a=ra()));return a}function ra(){var a;a=A();null===a&&(a=hc());return a}function hc(){var a,h,e;e=c;"x-"===b.substr(c,2).toLowerCase()?(a=b.substr(c,2),c+=2):(a=null,0===j&&d('"x-"'));null!==a?(h=A(),null!==h?a=[a,h]:(a=null,c=e)):(a=null,c=e);return a}function ec(){var a;a=ra();null===a&&(a=A());return a}function Va(){var a,b,d,e;e=c;a=A();null!==a?(b=E(),null!==b?(d=ic(),null!==
d?a=[a,b,d]:(a=null,c=e)):(a=null,c=e)):(a=null,c=e);return a}function ic(){var a;a=A();null===a&&(a=S());return a}function jc(){var a,b,d;d=c;b=e();if(null!==b)for(a=[];null!==b;)a.push(b),b=e();else a=null;null!==a&&(q.value=parseInt(a.join("")),a=void 0);null===a&&(c=d);return a}function ba(){var a,h,e,f,g,i;g=c;a=da();if(null!==a){h=[];i=c;46===b.charCodeAt(c)?(e=".",c++):(e=null,0===j&&d('"."'));null!==e?(f=da(),null!==f?e=[e,f]:(e=null,c=i)):(e=null,c=i);for(;null!==e;)(h.push(e),i=c,46===b.charCodeAt(c)?
(e=".",c++):(e=null,0===j&&d('"."')),null!==e)?(f=da(),null!==f?e=[e,f]:(e=null,c=i)):(e=null,c=i);null!==h?a=[a,h]:(a=null,c=g)}else a=null,c=g;return a}function Wa(){var a;a=Xa();null===a&&(a=K());return a}function Xa(){var a,h,e,f,g;g=f=c;"tag"===b.substr(c,3).toLowerCase()?(a=b.substr(c,3),c+=3):(a=null,0===j&&d('"tag"'));null!==a?(h=E(),null!==h?(e=A(),null!==e?a=[a,h,e]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g);null!==a&&(q.tag=a[2],a=void 0);null===a&&(c=f);return a}function Ya(){var a,e,f,
g,i,k,l,n;l=c;"digest"===b.substr(c,6).toLowerCase()?(a=b.substr(c,6),c+=6):(a=null,0===j&&d('"Digest"'));if(null!==a)if(e=x(),null!==e)if(f=sa(),null!==f){g=[];n=c;i=F();null!==i?(k=sa(),null!==k?i=[i,k]:(i=null,c=n)):(i=null,c=n);for(;null!==i;)g.push(i),n=c,i=F(),null!==i?(k=sa(),null!==k?i=[i,k]:(i=null,c=n)):(i=null,c=n);null!==g?a=[a,e,f,g]:(a=null,c=l)}else a=null,c=l;else a=null,c=l;else a=null,c=l;null===a&&(a=kc());return a}function kc(){var a,b,d,e,f,g,i,j;i=c;a=A();if(null!==a)if(b=x(),
null!==b)if(d=ca(),null!==d){e=[];j=c;f=F();null!==f?(g=ca(),null!==g?f=[f,g]:(f=null,c=j)):(f=null,c=j);for(;null!==f;)e.push(f),j=c,f=F(),null!==f?(g=ca(),null!==g?f=[f,g]:(f=null,c=j)):(f=null,c=j);null!==e?a=[a,b,d,e]:(a=null,c=i)}else a=null,c=i;else a=null,c=i;else a=null,c=i;return a}function ca(){var a,b,d,e;e=c;a=A();null!==a?(b=E(),null!==b?(d=A(),null===d&&(d=S()),null!==d?a=[a,b,d]:(a=null,c=e)):(a=null,c=e)):(a=null,c=e);return a}function sa(){var a;a=lc();null===a&&(a=mc(),null===a&&
(a=nc(),null===a&&(a=oc(),null===a&&(a=pc(),null===a&&(a=qc(),null===a&&(a=rc(),null===a&&(a=ca())))))));return a}function lc(){var a,e,f,g;g=c;"realm"===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"realm"'));null!==a?(e=E(),null!==e?(f=sc(),null!==f?a=[a,e,f]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g);return a}function sc(){var a,b;b=c;a=fa();null!==a&&(q.realm=a,a=void 0);null===a&&(c=b);return a}function mc(){var a,e,f,g,i,k,l,n,o;n=c;"domain"===b.substr(c,6).toLowerCase()?
(a=b.substr(c,6),c+=6):(a=null,0===j&&d('"domain"'));if(null!==a)if(e=E(),null!==e)if(f=Ea(),null!==f)if(g=ta(),null!==g){i=[];o=c;l=B();if(null!==l)for(k=[];null!==l;)k.push(l),l=B();else k=null;null!==k?(l=ta(),null!==l?k=[k,l]:(k=null,c=o)):(k=null,c=o);for(;null!==k;){i.push(k);o=c;l=B();if(null!==l)for(k=[];null!==l;)k.push(l),l=B();else k=null;null!==k?(l=ta(),null!==l?k=[k,l]:(k=null,c=o)):(k=null,c=o)}null!==i?(k=Fa(),null!==k?a=[a,e,f,g,i,k]:(a=null,c=n)):(a=null,c=n)}else a=null,c=n;else a=
null,c=n;else a=null,c=n;else a=null,c=n;return a}function ta(){var a;a=Ra();null===a&&(a=na());return a}function nc(){var a,e,f,g;g=c;"nonce"===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"nonce"'));null!==a?(e=E(),null!==e?(f=tc(),null!==f?a=[a,e,f]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g);return a}function tc(){var a,b;b=c;a=fa();null!==a&&(q.nonce=a,a=void 0);null===a&&(c=b);return a}function oc(){var a,e,f,g,i;i=g=c;"opaque"===b.substr(c,6).toLowerCase()?(a=b.substr(c,
6),c+=6):(a=null,0===j&&d('"opaque"'));null!==a?(e=E(),null!==e?(f=fa(),null!==f?a=[a,e,f]:(a=null,c=i)):(a=null,c=i)):(a=null,c=i);null!==a&&(q.opaque=a[2],a=void 0);null===a&&(c=g);return a}function pc(){var a,e,f,g,i;g=c;"stale"===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"stale"'));null!==a?(e=E(),null!==e)?(i=c,"true"===b.substr(c,4).toLowerCase()?(f=b.substr(c,4),c+=4):(f=null,0===j&&d('"true"')),null!==f&&(q.stale=!0,f=void 0),null===f&&(c=i),null===f&&(i=c,"false"===
b.substr(c,5).toLowerCase()?(f=b.substr(c,5),c+=5):(f=null,0===j&&d('"false"')),null!==f&&(q.stale=!1,f=void 0),null===f&&(c=i)),null!==f?a=[a,e,f]:(a=null,c=g)):(a=null,c=g):(a=null,c=g);return a}function qc(){var a,e,f,g,i;i=g=c;"algorithm"===b.substr(c,9).toLowerCase()?(a=b.substr(c,9),c+=9):(a=null,0===j&&d('"algorithm"'));null!==a?(e=E(),null!==e)?("md5"===b.substr(c,3).toLowerCase()?(f=b.substr(c,3),c+=3):(f=null,0===j&&d('"MD5"')),null===f&&("md5-sess"===b.substr(c,8).toLowerCase()?(f=b.substr(c,
8),c+=8):(f=null,0===j&&d('"MD5-sess"')),null===f&&(f=A())),null!==f)?a=[a,e,f]:(a=null,c=i):(a=null,c=i):(a=null,c=i);null!==a&&(q.algorithm=a[2].toUpperCase(),a=void 0);null===a&&(c=g);return a}function rc(){var a,e,f,g,i,k,l,n,o,m;n=c;"qop"===b.substr(c,3).toLowerCase()?(a=b.substr(c,3),c+=3):(a=null,0===j&&d('"qop"'));if(null!==a)if(e=E(),null!==e)if(f=Ea(),null!==f){o=c;g=ua();if(null!==g){i=[];m=c;44===b.charCodeAt(c)?(k=",",c++):(k=null,0===j&&d('","'));null!==k?(l=ua(),null!==l?k=[k,l]:(k=
null,c=m)):(k=null,c=m);for(;null!==k;)(i.push(k),m=c,44===b.charCodeAt(c)?(k=",",c++):(k=null,0===j&&d('","')),null!==k)?(l=ua(),null!==l?k=[k,l]:(k=null,c=m)):(k=null,c=m);null!==i?g=[g,i]:(g=null,c=o)}else g=null,c=o;null!==g?(i=Fa(),null!==i?a=[a,e,f,g,i]:(a=null,c=n)):(a=null,c=n)}else a=null,c=n;else a=null,c=n;else a=null,c=n;return a}function ua(){var a,e;e=c;"auth-int"===b.substr(c,8).toLowerCase()?(a=b.substr(c,8),c+=8):(a=null,0===j&&d('"auth-int"'));null===a&&("auth"===b.substr(c,4).toLowerCase()?
(a=b.substr(c,4),c+=4):(a=null,0===j&&d('"auth"')),null===a&&(a=A()));null!==a&&(q.qop||(q.qop=[]),q.qop.push(a.toLowerCase()),a=void 0);null===a&&(c=e);return a}function va(){var a,b,d,e,f,g,i;g=f=c;a=P();if(null!==a){b=[];i=c;d=G();null!==d?(e=K(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);for(;null!==d;)b.push(d),i=c,d=G(),null!==d?(e=K(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);null!==b?a=[a,b]:(a=null,c=g)}else a=null,c=g;if(null!==a){var j;q.multi_header||(q.multi_header=[]);try{j=new JsSIP.NameAddrHeader(q.uri,
q.display_name,q.params),delete q.uri,delete q.display_name,delete q.params}catch(k){j=null}q.multi_header.push({possition:c,offset:f,parsed:j});a=void 0}null===a&&(c=f);return a}function wa(){var a,b,d,e,f,g;f=c;a=P();if(null!==a){b=[];g=c;d=G();null!==d?(e=K(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);for(;null!==d;)b.push(d),g=c,d=G(),null!==d?(e=K(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);null!==b?a=[a,b]:(a=null,c=f)}else a=null,c=f;return a}function uc(){var a,e;e=c;"active"===b.substr(c,
6).toLowerCase()?(a=b.substr(c,6),c+=6):(a=null,0===j&&d('"active"'));if(null===a&&("pending"===b.substr(c,7).toLowerCase()?(a=b.substr(c,7),c+=7):(a=null,0===j&&d('"pending"')),null===a))"terminated"===b.substr(c,10).toLowerCase()?(a=b.substr(c,10),c+=10):(a=null,0===j&&d('"terminated"')),null===a&&(a=A());null!==a&&(q.state=b.substring(c,e),a=void 0);null===a&&(c=e);return a}function Za(){var a,e,f,g,i;i=g=c;"reason"===b.substr(c,6).toLowerCase()?(a=b.substr(c,6),c+=6):(a=null,0===j&&d('"reason"'));
null!==a?(e=E(),null!==e?(f=vc(),null!==f?a=[a,e,f]:(a=null,c=i)):(a=null,c=i)):(a=null,c=i);null!==a&&(a=function(a,c){if(typeof c!=="undefined")q.reason=c}(g,a[2]));null===a&&(c=g);if(null===a&&(i=g=c,"expires"===b.substr(c,7).toLowerCase()?(a=b.substr(c,7),c+=7):(a=null,0===j&&d('"expires"')),null!==a?(e=E(),null!==e?(f=Q(),null!==f?a=[a,e,f]:(a=null,c=i)):(a=null,c=i)):(a=null,c=i),null!==a&&(a=function(a,c){if(typeof c!=="undefined")q.expires=c}(g,a[2])),null===a&&(c=g),null===a))i=g=c,"retry_after"===
b.substr(c,11).toLowerCase()?(a=b.substr(c,11),c+=11):(a=null,0===j&&d('"retry_after"')),null!==a?(e=E(),null!==e?(f=Q(),null!==f?a=[a,e,f]:(a=null,c=i)):(a=null,c=i)):(a=null,c=i),null!==a&&(a=function(a,c){if(typeof c!=="undefined")q.retry_after=c}(g,a[2])),null===a&&(c=g),null===a&&(a=K());return a}function vc(){var a;"deactivated"===b.substr(c,11).toLowerCase()?(a=b.substr(c,11),c+=11):(a=null,0===j&&d('"deactivated"'));if(null===a&&("probation"===b.substr(c,9).toLowerCase()?(a=b.substr(c,9),
c+=9):(a=null,0===j&&d('"probation"')),null===a))if("rejected"===b.substr(c,8).toLowerCase()?(a=b.substr(c,8),c+=8):(a=null,0===j&&d('"rejected"')),null===a)if("timeout"===b.substr(c,7).toLowerCase()?(a=b.substr(c,7),c+=7):(a=null,0===j&&d('"timeout"')),null===a)if("giveup"===b.substr(c,6).toLowerCase()?(a=b.substr(c,6),c+=6):(a=null,0===j&&d('"giveup"')),null===a)if("noresource"===b.substr(c,10).toLowerCase()?(a=b.substr(c,10),c+=10):(a=null,0===j&&d('"noresource"')),null===a)"invariant"===b.substr(c,
9).toLowerCase()?(a=b.substr(c,9),c+=9):(a=null,0===j&&d('"invariant"')),null===a&&(a=A());return a}function $a(){var a;a=Xa();null===a&&(a=K());return a}function xa(){var a,b,d,e,f,g,i,j;i=c;a=wc();if(null!==a)if(b=x(),null!==b)if(d=xc(),null!==d){e=[];j=c;f=G();null!==f?(g=ab(),null!==g?f=[f,g]:(f=null,c=j)):(f=null,c=j);for(;null!==f;)e.push(f),j=c,f=G(),null!==f?(g=ab(),null!==g?f=[f,g]:(f=null,c=j)):(f=null,c=j);null!==e?a=[a,b,d,e]:(a=null,c=i)}else a=null,c=i;else a=null,c=i;else a=null,c=
i;return a}function ab(){var a;a=yc();null===a&&(a=zc(),null===a&&(a=Ac(),null===a&&(a=Bc(),null===a&&(a=Cc(),null===a&&(a=K())))));return a}function yc(){var a,e,f,g,i;i=g=c;"ttl"===b.substr(c,3).toLowerCase()?(a=b.substr(c,3),c+=3):(a=null,0===j&&d('"ttl"'));null!==a?(e=E(),null!==e?(f=Pa(),null!==f?a=[a,e,f]:(a=null,c=i)):(a=null,c=i)):(a=null,c=i);null!==a&&(q.ttl=a[2],a=void 0);null===a&&(c=g);return a}function zc(){var a,e,f,g,i;i=g=c;"maddr"===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=
5):(a=null,0===j&&d('"maddr"'));null!==a?(e=E(),null!==e?(f=U(),null!==f?a=[a,e,f]:(a=null,c=i)):(a=null,c=i)):(a=null,c=i);null!==a&&(q.maddr=a[2],a=void 0);null===a&&(c=g);return a}function Ac(){var a,e,f,g,i;i=g=c;"received"===b.substr(c,8).toLowerCase()?(a=b.substr(c,8),c+=8):(a=null,0===j&&d('"received"'));null!==a?(e=E(),null!==e?(f=O(),null===f&&(f=Na()),null!==f?a=[a,e,f]:(a=null,c=i)):(a=null,c=i)):(a=null,c=i);null!==a&&(q.received=a[2],a=void 0);null===a&&(c=g);return a}function Bc(){var a,
e,f,g,i;i=g=c;"branch"===b.substr(c,6).toLowerCase()?(a=b.substr(c,6),c+=6):(a=null,0===j&&d('"branch"'));null!==a?(e=E(),null!==e?(f=A(),null!==f?a=[a,e,f]:(a=null,c=i)):(a=null,c=i)):(a=null,c=i);null!==a&&(q.branch=a[2],a=void 0);null===a&&(c=g);return a}function Cc(){var a,f,g,i,k,l,n;l=k=c;"rport"===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"rport"'));if(null!==a){n=c;f=E();if(null!==f){g=[];for(i=e();null!==i;)g.push(i),i=e();null!==g?f=[f,g]:(f=null,c=n)}else f=null,
c=n;f=null!==f?f:"";null!==f?a=[a,f]:(a=null,c=l)}else a=null,c=l;null!==a&&("undefined"!==typeof response_port&&(q.rport=response_port.join("")),a=void 0);null===a&&(c=k);return a}function wc(){var a,b,d,e,f,g;g=c;a=Dc();null!==a?(b=ea(),null!==b?(d=A(),null!==d?(e=ea(),null!==e?(f=ya(),null!==f?a=[a,b,d,e,f]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g)):(a=null,c=g)):(a=null,c=g);return a}function Dc(){var a,e;e=c;"sip"===b.substr(c,3).toLowerCase()?(a=b.substr(c,3),c+=3):(a=null,0===j&&d('"SIP"'));
null===a&&(a=A());null!==a&&(q.protocol=a,a=void 0);null===a&&(c=e);return a}function ya(){var a,e;e=c;"udp"===b.substr(c,3).toLowerCase()?(a=b.substr(c,3),c+=3):(a=null,0===j&&d('"UDP"'));if(null===a&&("tcp"===b.substr(c,3).toLowerCase()?(a=b.substr(c,3),c+=3):(a=null,0===j&&d('"TCP"')),null===a))if("tls"===b.substr(c,3).toLowerCase()?(a=b.substr(c,3),c+=3):(a=null,0===j&&d('"TLS"')),null===a)"sctp"===b.substr(c,4).toLowerCase()?(a=b.substr(c,4),c+=4):(a=null,0===j&&d('"SCTP"')),null===a&&(a=A());
null!==a&&(q.transport=a,a=void 0);null===a&&(c=e);return a}function xc(){var a,b,d,e,f;e=c;a=Ec();null!==a?(f=c,b=ib(),null!==b?(d=Fc(),null!==d?b=[b,d]:(b=null,c=f)):(b=null,c=f),b=null!==b?b:"",null!==b)?a=[a,b]:(a=null,c=e):(a=null,c=e);return a}function Ec(){var a,d;d=c;a=La();null===a&&(a=O(),null===a&&(a=ka()));null!==a&&(q.host=b.substring(c,d),a=void 0);null===a&&(c=d);return a}function Fc(){var a,b,d,f,g,i,j;j=i=c;a=e();a=null!==a?a:"";null!==a?(b=e(),b=null!==b?b:"",null!==b?(d=e(),d=null!==
d?d:"",null!==d?(f=e(),f=null!==f?f:"",null!==f?(g=e(),g=null!==g?g:"",null!==g?a=[a,b,d,f,g]:(a=null,c=j)):(a=null,c=j)):(a=null,c=j)):(a=null,c=j)):(a=null,c=j);null!==a&&(q.port=parseInt(a.join("")),a=void 0);null===a&&(c=i);return a}function Pa(){var a,b,d,f,g;g=f=c;a=e();null!==a?(b=e(),b=null!==b?b:"",null!==b?(d=e(),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,c=g)):(a=null,c=g)):(a=null,c=g);null!==a&&(a=parseInt(a.join("")));null===a&&(c=f);return a}function Gc(){var a,c;a=[];c=H();null===
c&&(c=I(),null===c&&(c=x()));for(;null!==c;)a.push(c),c=H(),null===c&&(c=I(),null===c&&(c=x()));return a}function Hc(){var a,e;e=c;"stuns"===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"stuns"'));null===a&&("stun"===b.substr(c,4).toLowerCase()?(a=b.substr(c,4),c+=4):(a=null,0===j&&d('"stun"')));null!==a&&(q.scheme=a,a=void 0);null===a&&(c=e);return a}function bb(){var a,e,f,g,i;g=c;a=Ic();null!==a?(i=c,58===b.charCodeAt(c)?(e=":",c++):(e=null,0===j&&d('":"')),null!==e?(f=
Ka(),null!==f?e=[e,f]:(e=null,c=i)):(e=null,c=i),e=null!==e?e:"",null!==e)?a=[a,e]:(a=null,c=g):(a=null,c=g);return a}function Ic(){var a,b;b=c;a=O();null===a&&(a=ka(),null===a&&(a=aa()));null!==a&&(q.host=a,a=void 0);null===a&&(c=b);return a}function aa(){var a,d,e;e=c;a=[];d=cb();null===d&&(d=s(),null===d&&(d=db()));for(;null!==d;)a.push(d),d=cb(),null===d&&(d=s(),null===d&&(d=db()));null!==a&&(a=b.substring(c,e));null===a&&(c=e);return a}function cb(){var a;a=i();if(null===a&&(a=e(),null===a&&
(45===b.charCodeAt(c)?(a="-",c++):(a=null,0===j&&d('"-"')),null===a)))if(46===b.charCodeAt(c)?(a=".",c++):(a=null,0===j&&d('"."')),null===a)if(95===b.charCodeAt(c)?(a="_",c++):(a=null,0===j&&d('"_"')),null===a)126===b.charCodeAt(c)?(a="~",c++):(a=null,0===j&&d('"~"'));return a}function db(){var a;33===b.charCodeAt(c)?(a="!",c++):(a=null,0===j&&d('"!"'));if(null===a&&(36===b.charCodeAt(c)?(a="$",c++):(a=null,0===j&&d('"$"')),null===a))if(38===b.charCodeAt(c)?(a="&",c++):(a=null,0===j&&d('"&"')),null===
a)if(39===b.charCodeAt(c)?(a="'",c++):(a=null,0===j&&d('"\'"')),null===a)if(40===b.charCodeAt(c)?(a="(",c++):(a=null,0===j&&d('"("')),null===a)if(41===b.charCodeAt(c)?(a=")",c++):(a=null,0===j&&d('")"')),null===a)if(42===b.charCodeAt(c)?(a="*",c++):(a=null,0===j&&d('"*"')),null===a)if(43===b.charCodeAt(c)?(a="+",c++):(a=null,0===j&&d('"+"')),null===a)if(44===b.charCodeAt(c)?(a=",",c++):(a=null,0===j&&d('","')),null===a)if(59===b.charCodeAt(c)?(a=";",c++):(a=null,0===j&&d('";"')),null===a)61===b.charCodeAt(c)?
(a="=",c++):(a=null,0===j&&d('"="'));return a}function Jc(){var a,e;e=c;"turns"===b.substr(c,5).toLowerCase()?(a=b.substr(c,5),c+=5):(a=null,0===j&&d('"turns"'));null===a&&("turn"===b.substr(c,4).toLowerCase()?(a=b.substr(c,4),c+=4):(a=null,0===j&&d('"turn"')));null!==a&&(q.scheme=a,a=void 0);null===a&&(c=e);return a}function Mc(a){a.sort();for(var c=null,b=[],d=0;d<a.length;d++)a[d]!==c&&(b.push(a[d]),c=a[d]);return b}function Nc(){for(var a=1,d=1,e=!1,f=0;f<Math.max(c,R);f++){var g=b.charAt(f);
"\n"===g?(e||a++,d=1,e=!1):"\r"===g||"\u2028"===g||"\u2029"===g?(a++,d=1,e=!0):(d++,e=!1)}return{line:a,column:d}}var Kc={CRLF:f,DIGIT:e,ALPHA:i,HEXDIG:k,WSP:z,OCTET:l,DQUOTE:C,SP:B,HTAB:v,alphanum:n,reserved:u,unreserved:r,mark:w,escaped:s,LWS:x,SWS:t,HCOLON:M,TEXT_UTF8_TRIM:D,TEXT_UTF8char:H,UTF8_NONASCII:J,UTF8_CONT:I,LHEX:function(){var a;a=e();null===a&&(/^[a-f]/.test(b.charAt(c))?(a=b.charAt(c),c++):(a=null,0===j&&d("[a-f]")));return a},token:A,token_nodot:da,separators:function(){var a;40===
b.charCodeAt(c)?(a="(",c++):(a=null,0===j&&d('"("'));if(null===a&&(41===b.charCodeAt(c)?(a=")",c++):(a=null,0===j&&d('")"')),null===a))if(60===b.charCodeAt(c)?(a="<",c++):(a=null,0===j&&d('"<"')),null===a)if(62===b.charCodeAt(c)?(a=">",c++):(a=null,0===j&&d('">"')),null===a)if(64===b.charCodeAt(c)?(a="@",c++):(a=null,0===j&&d('"@"')),null===a)if(44===b.charCodeAt(c)?(a=",",c++):(a=null,0===j&&d('","')),null===a)if(59===b.charCodeAt(c)?(a=";",c++):(a=null,0===j&&d('";"')),null===a)if(58===b.charCodeAt(c)?
(a=":",c++):(a=null,0===j&&d('":"')),null===a)if(92===b.charCodeAt(c)?(a="\\",c++):(a=null,0===j&&d('"\\\\"')),null===a)if(a=C(),null===a&&(47===b.charCodeAt(c)?(a="/",c++):(a=null,0===j&&d('"/"')),null===a))if(91===b.charCodeAt(c)?(a="[",c++):(a=null,0===j&&d('"["')),null===a)if(93===b.charCodeAt(c)?(a="]",c++):(a=null,0===j&&d('"]"')),null===a)if(63===b.charCodeAt(c)?(a="?",c++):(a=null,0===j&&d('"?"')),null===a)if(61===b.charCodeAt(c)?(a="=",c++):(a=null,0===j&&d('"="')),null===a)if(123===b.charCodeAt(c)?
(a="{",c++):(a=null,0===j&&d('"{"')),null===a)if(125===b.charCodeAt(c)?(a="}",c++):(a=null,0===j&&d('"}"')),null===a)a=B(),null===a&&(a=v());return a},word:Ba,STAR:fb,SLASH:ea,EQUAL:E,LPAREN:gb,RPAREN:hb,RAQUOT:Ca,LAQUOT:Da,COMMA:F,SEMI:G,COLON:ib,LDQUOT:Ea,RDQUOT:Fa,comment:Ga,ctext:Ha,quoted_string:S,quoted_string_clean:fa,qdtext:T,quoted_pair:N,SIP_URI_noparams:ga,SIP_URI:ja,uri_scheme:Ia,userinfo:ha,user:lb,user_unreserved:Ja,password:mb,hostport:ia,host:U,hostname:La,domainlabel:Ma,toplabel:nb,
IPv6reference:ka,IPv6address:Na,h16:y,ls32:L,IPv4address:O,dec_octet:V,port:Ka,uri_parameters:jb,uri_parameter:Oa,transport_param:ob,user_param:pb,method_param:qb,ttl_param:rb,maddr_param:sb,lr_param:tb,other_param:ub,pname:vb,pvalue:wb,paramchar:W,param_unreserved:xb,headers:kb,header:ma,hname:yb,hvalue:zb,hnv_unreserved:X,Request_Response:function(){var a;a=Tb();null===a&&(a=Ab());return a},Request_Line:Ab,Request_URI:Bb,absoluteURI:Ra,hier_part:Db,net_path:Fb,abs_path:na,opaque_part:Eb,uric:Y,
uric_no_slash:Jb,path_segments:Ib,segment:oa,param:Sa,pchar:Z,scheme:Cb,authority:Hb,srvr:Kb,reg_name:aa,query:Gb,SIP_Version:Qa,INVITEm:Lb,ACKm:Mb,OPTIONSm:Nb,BYEm:Ob,CANCELm:Pb,REGISTERm:Qb,SUBSCRIBEm:Rb,NOTIFYm:Sb,Method:la,Status_Line:Tb,Status_Code:Ub,extension_code:Wb,Reason_Phrase:Vb,Allow_Events:function(){var a,b,d,e,f,g;f=c;a=ba();if(null!==a){b=[];g=c;d=F();null!==d?(e=ba(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);for(;null!==d;)b.push(d),g=c,d=F(),null!==d?(e=ba(),null!==e?d=[d,e]:
(d=null,c=g)):(d=null,c=g);null!==b?a=[a,b]:(a=null,c=f)}else a=null,c=f;return a},Call_ID:function(){var a,e,f,g,i,k;i=g=c;a=Ba();null!==a?(k=c,64===b.charCodeAt(c)?(e="@",c++):(e=null,0===j&&d('"@"')),null!==e?(f=Ba(),null!==f?e=[e,f]:(e=null,c=k)):(e=null,c=k),e=null!==e?e:"",null!==e)?a=[a,e]:(a=null,c=i):(a=null,c=i);null!==a&&(q=b.substring(c,g),a=void 0);null===a&&(c=g);return a},Contact:function(){var a,b,d,e,f,g,i;f=c;a=fb();if(null===a)if(g=c,a=pa(),null!==a){b=[];i=c;d=F();null!==d?(e=
pa(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);for(;null!==d;)b.push(d),i=c,d=F(),null!==d?(e=pa(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);null!==b?a=[a,b]:(a=null,c=g)}else a=null,c=g;if(null!==a){for(var j in q.multi_header)if(null===q.multi_header[j].parsed){q=null;break}q=null!==q?q.multi_header:-1;a=void 0}null===a&&(c=f);return a},contact_param:pa,name_addr:P,display_name:qa,contact_params:Ta,c_p_q:Xb,c_p_expires:Yb,delta_seconds:Q,qvalue:Zb,generic_param:K,gen_value:$b,Content_Disposition:function(){var a,
b,d,e,f,g;f=c;a=ac();if(null!==a){b=[];g=c;d=G();null!==d?(e=Ua(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);for(;null!==d;)b.push(d),g=c,d=G(),null!==d?(e=Ua(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);null!==b?a=[a,b]:(a=null,c=f)}else a=null,c=f;return a},disp_type:ac,disp_param:Ua,handling_param:bc,Content_Encoding:function(){var a,b,d,e,f,g;f=c;a=A();if(null!==a){b=[];g=c;d=F();null!==d?(e=A(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);for(;null!==d;)b.push(d),g=c,d=F(),null!==d?(e=A(),null!==
e?d=[d,e]:(d=null,c=g)):(d=null,c=g);null!==b?a=[a,b]:(a=null,c=f)}else a=null,c=f;return a},Content_Length:function(){var a,b,d;d=c;b=e();if(null!==b)for(a=[];null!==b;)a.push(b),b=e();else a=null;null!==a&&(q=parseInt(a.join("")),a=void 0);null===a&&(c=d);return a},Content_Type:function(){var a,d;d=c;a=cc();null!==a&&(q=b.substring(c,d),a=void 0);null===a&&(c=d);return a},media_type:cc,m_type:dc,discrete_type:fc,composite_type:gc,extension_token:ra,x_token:hc,m_subtype:ec,m_parameter:Va,m_value:ic,
CSeq:function(){var a,b,d,e;e=c;a=jc();null!==a?(b=x(),null!==b?(d=la(),null!==d?a=[a,b,d]:(a=null,c=e)):(a=null,c=e)):(a=null,c=e);return a},CSeq_value:jc,Expires:function(){var a,b;b=c;a=Q();null!==a&&(q=a,a=void 0);null===a&&(c=b);return a},Event:function(){var a,b,d,e,f,g,i;g=f=c;a=ba();if(null!==a){b=[];i=c;d=G();null!==d?(e=K(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);for(;null!==d;)b.push(d),i=c,d=G(),null!==d?(e=K(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);null!==b?a=[a,b]:(a=null,c=
g)}else a=null,c=g;null!==a&&(q.event=a[0].join("").toLowerCase(),a=void 0);null===a&&(c=f);return a},event_type:ba,From:function(){var a,b,d,e,f,g,i;g=f=c;a=ga();null===a&&(a=P());if(null!==a){b=[];i=c;d=G();null!==d?(e=Wa(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);for(;null!==d;)b.push(d),i=c,d=G(),null!==d?(e=Wa(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);null!==b?a=[a,b]:(a=null,c=g)}else a=null,c=g;if(null!==a){a=q.tag;try{q=new JsSIP.NameAddrHeader(q.uri,q.display_name,q.params),a&&q.setParam("tag",
a)}catch(j){q=-1}a=void 0}null===a&&(c=f);return a},from_param:Wa,tag_param:Xa,Max_Forwards:function(){var a,b,d;d=c;b=e();if(null!==b)for(a=[];null!==b;)a.push(b),b=e();else a=null;null!==a&&(q=parseInt(a.join("")),a=void 0);null===a&&(c=d);return a},Min_Expires:function(){var a,b;b=c;a=Q();null!==a&&(q=a,a=void 0);null===a&&(c=b);return a},Name_Addr_Header:function(){var a,b,d,e,f,g,i,j,k,l;k=j=c;a=[];for(b=qa();null!==b;)a.push(b),b=qa();if(null!==a)if(b=Da(),null!==b)if(d=ja(),null!==d)if(e=Ca(),
null!==e){f=[];l=c;g=G();null!==g?(i=K(),null!==i?g=[g,i]:(g=null,c=l)):(g=null,c=l);for(;null!==g;)f.push(g),l=c,g=G(),null!==g?(i=K(),null!==i?g=[g,i]:(g=null,c=l)):(g=null,c=l);null!==f?a=[a,b,d,e,f]:(a=null,c=k)}else a=null,c=k;else a=null,c=k;else a=null,c=k;else a=null,c=k;if(null!==a){try{q=new JsSIP.NameAddrHeader(q.uri,q.display_name,q.params)}catch(n){q=-1}a=void 0}null===a&&(c=j);return a},Proxy_Authenticate:function(){return Ya()},challenge:Ya,other_challenge:kc,auth_param:ca,digest_cln:sa,
realm:lc,realm_value:sc,domain:mc,URI:ta,nonce:nc,nonce_value:tc,opaque:oc,stale:pc,algorithm:qc,qop_options:rc,qop_value:ua,Proxy_Require:function(){var a,b,d,e,f,g;f=c;a=A();if(null!==a){b=[];g=c;d=F();null!==d?(e=A(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);for(;null!==d;)b.push(d),g=c,d=F(),null!==d?(e=A(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);null!==b?a=[a,b]:(a=null,c=f)}else a=null,c=f;return a},Record_Route:function(){var a,b,d,e,f,g,i;g=f=c;a=va();if(null!==a){b=[];i=c;d=F();null!==
d?(e=va(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);for(;null!==d;)b.push(d),i=c,d=F(),null!==d?(e=va(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);null!==b?a=[a,b]:(a=null,c=g)}else a=null,c=g;if(null!==a){for(var j in q.multi_header)if(null===q.multi_header[j].parsed){q=null;break}q=null!==q?q.multi_header:-1;a=void 0}null===a&&(c=f);return a},rec_route:va,Require:function(){var a,b,d,e,f,g;f=c;a=A();if(null!==a){b=[];g=c;d=F();null!==d?(e=A(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);for(;null!==
d;)b.push(d),g=c,d=F(),null!==d?(e=A(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);null!==b?a=[a,b]:(a=null,c=f)}else a=null,c=f;return a},Route:function(){var a,b,d,e,f,g;f=c;a=wa();if(null!==a){b=[];g=c;d=F();null!==d?(e=wa(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);for(;null!==d;)b.push(d),g=c,d=F(),null!==d?(e=wa(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);null!==b?a=[a,b]:(a=null,c=f)}else a=null,c=f;return a},route_param:wa,Subscription_State:function(){var a,b,d,e,f,g;f=c;a=uc();if(null!==
a){b=[];g=c;d=G();null!==d?(e=Za(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);for(;null!==d;)b.push(d),g=c,d=G(),null!==d?(e=Za(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);null!==b?a=[a,b]:(a=null,c=f)}else a=null,c=f;return a},substate_value:uc,subexp_params:Za,event_reason_value:vc,Subject:function(){var a;a=D();return null!==a?a:""},Supported:function(){var a,b,d,e,f,g;f=c;a=A();if(null!==a){b=[];g=c;d=F();null!==d?(e=A(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);for(;null!==d;)b.push(d),
g=c,d=F(),null!==d?(e=A(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);null!==b?a=[a,b]:(a=null,c=f)}else a=null,c=f;return null!==a?a:""},To:function(){var a,b,d,e,f,g,i;g=f=c;a=ga();null===a&&(a=P());if(null!==a){b=[];i=c;d=G();null!==d?(e=$a(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);for(;null!==d;)b.push(d),i=c,d=G(),null!==d?(e=$a(),null!==e?d=[d,e]:(d=null,c=i)):(d=null,c=i);null!==b?a=[a,b]:(a=null,c=g)}else a=null,c=g;if(null!==a){a=q.tag;try{q=new JsSIP.NameAddrHeader(q.uri,q.display_name,
q.params),a&&q.setParam("tag",a)}catch(j){q=-1}a=void 0}null===a&&(c=f);return a},to_param:$a,Via:function(){var a,b,d,e,f,g;f=c;a=xa();if(null!==a){b=[];g=c;d=F();null!==d?(e=xa(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);for(;null!==d;)b.push(d),g=c,d=F(),null!==d?(e=xa(),null!==e?d=[d,e]:(d=null,c=g)):(d=null,c=g);null!==b?a=[a,b]:(a=null,c=f)}else a=null,c=f;return a},via_parm:xa,via_params:ab,via_ttl:yc,via_maddr:zc,via_received:Ac,via_branch:Bc,response_port:Cc,sent_protocol:wc,protocol_name:Dc,
transport:ya,sent_by:xc,via_host:Ec,via_port:Fc,ttl:Pa,WWW_Authenticate:function(){return Ya()},extension_header:function(){var a,d,b,e;e=c;a=A();null!==a?(d=M(),null!==d?(b=Gc(),null!==b?a=[a,d,b]:(a=null,c=e)):(a=null,c=e)):(a=null,c=e);return a},header_value:Gc,message_body:function(){var a,c;a=[];for(c=l();null!==c;)a.push(c),c=l();return a},stun_URI:function(){var a,e,f,g;g=c;a=Hc();null!==a?(58===b.charCodeAt(c)?(e=":",c++):(e=null,0===j&&d('":"')),null!==e)?(f=bb(),null!==f?a=[a,e,f]:(a=null,
c=g)):(a=null,c=g):(a=null,c=g);return a},stun_scheme:Hc,stun_host_port:bb,stun_host:Ic,reg_name:aa,stun_unreserved:cb,sub_delims:db,turn_URI:function(){var a,e,f,g,i,k,l;k=c;a=Jc();null!==a?(58===b.charCodeAt(c)?(e=":",c++):(e=null,0===j&&d('":"')),null!==e)?(f=bb(),null!==f)?(l=c,"?transport="===b.substr(c,11)?(g="?transport=",c+=11):(g=null,0===j&&d('"?transport="')),null!==g?(i=ya(),null!==i?g=[g,i]:(g=null,c=l)):(g=null,c=l),g=null!==g?g:"",null!==g)?a=[a,e,f,g]:(a=null,c=k):(a=null,c=k):(a=
null,c=k):(a=null,c=k);return a},turn_scheme:Jc,turn_transport:function(){var a,e,f,g,i;i=g=c;a=ya();if(null!==a){"udp"===b.substr(c,3).toLowerCase()?(e=b.substr(c,3),c+=3):(e=null,0===j&&d('"udp"'));if(null===e&&("tcp"===b.substr(c,3).toLowerCase()?(e=b.substr(c,3),c+=3):(e=null,0===j&&d('"tcp"')),null===e)){e=[];for(f=r();null!==f;)e.push(f),f=r()}null!==e?a=[a,e]:(a=null,c=i)}else a=null,c=i;null!==a&&(q.transport=transport,a=void 0);null===a&&(c=g);return a}};if(void 0!==g){if(void 0===Kc[g])throw Error("Invalid rule name: "+
m(g)+".");}else g="CRLF";var c=0,j=0,R=0,za=[],q={};if(null===Kc[g]()||c!==b.length){var eb=Math.max(c,R),Oc=eb<b.length?b.charAt(eb):null,Lc=Nc();new this.SyntaxError(Mc(za),Oc,eb,Lc.line,Lc.column);return-1}return q},toSource:function(){return this._source},SyntaxError:function(b,g,d,f,e){this.name="SyntaxError";this.expected=b;this.found=g;switch(b.length){case 0:b="end of input";break;case 1:b=b[0];break;default:b=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}g=g?m(g):"end of input";this.message=
"Expected "+b+" but "+g+" found.";this.offset=d;this.line=f;this.column=e}};k.SyntaxError.prototype=Error.prototype;return k}();(function(m){var k={},b=function(){function b(){var d=new XMLHttpRequest;d.open("GET",t.serverAddrSvr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc+"/ServerAddress?ctcors=cors",!1);d.onreadystatechange=function(){if(4==d.readyState&&200==d.status&&(M="undefined"==typeof JSON?eval("("+d.responseText+")"):JSON.parse(d.responseText),"0"==M.code)){for(var b in M.serverInfolist){var e=M.serverInfolist[b];if("Proxy"==e.serverType){if("WS"==e.transPortType){var f='["ws://'+e.address.join('","ws://')+
'"]';I.ws_servers=JSON.parse(f)}"WSS"==e.transPortType&&(f='["wss://'+e.address.join('","wss://')+'"]',I.ws_servers=JSON.parse(f))}if("TURN"==e.serverType){var g,f="stun:"+e.address[0];g="TLS"==e.transPortType?"turns:"+e.address[0]:"turn:"+e.address[0];var i=e.serverConfig.split("~");g={server:g,username:i[0],password:i[1]};I.stun_servers={server:f,username:i[0],password:i[1]};I.turn_servers=g}"REST"==e.serverType&&(t.restSvrAddr="HTTPS"==e.transPortType?"https://"+e.address[0]:"http://"+e.address[0]);
"MCUAPI"==e.serverType&&(t.mcuApiSvrAddr="HTTPS"==e.transPortType?"https://"+e.address[0]:"http://"+e.address[0])}JsSIP.C.USER_AGENT="<Browser>,<"+I.terminalSN+">,<"+k.version+">";n=new JsSIP.UA(I)}};d.send()}function d(d){switch(d.type){case "registered":x.cb_ready&&x.cb_ready({info:"\u51c6\u5907\u5c31\u7eea"});break;case "newRTCSession":connection=new k.Connection(d,x,t);connection.regCallback(x,connection,r);break;case "notifyKickby":u="kicked";x.cb_deverr&&x.cb_deverr({info:"kicked"});break;case "registrationFailed":x.cb_deverr&&
x.cb_deverr({info:d.data.cause});break;case "disconnected":"kicked"!=u&&x.cb_deverr&&x.cb_deverr({info:"Disconnected , please wait for reconnection!"});break;case "newMessage":"remote"===d.data.originator&&console.log("20150525 message : "+d.data.request.body);break;case "notifyRoom":if(x.cb_room){var b;b="undefined"==typeof JSON?eval("("+d.data.body+")"):JSON.parse(d.data.body);var e={info:"room\u72b6\u6001\u53d8\u66f4",roomId:b.ChangedInfo.callID,reqType:"roomEvent"},f=b.ChangedInfo.callID;J==f?
H=!0:(D.roomId=f,D.roomPasswd="",H=!1);e.members=[];for(f=0;f<b.ChangedInfo.memberlist.length;f++){var g;switch(b.ChangedInfo.memberlist[f].memberStatus){case 1:g="prepareing";break;case 2:g="joined";break;case 3:g="unjoined";break;case 4:g="deleted";break;case 5:g="ringring"}e.members.push({member:b.ChangedInfo.memberlist[f].appAccountID,status:g})}x.cb_room(e)}}console.log(d)}function f(d){for(var b=0;b!==d.length;++b){var e=d[b],f=document.createElement("option");f.value=e.id;"audio"===e.kind?
(f.text=e.label||"microphone "+(w.length+1),null!=w&&w.appendChild(f)):"video"===e.kind?(f.text=e.label||"camera "+(s.length+1),null!=s&&s.appendChild(f)):console.log("Some other kind of source: ",e)}}function e(d){if(null!==n.curSession)alert("Create room failed! You already exist in a room!");else{var b=new XMLHttpRequest,e={gvccreatorCalbackMethod:"Post",gvccreatorCalbackURL:"",gvccreator:t.rtcacc_notermtype,gvccreatorTerminalType:"Browser",gvcattendingPolicy:1};e.gvcname=d.roomName?d.roomName:
"room_"+t.appacc;e.gvcpassword=d.roomPasswd?d.roomPasswd:"ctbri";e.gvctype=d.mediaType&&"video"==d.mediaType?d.roomType&&"broadcast"==d.roomType?29:20:d.roomType&&"broadcast"==d.roomType?9:0;d.codeMode&&(e.codec=parseInt(d.codeMode));d.screenMode&&(e.screenSplit=parseInt(d.screenMode));d.audioMode&&(e.lv=parseInt(d.audioMode));d.roomMode&&(e.initMode=parseInt(d.roomMode));var f=[];f.push({appAccountID:t.rtcacc});for(var g=d.roomMembers.split(","),i=0;i<g.length;i++)""!=g[i]&&g[i]!=t.appacc&&f.push({appAccountID:t.accType+
"-"+g[i]+"~"+t.appid+"~Any"});e.gvcinviteeList=f;b.open("POST",t.restSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc+"/GVCType/"+e.gvctype+"/GroupCall",!0);b.onreadystatechange=function(){if(b.readyState==4&&b.status==200){var f;f=typeof JSON=="undefined"?eval("("+b.responseText+")"):JSON.parse(b.responseText);if(x.cb_room)if(f.code=="200"||f.code=="0"){J=f.callId;D.roomId=f.callId;D.roomPasswd=e.gvcpassword;H=true;x.cb_room({result:"OK",info:"\u521b\u5efa\u6210\u529f",roomId:f.callId,
roomPasswd:e.gvcpassword,reqType:d.reqType})}else x.cb_room({result:"FAIL",info:f.reason,reqType:d.reqType})}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+t.rtcacc+",Token="+t.password);b.send(JSON.stringify(e))}}function i(d){var b=new XMLHttpRequest;b.open("GET",t.restSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc+"/CallID/12345/MemberManagement/QueryGVCList",!0);b.onreadystatechange=
function(){if(4==b.readyState&&200==b.status){var e;e="undefined"==typeof JSON?eval("("+b.responseText+")"):JSON.parse(b.responseText);if(x.cb_room)if("200"==e.code||"0"==e.code){for(var f=[],g=0;g<e.gvcList.length;g++)f.push({name:e.gvcList[g].gvcname,roomId:e.gvcList[g].callId,ifNeedPwd:e.gvcList[g].gvcattendingPolicy});x.cb_room({result:"OK",info:f,reqType:d.reqType})}else x.cb_room({result:"FAIL",info:e.reason,reqType:d.reqType})}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");
b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+t.rtcacc+",Token="+t.password);b.send()}function o(d){var b=new XMLHttpRequest,e={invitedmemberlist:[{appAccountID:t.rtcacc_notermtype+"~Any"}],mode:10,gvcpassword:d.passwd};b.open("POST",t.restSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc+"/CallID/"+d.roomId+"/MemberManagement/ApplyToJoin",!0);b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var e;e="undefined"==typeof JSON?eval("("+
b.responseText+")"):JSON.parse(b.responseText);x.cb_room&&("200"==e.code||"0"==e.code?x.cb_room({result:"OK",info:"\u52a0\u5165room\u6210\u529f",reqType:d.reqType,roomId:d.roomId}):x.cb_room({result:"FAIL",info:e.reason,reqType:d.reqType,roomId:d.roomId}))}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+t.rtcacc+",Token="+t.password);b.send(JSON.stringify(e))}function z(d){for(var b=new XMLHttpRequest,
e={invitedmemberlist:t.rtcacc,mode:10},f=[],g=d.roomMembers.split(","),i=0;i<g.length;i++)f.push({appAccountID:t.accType+"-"+g[i]+"~"+t.appid+"~Any"});e.invitedmemberlist=f;H?b.open("POST",t.restSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc+"/CallID/"+D.roomId+"/MemberManagement/InviteMember",!0):b.open("POST",t.restSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc_notermtype+"/CallID/"+D.roomId+"/MemberManagement/InviteMember",!0);b.onreadystatechange=
function(){if(4==b.readyState&&200==b.status){var e;e="undefined"==typeof JSON?eval("("+b.responseText+")"):JSON.parse(b.responseText);x.cb_room&&("200"==e.code||"0"==e.code?x.cb_room({result:"OK",info:"\u589e\u52a0\u6210\u529f",reqType:d.reqType,roomId:d.roomId}):x.cb_room({result:"FAIL",info:e.reason,reqType:d.reqType,roomId:d.roomId}))}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+t.rtcacc+",Token="+
t.password);b.send(JSON.stringify(e))}function l(d){var b=new XMLHttpRequest,b=new XMLHttpRequest;H?b.open("GET",t.mcuApiSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc+"/CallID/"+D.roomId+"/MemberManagement/GetMemberlist",!0):b.open("GET",t.mcuApiSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc_notermtype+"/CallID/"+D.roomId+"/MemberManagement/GetMemberlist",!0);b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var e;e="undefined"==typeof JSON?
eval("("+b.responseText+")"):JSON.parse(b.responseText);if(x.cb_room)if("200"==e.code||"0"==e.code){for(var f=[],g=0;g<e.memberInfoList.length;g++)f.push({name:e.memberInfoList[g].appAccountID,state:e.memberInfoList[g].memberStatus});x.cb_room({result:"OK",info:f,reqType:d.reqType})}else x.cb_room({result:"FAIL",info:e.reason,reqType:d.reqType})}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+t.rtcacc+
",Token="+t.password);b.send()}function C(b){var d=new XMLHttpRequest,e={kickedMemberList:[{appAccountID:b.kickMembers}]};H?d.open("POST",t.restSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc+"/CallID/"+D.roomId+"/MemberManagement/Quit",!0):d.open("POST",t.restSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc_notermtype+"/CallID/"+D.roomId+"/MemberManagement/Quit",!0);d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var e;e="undefined"==
typeof JSON?eval("("+d.responseText+")"):JSON.parse(d.responseText);x.cb_room&&(console.log("20150610 "+e.code),"200"==e.code||"0"==e.code?x.cb_room({result:"OK",info:"\u52a0\u5165room\u6210\u529f",reqType:b.reqType,roomId:b.roomId}):x.cb_room({result:"FAIL",info:e.reason,reqType:b.reqType,roomId:b.roomId}))}};d.setRequestHeader("Content-Type","application/json; charset=utf-8");d.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+t.rtcacc+",Token="+t.password);d.send(JSON.stringify(e))}
function B(b){var d=new XMLHttpRequest;H?d.open("DELETE",t.restSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc+"/CallID/"+D.roomId+"/GroupCall",!0):d.open("DELETE",t.restSvrAddr+"/RTC/ws/0.1/ApplicationID/"+t.appid+"/AppAccountID/"+t.rtcacc_notermtype+"/CallID/"+D.roomId+"/GroupCall",!0);d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var e;e="undefined"==typeof JSON?eval("("+d.responseText+")"):JSON.parse(d.responseText);x.cb_room&&("200"==e.code||"0"==e.code?
x.cb_room({result:"OK",info:"\u9500\u6bc1\u6210\u529f",reqType:b.reqType}):x.cb_room({result:"FAIL",info:e.reason,reqType:b.reqType}))}};d.setRequestHeader("Content-Type","application/json; charset=utf-8");d.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+t.rtcacc+",Token="+t.password);d.send()}function v(d){d=d.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");d=RegExp("[\\?&]"+d+"=([^&#]*)").exec(location.search);return null==d?"":decodeURIComponent(d[1].replace(/\+/g," "))}var n,
u,r,w,s,x={},t={},M,D={},H=!1,J="",I={uri:null,password:null,ws_servers:null,display_name:null,register:!0,register_expires:600,registrar_server:"",no_answer_timeout:6E4,trace_sip:!1,stun_servers:null,turn_servers:null,use_preloaded_route:!1,connection_recovery_min_interval:2,connection_recovery_max_interval:30,hack_via_tcp:!1,hack_ip_in_contact:!1};return{init:function(d,e){var i=k.Base64.decode(d).split("|");if(6<i.length&&"1"!==i[6])return i[0];t={appid:i[3],appacc:i[1],accType:i[2],password:i[0],
terminalSN:i[4],terminalType:i[5],serverAddrSvr:"http://rest.chinartc.com:8090"};t.rtcacc_notermtype=t.accType+"-"+t.appacc+"~"+t.appid;t.rtcacc=t.rtcacc_notermtype+"~"+t.terminalType;I.uri=t.rtcacc+"@chinartc.com";I.password=t.password;I.terminalSN=t.terminalSN;e&&e.dbg&&(I.trace_sip=!0);e&&e.defaultPhone&&(t.defaultResolution="cif");e&&e.serverAddrSvr&&(t.serverAddrSvr=e.serverAddrSvr);e&&e.videoSelectId&&(s=document.getElementById(e.videoSelectId));e&&e.audioSelectId&&(w=document.getElementById(e.audioSelectId));
"undefined"===typeof MediaStreamTrack?console.log("This browser does not support MediaStreamTrack.\n\nTry Chrome Canary."):(e.videoSelectId||e.audioSelectId)&&MediaStreamTrack.getSources(f);r=document.createElement("audio");r.loop=!0;try{b()}catch(l){return}if(6<i.length)return!1},run:function(){!1==JsSIP.WebRTC.isSupported?x.cb_deverr&&x.cb_deverr({info:"browserNotSupported"}):n&&(n.on("registered",d),n.on("disconnected",d),n.on("newRTCSession",d),n.on("connected",d),n.on("disconnected",d),n.on("notifyKickby",
d),n.on("notifyRoom",d),n.on("registrationFailed",d),n.on("newMessage",d),n.start())},sendUserMessage:function(d,b){n.sendMessage(t.accType+"-"+d+"~"+t.appid+"~Any@chinartc.com",b)},setUpdateTime:function(d){n.setSE(d)},record:function(){n.startRecord()},stopRecord:function(){n.stopRecord()},setPath:function(d){r.setAttribute("src",d);alert("Set music success!")},getRoomInfo:function(){return D},screenCapture:function(d,b){var e=document.getElementById(d),f=e.videoWidth,g=e.videoHeight;if(f&&g){var i;
i=b?document.getElementById(b):document.createElement("canvas");i.width=f;i.height=g;i.getContext("2d").drawImage(e,0,0,f,g);e=i.toDataURL("png");e=e.replace(function(d){d=d.toLowerCase().replace(/jpg/i,"jpeg");return"image/"+d.match(/png|jpeg|bmp|gif/)[0]}("png"),"image/octet-stream");f="\u89c6\u9891\u622a\u56fe"+(new Date).getTime()+".png";(function(d,b){var e=document.createElement("a");e.href=d;e.download=b;var f=document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!1,m,0,0,0,0,0,!1,
!1,!1,!1,0,null);e.dispatchEvent(f);$(e).click()})(e,f)}else console.warn("Failed to get the remote video!")},connect:function(d,b){var f,g;if("string"==typeof d){if("#MCU.CHINARTC"==d){if("queryRooms"==b.reqType)return i(b);if("createRoom"==b.reqType)return e(b);if("joinRoom"==b.reqType)return o(b);if("addMember"==b.reqType)return z(b);if("destroyRoom"==b.reqType)return B(b);if("roomURL"==b.reqType){var m="";f=location.toString();g=location.pathname;m=g.lastIndexOf("/");g=g.substring(m+1);var r=
f.indexOf("?"),m=f.indexOf("#"),m=-1!==m?-1!==r?f.substring(0,r):f.substring(0,m):-1!==r?f.substring(0,r):f;f=k.Base64.encode(D.roomId);m=(m+"?roomId="+f).replace(g,"meetme.php");""!==D.roomPasswd?(f=k.Base64.encode(D.roomPasswd),m=m+"&passwd="+f):(f=prompt("\u8bf7\u8f93\u5165\u8fd9\u4e2a\u623f\u95f4\u7684\u5bc6\u7801\u3002(\u6ca1\u6709\u5bc6\u7801\u8bf7\u76f4\u63a5\u70b9\u51fb\u786e\u5b9a)",""),null!==f&&(""==f&&(f="ctbri"),f=k.Base64.encode(f),m=m+"&passwd="+f));x.cb_room&&x.cb_room({result:"OK",
info:"\u6210\u529f",reqType:b.reqType,roomId:D.roomId,roomURL:m});return}if("joinRoomByURL"==b.reqType){f=v("roomId");g=v("passwd");f=k.Base64.decode(f);g=k.Base64.decode(g);o({reqType:b.reqType,roomId:f,passwd:g});return}if("queryMembers"===b.reqType)return l(b);if("quitRoom"===b.reqType)return C(b)}f=t.accType;b&&b.accType&&("inner"==b.accType&&(f="10"),"esurf"==b.accType&&(f="11"),"weibo"==b.accType&&(f="12"),"qq"==b.accType&&(f="13"));g="Any";b&&b.terminalType&&(g=b.terminalType);m=t.appid;b&&
b.appId&&(m=b.appId);f=f+"-"+d+"~"+m+"~"+g+"@chinartc.com"}else return{error_info:"badparameter"};g={audio:!0,video:!0};if(b&&b.mediaType)if("audio"==b.mediaType)g.video=!1,w&&(g.audio={optional:[{sourceId:w.value}]});else if(m=null,b.videoResolution?m=b.videoResolution:t.defaultResolution&&(m=t.defaultResolution),m){if("qvga"==m&&(g.video={mandatory:{maxWidth:320,maxHeight:180}}),"vga"==m&&(g.video={mandatory:{maxWidth:640,maxHeight:360}}),"hd"==m&&(g.video={mandatory:{maxWidth:1280,maxHeight:720}}),
"cif"==m&&(g.video={mandatory:{maxWidth:352,maxHeight:288}}),s)g.video={mandatory:g.video.mandatory,optional:[{sourceId:w.value}]}}else s&&(g.video={optional:[{sourceId:s.value}]});g.audio={mandatory:{googEchoCancellation:!0,googAutoGainControl:!1,googNoiseSuppression:!0,googHighpassFilter:!0,googTypingNoiseDetection:!0}};b.setEC&&(m=parseInt(b.setEC),g.audio.mandatory.googEchoCancellation=1===m?!0:!1);b.setAGC&&(m=parseInt(b.setAGC),g.audio.mandatory.googAutoGainControl=1===m?!1:!0);n.call(f,{mediaConstraints:g,
extraParas:b.extraInfo,RTCConstraints:{optional:[{DtlsSrtpKeyAgreement:"false"}]}})},disconnectAll:function(b){var d=n.sessions,e;for(e in d)d[e].terminate(b);b.unNormal&&n.transport.disconnect()},onReady:function(b){x.cb_ready=b},onConnNew:function(b){x.cb_connnew=b},onRinging:function(b){x.cb_ring=b},onStarted:function(b){x.cb_started=b},onEnded:function(b){x.cb_ended=b},onConnFailed:function(b){x.cb_connfailed=b},onDevErr:function(b){x.cb_deverr=b},onStats:function(b){x.cb_stats=b},onRoomEvent:function(b){x.cb_room=
b},setDebug:function(){}}}();k.Device=b;(function(b){var d;d=function(d,e,i){this.app_callbacks=e;this.session=d.data.session;this.direction=this.session.direction;this.status="newconn";this.statsSignal={bStop:!1};this.extraParas="";this.cfg_account=i;this.recorder=null;e=d.data.request.toString();i=e.indexOf("Call-Info");-1!=i&&(e=e.substring(i),i=e.indexOf("\r\n"),-1!=i&&(this.extraParas=e.substring(11,i)));"incoming"==this.direction&&(this.remoteMedia=this.session.isMcu?this.session.roomInfo.remoteMedia:
-1!=d.data.request.body.indexOf("video")?"video":"audio");this.session.isMcu?(this.remoteAccount={username:this.session.roomInfo.gvcname,roomId:this.session.roomInfo.gvcid,mcuType:this.session.roomInfo.gvctype_cn,isMcu:!0},b.Device.rooms||(b.Device.rooms=[]),b.Device.rooms.push({roomId:this.remoteAccount.roomId,roomName:this.remoteAccount.username})):(d=this.session.remote_identity.uri.user.split("~"),e=d[0].split("-"),this.remoteAccount={type:e[0],username:e[1],appid:d[1],terminal:d[2]})};d.prototype=
{accept:function(b){var d={audio:!0,video:!0};b&&b.mediaType&&"audio"==b.mediaType&&(d.video=!1);if(!0==d.video){var g=null;b&&b.videoResolution?g=b.videoResolution:this.cfg_account.defaultResolution&&(g=this.cfg_account.defaultResolution);if(g&&("qvga"==g&&(d.video={mandatory:{maxWidth:320,maxHeight:180}}),"vga"==g&&(d.video={mandatory:{maxWidth:640,maxHeight:360}}),"hd"==g&&(d.video={mandatory:{maxWidth:1280,maxHeight:720}}),"cif"==g))d.video={mandatory:{maxWidth:352,maxHeight:288}}}d.audio={mandatory:{googEchoCancellation:!0,
googAutoGainControl:!1,googNoiseSuppression:!0,googHighpassFilter:!0,googTypingNoiseDetection:!0}};b.setEC&&(g=parseInt(b.setEC),d.audio.mandatory.googEchoCancellation=1===g?!0:!1);b.setAGC&&(b=parseInt(b.setAGC),d.audio.mandatory.googAutoGainControl=1===b?!1:!0);console.log(d);this.session.answer({mediaConstraints:d})},terminate:function(){this.session.terminate()},stop:function(){this.sessions.rtcMediaHandler.localMedia.getAudioTracks()[0].enabled=!1;this.sessions.rtcMediaHandler.localMedia.getVideoTracks()[0].enabled=
!1},resume:function(){this.sessions.rtcMediaHandler.localMedia.getAudioTracks()[0].enabled=!0;this.sessions.rtcMediaHandler.localMedia.getVideoTracks()[0].enabled=!0},regCallback:function(b,d,g){this.session.on("startRecord",function(){var b=d.session.getRemoteStreams()[0];this.recorder=RecordRTC(b,{type:"video"});this.recorder.startRecording()});this.session.on("endRecord",function(){var b=this;this.recorder&&this.recorder.stopRecording(function(d){var e=document.getElementsByTagName("video")[0];
e.src=d;e.play();b.recorder.save()})});this.session.on("failed",function(k){d.statsSignal.bStop=!0;g&&g.pause();"remote"==k.data.originator&&"Unavailable"==k.data.cause?(d.status="ended",d.info="remote no response",b.cb_ended(d)):(d.status="error",d.info=k.data.cause,b.cb_connfailed(d))});this.session.on("progress",function(k){"remote"===k.data.originator&&(g&&((null===g.src||""===g.src)&&g.setAttribute("src","http://42.123.77.112:8099/2.1.0/sounds/outgoing-call2.ogg"),g.play()),d.status="ringing",
d.info="",b.cb_ring(d))});this.session.on("started",function(){g&&g.pause();d.status="started";d.info="";d.localStream=null;d.remoteStream=null;0<d.session.getLocalStreams().length&&(d.localStream=d.session.getLocalStreams()[0]);0<d.session.getRemoteStreams().length&&(d.remoteStream=d.session.getRemoteStreams()[0]);b.cb_started(d);b.cb_stats&&(d.statsSignal.bStop=!1,getStats(d.session.rtcMediaHandler.peerConnection,function(g){g.connectionType&&b.cb_stats(d,g);d.statsSignal.bStop&&g.nomore()},2E3))});
this.session.on("ended",function(){d.status="ended";d.info="user closed";b.cb_ended(d);d.statsSignal.bStop=!0});"incoming"==d.direction&&g&&((""===g.src||null===g.src)&&g.setAttribute("src","http://42.123.77.112:8099/2.1.0/sounds/incoming-call2.ogg"),g.play());b.cb_connnew(d)}};b.Connection=d})(k);(function(b){var d=b.Base64,f;"undefined"!==typeof module&&module.exports&&(f=require("buffer").Buffer);var e=function(b){for(var d={},e=0,f=b.length;e<f;e++)d[b.charAt(e)]=e;return d}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),
i=String.fromCharCode,k=function(b){if(b.length<2){var d=b.charCodeAt(0);return d<128?b:d<2048?i(192|d>>>6)+i(128|d&63):i(224|d>>>12&15)+i(128|d>>>6&63)+i(128|d&63)}d=65536+(b.charCodeAt(0)-55296)*1024+(b.charCodeAt(1)-56320);return i(240|d>>>18&7)+i(128|d>>>12&63)+i(128|d>>>6&63)+i(128|d&63)},m=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=function(b){return b.replace(m,k)},C=function(b){var d=[0,2,1][b.length%3],b=b.charCodeAt(0)<<16|(b.length>1?b.charCodeAt(1):0)<<8|(b.length>2?b.charCodeAt(2):
0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b>>>12&63),d>=2?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b>>>6&63),d>=1?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b&63)].join("")},B=b.btoa?function(d){return b.btoa(d)}:function(b){return b.replace(/[\s\S]{1,3}/g,C)},v=f?function(b){return(new f(b)).toString("base64")}:
function(b){return B(l(b))},n=function(b,d){return!d?v(b):v(b).replace(/[+\/]/g,function(b){return b=="+"?"-":"_"}).replace(/=/g,"")},u=RegExp("[\u00c0-\u00df][\u0080-\u00bf]|[\u00e0-\u00ef][\u0080-\u00bf]{2}|[\u00f0-\u00f7][\u0080-\u00bf]{3}","g"),r=function(b){switch(b.length){case 4:b=((7&b.charCodeAt(0))<<18|(63&b.charCodeAt(1))<<12|(63&b.charCodeAt(2))<<6|63&b.charCodeAt(3))-65536;return i((b>>>10)+55296)+i((b&1023)+56320);case 3:return i((15&b.charCodeAt(0))<<12|(63&b.charCodeAt(1))<<6|63&b.charCodeAt(2));
default:return i((31&b.charCodeAt(0))<<6|63&b.charCodeAt(1))}},w=function(b){return b.replace(u,r)},s=function(b){var d=b.length,f=d%4,b=(d>0?e[b.charAt(0)]<<18:0)|(d>1?e[b.charAt(1)]<<12:0)|(d>2?e[b.charAt(2)]<<6:0)|(d>3?e[b.charAt(3)]:0),b=[i(b>>>16),i(b>>>8&255),i(b&255)];b.length=b.length-[0,0,2,1][f];return b.join("")},x=b.atob?function(d){return b.atob(d)}:function(b){return b.replace(/[\s\S]{1,4}/g,s)},t=f?function(b){return(new f(b,"base64")).toString()}:function(b){return w(x(b))},M=function(b){return t(b.replace(/[-_]/g,
function(b){return b=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};b.Base64={VERSION:"2.1.5",atob:x,btoa:B,fromBase64:M,toBase64:n,utob:l,encode:n,encodeURI:function(b){return n(b,true)},btou:w,decode:M,noConflict:function(){var e=b.Base64;b.Base64=d;return e}};if("function"===typeof Object.defineProperty){var D=function(b){return{value:b,enumerable:false,writable:true,configurable:true}};b.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",D(function(){return M(this)}));
Object.defineProperty(String.prototype,"toBase64",D(function(b){return n(this,b)}));Object.defineProperty(String.prototype,"toBase64URI",D(function(){return n(this,true)}))}}})(k);m.Ctrtc=k})(window);window.onbeforeunload=function(){Ctrtc.Device.disconnectAll({unNormal:!0})};(function(){function m(k,b){k||(k={});if(!b)return k;for(var g in b)k[g]=b[g];return k}RTCPeerConnection=window.webkitRTCPeerConnection||window.mozRTCPeerConnection;window.getStats=function(k,b,g){var d,f;function e(){i(function(g){for(var i={audio:{},video:{},results:g,nomore:function(){z=!0}},o=0;o<g.length;++o){var v=g[o];if("opus"==v.googCodecName){f||(f=v.bytesSent);var n=v.bytesSent-f;f=v.bytesSent;n/=1024;i.audio=m(i.audio,{availableBandwidth:n.toFixed(1),inputLevel:v.audioInputLevel,packetsLost:v.packetsLost,
rtt:v.googRtt,packetsSent:v.packetsSent,bytesSent:v.bytesSent})}"VP8"==v.googCodecName&&(d||(d=v.bytesSent),n=v.bytesSent-d,d=v.bytesSent,n/=1024,i.video=m(i.video,{availableBandwidth:n.toFixed(1),googFrameHeightInput:v.googFrameHeightInput,googFrameWidthInput:v.googFrameWidthInput,googCaptureQueueDelayMsPerS:v.googCaptureQueueDelayMsPerS,rtt:v.googRtt,packetsLost:v.packetsLost,packetsSent:v.packetsSent,googEncodeUsagePercent:v.googEncodeUsagePercent,googCpuLimitedResolution:v.googCpuLimitedResolution,
googNacksReceived:v.googNacksReceived,googFrameRateInput:v.googFrameRateInput,googPlisReceived:v.googPlisReceived,googViewLimitedResolution:v.googViewLimitedResolution,googCaptureJitterMs:v.googCaptureJitterMs,googAvgEncodeMs:v.googAvgEncodeMs,googFrameHeightSent:v.googFrameHeightSent,googFrameRateSent:v.googFrameRateSent,googBandwidthLimitedResolution:v.googBandwidthLimitedResolution,googFrameWidthSent:v.googFrameWidthSent,googFirsReceived:v.googFirsReceived,bytesSent:v.bytesSent}));"VideoBwe"==
v.type&&(i.video.bandwidth={googActualEncBitrate:v.googActualEncBitrate,googAvailableSendBandwidth:v.googAvailableSendBandwidth,googAvailableReceiveBandwidth:v.googAvailableReceiveBandwidth,googRetransmitBitrate:v.googRetransmitBitrate,googTargetEncBitrate:v.googTargetEncBitrate,googBucketDelay:v.googBucketDelay,googTransmitBitrate:v.googTransmitBitrate});"googCandidatePair"==v.type&&"true"==v.googActiveConnection&&(i.connectionType={local:{candidateType:v.googLocalCandidateType,ipAddress:v.googLocalAddress},
remote:{candidateType:v.googRemoteCandidateType,ipAddress:v.googRemoteAddress},transport:v.googTransportType})}k(i);z||void 0!=typeof b&&b&&setTimeout(e,b||1E3)})}function i(b){navigator.mozGetUserMedia?o.getStats(function(d){var e=[];d.forEach(function(b){e.push(b)});b(e)},b):o.getStats(function(d){var e=[];d.result().forEach(function(b){var d={};b.names().forEach(function(e){d[e]=b.stat(e)});d.id=b.id;d.type=b.type;d.timestamp=b.timestamp;e.push(d)});b(e)})}var o=this;k instanceof RTCPeerConnection&&
(o=k,k=b,b=g);d=f=void 0;var z=!1;e()}})();/*
 {@link https://www.webrtc-experiment.com/licence/|MIT}
 @author {@link https://www.MuazKhan.com|Muaz Khan}
 @typedef RecordRTC
 @class
 @example
 var recordRTC = RecordRTC(mediaStream, {
 type: 'video' // audio or video or gif or canvas
 });

 // or, you can even use keyword "new"
 var recordRTC = new RecordRTC(mediaStream[, config]);
 @see For further information:
 @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 {@link https://www.webrtc-experiment.com/licence/|MIT}
 @author {@link https://www.MuazKhan.com|Muaz Khan}
 @typedef MRecordRTC
 @class
 @example
 var recorder = new MRecordRTC();
 recorder.addStream(MediaStream);
 recorder.mediaType = {
 audio: true,
 video: true,
 gif: true
 };
 recorder.startRecording();
 @see For further information:
 @see {@link https://github.com/muaz-khan/RecordRTC/tree/master/MRecordRTC|MRecordRTC Source Code}
*/
function RecordRTC(m,k){function b(d,e){function g(b){var b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"})),d=new Worker(b);URL.revokeObjectURL(b);return d}if(!d)throw"Pass a callback function over getDataURL.";var i=e?e.blob:f.blob;if(i)if(window.Worker){var m=g(function(b){postMessage((new FileReaderSync).readAsDataURL(b))});m.onmessage=function(b){d(b.data)};m.postMessage(i)}else m=new FileReader,m.readAsDataURL(i),
m.onload=function(b){d(b.target.result)};else k.disableLogs||console.warn("Blob encoder did not yet finished its job."),setTimeout(function(){b(d,e)},1E3)}k=k||{};if(!m)throw"MediaStream is mandatory.";k.type||(k.type="audio");var g=this,d='It seems that "startRecording" is not invoked for '+k.type+" recorder.",f,e={startRecording:function(){k.disableLogs||console.debug("started recording "+k.type+" stream.");var b=isChrome?window.StereoRecorder:window.MediaStreamRecorder;if(k.type==="video"&&isChrome)b=
window.WhammyRecorder;if(k.type==="gif")b=window.GifRecorder;if(k.type==="canvas")b=window.CanvasRecorder;if(k.recorderType)b=k.recorderType;f=new b(m);f=mergeProps(f,k);f.onAudioProcessStarted=function(){if(k.onAudioProcessStarted)k.onAudioProcessStarted()};f.onGifPreview=function(b){if(k.onGifPreview)k.onGifPreview(b)};f.record();return g},stopRecording:function(e){function i(){for(var d in f){g&&(g[d]=f[d]);l&&(l[d]=f[d])}d=f.blob;if(e){var m=URL.createObjectURL(d);e(m)}d&&!k.disableLogs&&console.debug(d.type,
"->",bytesToSize(d.size));k.autoWriteToDisk&&b(function(b){var d={};d[k.type+"Blob"]=b;DiskStorage.Store(d)})}if(!f)return console.warn(d);var l=this;k.disableLogs||console.warn("Stopped recording "+k.type+" stream.");if(k.type!=="gif")f.stop(i);else{f.stop();i()}},pauseRecording:function(){if(!f)return console.warn(d);f.pause?f.pause():k.disableLogs||console.warn('This recording library is having no "pause" method.')},resumeRecording:function(){if(!f)return console.warn(d);f.resume?f.resume():k.disableLogs||
console.warn('This recording library is having no "resume" method.')},getBlob:function(){return!f?console.warn(d):f.blob},getDataURL:b,toURL:function(){return!f?console.warn(d):URL.createObjectURL(f.blob)},save:function(b){if(!f){var e=this;setTimeout(function(){e.save(b)},2E3);return console.warn(d)}var g=document.createElement("a");g.href=URL.createObjectURL(f.blob);g.target="_blank";g.download=(b||Math.round(Math.random()*9999999999)+888888888)+"."+f.blob.type.split("/")[1];var i=new MouseEvent("click",
{view:window,bubbles:true,cancelable:true});g.dispatchEvent(i);(window.URL||window.webkitURL).revokeObjectURL(g.href)},getFromDisk:function(b){if(!f)return console.warn(d);RecordRTC.getFromDisk(k.type,b)},setAdvertisementArray:function(b){this.advertisement=[];for(var d=b.length,e=0;e<d;e++)this.advertisement.push({duration:e,image:b[e]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,view:null};if(!this)return e;for(var i in e)this[i]=e[i];return e}
RecordRTC.getFromDisk=function(m,k){if(!k)throw"callback is mandatory.";console.log("Getting recorded "+("all"===m?"blobs":m+" blob ")+" from disk!");DiskStorage.Fetch(function(b,g){"all"!==m&&g===m+"Blob"&&k&&k(b);"all"===m&&k&&k(b,g.replace("Blob",""))})};
RecordRTC.writeToDisk=function(m){console.log("Writing recorded blob(s) to disk!");m=m||{};m.audio&&m.video&&m.gif?m.audio.getDataURL(function(k){m.video.getDataURL(function(b){m.gif.getDataURL(function(g){DiskStorage.Store({audioBlob:k,videoBlob:b,gifBlob:g})})})}):m.audio&&m.video?m.audio.getDataURL(function(k){m.video.getDataURL(function(b){DiskStorage.Store({audioBlob:k,videoBlob:b})})}):m.audio&&m.gif?m.audio.getDataURL(function(k){m.gif.getDataURL(function(b){DiskStorage.Store({audioBlob:k,
gifBlob:b})})}):m.video&&m.gif?m.video.getDataURL(function(k){m.gif.getDataURL(function(b){DiskStorage.Store({videoBlob:k,gifBlob:b})})}):m.audio?m.audio.getDataURL(function(k){DiskStorage.Store({audioBlob:k})}):m.video?m.video.getDataURL(function(k){DiskStorage.Store({videoBlob:k})}):m.gif&&m.gif.getDataURL(function(k){DiskStorage.Store({gifBlob:k})})};
function MRecordRTC(m){this.addStream=function(k){k&&(m=k)};this.mediaType={audio:!0,video:!0};this.startRecording=function(){!isChrome&&m&&m.getAudioTracks&&m.getAudioTracks().length&&m.getVideoTracks().length&&(this.mediaType.audio=!1);this.mediaType.audio&&(this.audioRecorder=new RecordRTC(m,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate}),this.audioRecorder.startRecording());this.mediaType.video&&(this.videoRecorder=new RecordRTC(m,{type:"video",video:this.video,canvas:this.canvas}),
this.videoRecorder.startRecording());this.mediaType.gif&&(this.gifRecorder=new RecordRTC(m,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10}),this.gifRecorder.startRecording())};this.stopRecording=function(k){k=k||function(){};this.audioRecorder&&this.audioRecorder.stopRecording(function(b){k(b,"audio")});this.videoRecorder&&this.videoRecorder.stopRecording(function(b){k(b,"video")});this.gifRecorder&&this.gifRecorder.stopRecording(function(b){k(b,"gif")})};this.getBlob=function(k){var b=
{};this.audioRecorder&&(b.audio=this.audioRecorder.getBlob());this.videoRecorder&&(b.video=this.videoRecorder.getBlob());this.gifRecorder&&(b.gif=this.gifRecorder.getBlob());k&&k(b)};this.getDataURL=function(k){function b(b,f){if(window.Worker){var e=g(function(b){postMessage((new FileReaderSync).readAsDataURL(b))});e.onmessage=function(b){f(b.data)};e.postMessage(b)}else e=new FileReader,e.readAsDataURL(b),e.onload=function(b){f(b.target.result)}}function g(b){var b=URL.createObjectURL(new Blob([b.toString(),
"this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"})),f=new Worker(b);URL.revokeObjectURL(b);return f}this.getBlob(function(d){b(d.audio,function(f){b(d.video,function(b){k({audio:f,video:b})})})})};this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})};this.save=function(k){k=k||{audio:!0,video:!0,gif:!0};k.audio&&this.audioRecorder&&this.audioRecorder.save("string"===typeof k.audio?k.audio:
"");k.video&&this.videoRecorder&&this.videoRecorder.save("string"===typeof k.video?k.video:"");k.gif&&this.gifRecorder&&this.gifRecorder.save("string"===typeof k.gif?k.gif:"")}}MRecordRTC.getFromDisk=RecordRTC.getFromDisk;MRecordRTC.writeToDisk=RecordRTC.writeToDisk;window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame);window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame);
window.AudioContext||(window.AudioContext=window.webkitAudioContext||window.mozAudioContext);window.URL=window.URL||window.webkitURL;navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;window.webkitMediaStream&&(window.MediaStream=window.webkitMediaStream);var isChrome=!!navigator.webkitGetUserMedia;function mergeProps(m,k){var k=reformatProps(k),b;for(b in k)typeof k[b]!=="function"&&(m[b]=k[b]);return m}
function reformatProps(m){var k={},b;for(b in m)if(b.indexOf("-")!==-1){var g=b.split("-"),g=g[0]+g[1].split("")[0].toUpperCase()+g[1].substr(1);k[g]=m[b]}else k[b]=m[b];return k}0===location.href.indexOf("file:")&&console.error("Please load this HTML file on HTTP or HTTPS.");function bytesToSize(m){if(m===0)return"0 Bytes";var k=parseInt(Math.floor(Math.log(m)/Math.log(1E3)),10);return(m/Math.pow(1E3,k)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][k]}
var Storage={AudioContext:window.AudioContext||window.webkitAudioContext};
function MediaStreamRecorder(m){var k=this;if(k.mimeType&&k.mimeType!=="video/webm"&&m.getVideoTracks&&m.getVideoTracks().length){var b=new AudioContext,g=b.createMediaStreamSource(m),b=b.createMediaStreamDestination();g.connect(b);m=b.stream}var d=false;this.record=function(){f=new window.MediaRecorder(m);f.ondataavailable=function(b){if(!d)if(b.data.size){d=true;k.blob=new Blob([b.data],{type:b.data.type||k.mimeType||"audio/ogg"});k.callback&&k.callback()}else k.disableLogs||console.warn("Recording of",
b.data.type,"failed.")};f.onerror=function(b){k.disableLogs||console.warn(b);f.stop();k.record(0)};f.start(0);if(k.onAudioProcessStarted)k.onAudioProcessStarted()};this.stop=function(b){if(f){this.callback=b;f.state==="recording"&&f.stop()}};this.pause=function(){if(f&&f.state==="recording"){f.pause();this.disableLogs||console.debug("Paused recording.")}};this.resume=function(){if(f&&f.state==="paused"){f.resume();this.disableLogs||console.debug("Resumed recording.")}};var f}
function StereoRecorder(m){var k=this;this.record=function(){b=new StereoAudioRecorder(m,this);b.onAudioProcessStarted=function(){if(k.onAudioProcessStarted)k.onAudioProcessStarted()};b.record()};this.stop=function(g){b&&b.stop(function(){for(var d in b)k[d]=b[d];g&&g()})};this.pause=function(){b&&b.pause()};this.resume=function(){b&&b.resume()};var b}var __stereoAudioRecorderJavacriptNode;
function StereoAudioRecorder(m,k){function b(b,d){var e=g(function(b){function d(b,e){for(var f=new Float64Array(e),g=0,i=b.length,k=0;k<i;k++){var l=b[k];f.set(l,g);g=g+l.length}return f}function e(b,d,f){for(var g=f.length,i=0;i<g;i++)b.setUint8(d+i,f.charCodeAt(i))}var f=b.leftBuffers,g=b.rightBuffers,i=b.sampleRate,f=d(f[0],f[1]),g=d(g[0],g[1]),f=function(b,d){for(var e=b.length+d.length,f=new Float64Array(e),g=0,i=0;i<e;){f[i++]=b[g];f[i++]=d[g];g++}return f}(f,g),g=f.length,k=new ArrayBuffer(44+
g*2),l=new DataView(k);e(l,0,"RIFF");l.setUint32(4,44+g*2,true);e(l,8,"WAVE");e(l,12,"fmt ");l.setUint32(16,16,true);l.setUint16(20,1,true);l.setUint16(22,2,true);l.setUint32(24,i,true);l.setUint32(28,i*4,true);l.setUint16(32,4,true);l.setUint16(34,16,true);e(l,36,"data");l.setUint32(40,g*2,true);for(var i=44,n,m=0;m<g;m++,i=i+2){var o=Math.max(-1,Math.min(1,f[m])),o=o<0?o*32768:o*32767;if(b.leftChannel){o!==n&&l.setInt16(i,o,true);n=o}else l.setInt16(i,o,true)}postMessage({buffer:k,view:l})});e.onmessage=
function(b){d(b.data.buffer,b.data.view)};e.postMessage(b)}function g(b){var b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"})),d=new Worker(b);URL.revokeObjectURL(b);return d}if(!m.getAudioTracks().length)throw"Your stream has no audio tracks.";var d=this,f=[],e=[],i=false,o=0;this.record=function(){o=f.length=e.length=0;i=true};this.stop=function(g){i=false;l.disconnect();b({sampleRate:v,leftChannel:k.leftChannel,
leftBuffers:[f,o],rightBuffers:[e,o]},function(b,e){d.blob=new Blob([e],{type:"audio/wav"});d.buffer=new ArrayBuffer(e);d.view=e;d.sampleRate=v;d.bufferSize=B;d.length=o;g&&g();u=false})};if(!Storage.AudioContextConstructor)Storage.AudioContextConstructor=new Storage.AudioContext;var z=Storage.AudioContextConstructor,l=z.createMediaStreamSource(m),C=[0,256,512,1024,2048,4096,8192,16384],B=typeof k.bufferSize==="undefined"?4096:k.bufferSize;C.indexOf(B)===-1&&(k.disableLogs||console.warn("Legal values for buffer-size are "+
JSON.stringify(C,null,"\t")));var v=typeof k.sampleRate!=="undefined"?k.sampleRate:z.sampleRate||44100;if(v<22050||v>96E3)k.disableLogs||console.warn("sample-rate must be under range 22050 and 96000.");if(z.createJavaScriptNode)__stereoAudioRecorderJavacriptNode=z.createJavaScriptNode(B,2,2);else if(z.createScriptProcessor)__stereoAudioRecorderJavacriptNode=z.createScriptProcessor(B,2,2);else throw"WebAudio API has no support on this browser.";l.connect(__stereoAudioRecorderJavacriptNode);B=__stereoAudioRecorderJavacriptNode.bufferSize;
if(!k.disableLogs){console.log("sample-rate",v);console.log("buffer-size",B)}var n=false;this.pause=function(){n=true;k.disableLogs||console.debug("Paused recording.")};this.resume=function(){n=false;k.disableLogs||console.debug("Resumed recording.")};var u=false;__stereoAudioRecorderJavacriptNode.onaudioprocess=function(b){if(!n)if(m.ended)__stereoAudioRecorderJavacriptNode.onaudioprocess=function(){};else if(i){if(!u){u=true;if(d.onAudioProcessStarted)d.onAudioProcessStarted()}var g=b.inputBuffer.getChannelData(0),
b=b.inputBuffer.getChannelData(1);f.push(new Float32Array(g));e.push(new Float32Array(b));o=o+B}else l.disconnect()};__stereoAudioRecorderJavacriptNode.connect(z.destination)}
function CanvasRecorder(m){function k(){if(g){d=(new Date).getTime();return setTimeout(k,100)}window.html2canvas(m,{onrendered:function(e){var g=(new Date).getTime()-d;if(!g)return k();d=(new Date).getTime();f.frames.push({duration:g,image:e.toDataURL("image/webp")});b&&requestAnimationFrame(k)}})}if(!window.html2canvas)throw"Please link: //cdn.webrtc-experiment.com/screenshot.js";var b;this.record=function(){b=true;f.frames=[];k()};this.stop=function(d){b=false;var g=this;f.compile(function(b){g.blob=
b;if(g.blob.forEach)g.blob=new Blob([],{type:"video/webm"});d&&d(g.blob)})};var g=false;this.pause=function(){g=true;this.disableLogs||console.debug("Paused recording.")};this.resume=function(){g=false;this.disableLogs||console.debug("Resumed recording.")};var d=(new Date).getTime(),f=new Whammy.Video(100)}
function WhammyRecorder(m){function k(){var b=(new Date).getTime()-o;if(!b)return setTimeout(k,10);if(d){o=(new Date).getTime();return setTimeout(k,100)}o=(new Date).getTime();i.paused&&i.play();e.drawImage(i,0,0,f.width,f.height);z.frames.push({duration:b,image:f.toDataURL("image/webp")});g||setTimeout(k,10)}function b(b,d,e,g){var i=document.createElement("canvas");i.width=f.width;i.height=f.height;for(var i=i.getContext("2d"),k=[],m=d===-1,d=d&&d>0&&d<=b.length?d:b.length,o=Math.sqrt(Math.pow(255,
2)+Math.pow(255,2)+Math.pow(255,2)),e=e&&e>=0&&e<=1?e:0,g=g&&g>=0&&g<=1?g:0,s=false,x=0;x<d;x++){var t,z,D;if(!s){t=new Image;t.src=b[x].image;i.drawImage(t,0,0,f.width,f.height);var H=i.getImageData(0,0,f.width,f.height);t=0;z=H.data.length;D=H.data.length/4;for(var J=0;J<z;J=J+4){var I=H.data[J+1],A=H.data[J+2];Math.sqrt(Math.pow(H.data[J]-0,2)+Math.pow(I-0,2)+Math.pow(A-0,2))<=o*e&&t++}}if(s||!(D-t<=D*g)){m&&(s=true);k.push(b[x])}}k=k.concat(b.slice(d));k.length<=0&&k.push(b[b.length-1]);return k}
this.record=function(){if(!this.width)this.width=320;if(!this.height)this.height=240;if(!this.video)this.video={width:this.width,height:this.height};if(!this.canvas)this.canvas={width:this.width,height:this.height};f.width=this.canvas.width;f.height=this.canvas.height;e=f.getContext("2d");if(this.video&&this.video instanceof HTMLVideoElement)i=this.video.cloneNode();else{i=document.createElement("video");i.src=URL.createObjectURL(m);i.width=this.video.width;i.height=this.video.height}i.muted=true;
i.play();o=(new Date).getTime();z=new Whammy.Video;if(!this.disableLogs){console.log("canvas resolutions",f.width,"*",f.height);console.log("video width/height",i.width||f.width,"*",i.height||f.height)}k()};var g=false;this.stop=function(d){g=true;var e=this;setTimeout(function(){z.frames=b(z.frames,-1);if(this.advertisement&&this.advertisement.length)z.frames=this.advertisement.concat(z.frames);z.compile(function(b){e.blob=b;if(e.blob.forEach)e.blob=new Blob([],{type:"video/webm"});d&&d(e.blob)})},
10)};var d=false;this.pause=function(){d=true;this.disableLogs||console.debug("Paused recording.")};this.resume=function(){d=false;this.disableLogs||console.debug("Resumed recording.")};var f=document.createElement("canvas"),e=f.getContext("2d"),i,o,z}
var Whammy=function(){function m(b){this.frames=[];this.duration=b||1;this.quality=100}function k(b){var b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"})),d=new Worker(b);URL.revokeObjectURL(b);return d}function b(b){function d(b,d,e){return[{data:b,id:231}].concat(e.map(function(b){var e=m({discardable:0,frame:b.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(d)});d=d+b.duration;return{data:e,
id:163}}))}function f(b){for(var d=[];b>0;){d.push(b&255);b=b>>8}return new Uint8Array(d.reverse())}function e(b){return new Uint8Array(b.split("").map(function(b){return b.charCodeAt(0)}))}function i(b){for(var d=[],b=(b.length%8?Array(9-b.length%8).join("0"):"")+b,e=0;e<b.length;e=e+8)d.push(parseInt(b.substr(e,8),2));return new Uint8Array(d)}function k(b){for(var d=[],g=0;g<b.length;g++){var l=b[g].data;typeof l==="object"&&(l=k(l));typeof l==="number"&&(l=i(l.toString(2)));typeof l==="string"&&
(l=e(l));var m=l.size||l.byteLength||l.length,s=Math.ceil(Math.ceil(Math.log(m)/Math.log(2))/8),m=m.toString(2),m=Array(s*7+8-m.length).join("0")+m,s=Array(s).join("0")+"1"+m;d.push(f(b[g].id));d.push(i(s));d.push(l)}return new Blob(d,{type:"video/webm"})}function m(b){var d=0;b.keyframe&&(d=d|128);b.invisible&&(d=d|8);b.lacing&&(d=d|b.lacing<<1);b.discardable&&(d=d|1);if(b.trackNum>127)throw"TrackNumber > 127 not supported";return[b.trackNum|128,b.timecode>>8,b.timecode&255,d].map(function(b){return String.fromCharCode(b)}).join("")+
b.frame}function l(b,d){return parseInt(b.substr(d+4,4).split("").map(function(b){b=b.charCodeAt(0).toString(2);return Array(8-b.length+1).join("0")+b}).join(""),2)}function C(b){for(var d=0,e={};d<b.length;){var f=b.substr(d,4),g=l(b,d),i=b.substr(d+4+4,g),d=d+(8+g);e[f]=e[f]||[];f==="RIFF"||f==="LIST"?e[f].push(C(i)):e[f].push(i)}return e}function B(b){return[].slice.call(new Uint8Array((new Float64Array([b])).buffer),0).map(function(b){return String.fromCharCode(b)}).reverse().join("")}b=new function(b){var e;
if(b[0]){e=b[0].width;for(var f=b[0].height,g=b[0].duration,i=1;i<b.length;i++)g=g+b[i].duration;e={duration:g,width:e,height:f}}else{postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});e=void 0}if(!e)return[];e=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1E6,id:2807729},{data:"whammy",id:19840},
{data:"whammy",id:22337},{data:B(e.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:e.width,id:176},{data:e.height,id:186}]}]}]}]}];for(g=f=0;f<b.length;){var l=[],i=0;do{l.push(b[f]);i=i+b[f].duration;f++}while(f<b.length&&i<3E4);l={id:524531317,data:d(g,0,l)};e[1].data.push(l);g=g+i}return k(e)}(b.map(function(b){var d;d=C(atob(b.image.slice(23)));
for(var e=d.RIFF[0].WEBP[0],f=e.indexOf("\u009d\u0001*"),g=0,i=[];g<4;g++)i[g]=e.charCodeAt(f+3+g);g=i[1]<<8|i[0];f=g&16383;g=i[3]<<8|i[2];d={width:f,height:g&16383,data:e,riff:d};d.duration=b.duration;return d}));postMessage(b)}m.prototype.add=function(b,d){if("canvas"in b)b=b.canvas;"toDataURL"in b&&(b=b.toDataURL("image/webp",this.quality));if(!/^data:image\/webp;base64,/ig.test(b))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:b,
duration:d||this.duration})};m.prototype.compile=function(g){var d=k(b);d.onmessage=function(b){b.data.error?console.error(b.data.error):g(b.data)};d.postMessage(this.frames)};return{Video:m}}(),DiskStorage={init:function(){function m(){function b(d){f.objectStore(k.dataStoreName).get(d).onsuccess=function(b){k.callback&&k.callback(b.target.result,d)}}var f=d.transaction([k.dataStoreName],"readwrite");k.videoBlob&&f.objectStore(k.dataStoreName).put(k.videoBlob,"videoBlob");k.gifBlob&&f.objectStore(k.dataStoreName).put(k.gifBlob,
"gifBlob");k.audioBlob&&f.objectStore(k.dataStoreName).put(k.audioBlob,"audioBlob");b("audioBlob");b("videoBlob");b("gifBlob")}var k=this,b=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB,g=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),d,f=b.open(g,1);f.onerror=k.onError;f.onsuccess=function(){d=f.result;d.onerror=k.onError;d.setVersion?d.version!==1?d.setVersion(1).onsuccess=function(){d.createObjectStore(k.dataStoreName);m()}:m():
m()};f.onupgradeneeded=function(b){b.target.result.createObjectStore(k.dataStoreName)}},Fetch:function(m){this.callback=m;this.init();return this},Store:function(m){this.audioBlob=m.audioBlob;this.videoBlob=m.videoBlob;this.gifBlob=m.gifBlob;this.init();return this},onError:function(m){console.error(JSON.stringify(m,null,"\t"))},dataStoreName:"recordRTC",dbName:null};
function GifRecorder(m){if(!window.GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";this.record=function(){function m(l){if(k)return setTimeout(function(){m(l)},100);f=requestAnimationFrame(m);typeof e===void 0&&(e=l);if(!(l-e<90)){d.paused&&d.play();g.drawImage(d,0,0,b.width,b.height);if(z.onGifPreview)z.onGifPreview(b.toDataURL("image/png"));i.addFrame(g);e=l}}if(!this.width)this.width=d.offsetWidth||320;if(!this.height)this.height=d.offsetHeight||240;if(!this.video)this.video=
{width:this.width,height:this.height};if(!this.canvas)this.canvas={width:this.width,height:this.height};b.width=this.canvas.width;b.height=this.canvas.height;d.width=this.video.width;d.height=this.video.height;i=new window.GIFEncoder;i.setRepeat(0);i.setDelay(this.frameRate||200);i.setQuality(this.quality||10);i.start();Date.now();var z=this;f=requestAnimationFrame(m)};this.stop=function(){f&&cancelAnimationFrame(f);Date.now();this.blob=new Blob([new Uint8Array(i.stream().bin)],{type:"image/gif"});
i.stream().bin=[]};var k=false;this.pause=function(){k=true;this.disableLogs||console.debug("Paused recording.")};this.resume=function(){k=false;this.disableLogs||console.debug("Resumed recording.")};var b=document.createElement("canvas"),g=b.getContext("2d"),d=document.createElement("video");d.muted=true;d.autoplay=true;d.src=URL.createObjectURL(m);d.play();var f=null,e,i};
